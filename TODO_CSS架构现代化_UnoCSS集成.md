# TODO：CSS架构现代化 UnoCSS集成

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任何任务前，你必须首先阅读并严格遵守位于 `documentation/ai-collaboration-guide.md` 的全局协作指南。

## 目标
通过引入UnoCSS实现CSS架构现代化，提升开发效率和代码质量，同时保持现有视觉效果的完全一致性。基于深度技术选型分析，UnoCSS在性能、Vue生态匹配度和技术先进性方面优于Tailwind CSS。

## 范围与约束
- **范围**: 本次任务聚焦于Vue前端的CSS架构升级，从传统CSS迁移至UnoCSS utility-first架构。
- **约束**:
  - 所有视觉效果必须100%保持一致，不得有任何视觉回归。
  - 必须保持Tailwind语法兼容性，确保开发体验连续性。
  - 采用渐进式迁移策略，避免大规模重写风险。

## 任务列表

> 任务编号规范
> - 阶段A使用前缀"A"：任务A.1、任务A.2 …；步骤使用"A.1.x"的三级编号
> - 阶段B使用前缀"B"：任务B.1、任务B.2 …；步骤使用"B.1.x"
> - 阶段C使用前缀"C"：任务C.1、任务C.2 …；步骤使用"C.1.x"
> - 阶段D使用前缀"D"：任务D.1、任务D.2 …；步骤使用"D.1.x"
> - 注意，上述阶段X，都是指在当前TODOlist中的阶段，而非其他。

---

### **阶段A：基础设施搭建与设计系统映射**

#### - [x] 任务A.1：UnoCSS基础设施搭建
- **核心思想**: 建立UnoCSS开发环境基础设施，确保与现有Vue3 + TypeScript + Vite技术栈完全兼容，为后续CSS架构迁移奠定稳固技术基础。
- **交付物**:
  - UnoCSS配置文件和Vite插件集成
  - 包依赖管理更新
  - UnoCSS入口样式文件
  - 基础功能验证
- **验收标准**:
  - 开发环境UnoCSS成功启动，Tailwind兼容预设正常工作
  - 生产环境构建成功，无错误和警告
  - TypeScript类型检查通过
  - 基础utility类（如p-4, text-center）正常生效
- **预期改动文件**:
  - `lugarden_universal/frontend_vue/package.json` - 添加UnoCSS相关依赖
  - `lugarden_universal/frontend_vue/uno.config.ts` - UnoCSS配置文件
  - `lugarden_universal/frontend_vue/vite.config.ts` - Vite插件配置
  - `lugarden_universal/frontend_vue/src/main.ts` - 导入UnoCSS样式
  - `lugarden_universal/frontend_vue/src/assets/styles/uno.css` - UnoCSS入口文件
- **实际改动文件**:
  - `lugarden_universal/frontend_vue/package.json` - 添加UnoCSS依赖(unocss, @unocss/preset-wind, @unocss/preset-uno)
  - `lugarden_universal/frontend_vue/package-lock.json` - 锁定61个新依赖包版本
  - `lugarden_universal/frontend_vue/uno.config.ts` - UnoCSS配置文件，启用Tailwind兼容预设
  - `lugarden_universal/frontend_vue/vite.config.ts` - 集成UnoCSS插件到构建流程
  - `lugarden_universal/frontend_vue/src/main.ts` - 导入UnoCSS虚拟模块
  - `lugarden_universal/frontend_vue/src/assets/styles/uno.css` - UnoCSS样式入口文件
- **完成状态**: ✅ 已完成
- **执行步骤**:
  - [x] **步骤A.1.1 (安装依赖)**: 安装UnoCSS相关依赖包 (unocss, @unocss/preset-wind, @unocss/preset-uno)
  - [x] **步骤A.1.2 (配置文件)**: 创建uno.config.ts，启用Tailwind兼容预设
  - [x] **步骤A.1.3 (Vite集成)**: 配置Vite UnoCSS插件，确保与现有样式不冲突
  - [x] **步骤A.1.4 (样式入口)**: 创建UnoCSS入口文件并在main.ts中引入

#### - [x] 任务A.2：设计系统映射与CSS变量集成
- **核心思想**: 建立现有CSS变量系统与UnoCSS设计令牌的双向映射关系，确保设计系统的一致性和可维护性，为组件级迁移做好准备。
- **交付物**:
  - CSS变量与UnoCSS令牌映射配置
  - 自定义主题扩展
  - 设计系统令牌验证
- **验收标准**:
  - 现有CSS变量在UnoCSS配置中正确映射
  - 自定义主题令牌在开发和生产环境正常工作
  - 颜色、字体、间距等设计令牌100%对应
  - 响应式断点配置与现有系统一致
- **预期改动文件**:
  - `lugarden_universal/frontend_vue/uno.config.ts` - 扩展主题配置
  - `lugarden_universal/frontend_vue/src/assets/styles/uno.css` - 自定义CSS变量映射
- **实际改动文件**:
  - `lugarden_universal/frontend_vue/uno.config.ts` - 完整主题配置，103个设计令牌映射
  - `lugarden_universal/frontend_vue/src/assets/styles/uno.css` - CSS变量双向映射+渐进式迁移支持类
- **完成状态**: ✅ 已完成
- **执行步骤**:
  - [x] **步骤A.2.1 (变量分析)**: 分析现有CSS变量系统结构
  - [x] **步骤A.2.2 (主题扩展)**: 在UnoCSS配置中创建对应的theme扩展
  - [x] **步骤A.2.3 (映射建立)**: 建立CSS变量与UnoCSS令牌的双向映射关系
  - [x] **步骤A.2.4 (功能验证)**: 验证自定义主题正确工作

---

### **阶段B：样式兼容层与组件分析**

#### - [x] 任务B.1：样式兼容层创建
- **核心思想**: 建立UnoCSS与现有CSS系统的兼容层，确保渐进式迁移过程中样式不冲突，为安全的组件级重构创造条件。
- **交付物**:
  - CSS命名空间和优先级管理
  - UnoCSS与现有类名的兼容映射
  - 渐进式覆盖策略实现
- **验收标准**:
  - UnoCSS类名与现有CSS类名无优先级冲突
  - Tailwind语法在项目中100%兼容
  - CSS层级确保正确的样式覆盖顺序
  - 现有组件样式完全不受影响
- **预期改动文件**:
  - `lugarden_universal/frontend_vue/uno.config.ts` - 配置CSS层级
  - `lugarden_universal/frontend_vue/src/assets/styles/uno.css` - 兼容层样式
- **实际改动文件**:
  - `lugarden_universal/frontend_vue/uno.config.ts` - 完善CSS层级配置和命名空间管理
  - `lugarden_universal/frontend_vue/src/assets/styles/uno.css` - 兼容层样式、层级管理、双向映射系统
- **完成状态**: ✅ 已完成
- **执行步骤**:
  - [x] **步骤B.1.1 (命名空间)**: 创建CSS namespace防止优先级冲突
  - [x] **步骤B.1.2 (兼容映射)**: 建立UnoCSS与现有类名的兼容映射
  - [x] **步骤B.1.3 (层级配置)**: 配置CSS层级确保渐进式覆盖策略
  - [x] **步骤B.1.4 (语法验证)**: 验证Tailwind语法100%兼容

#### - [x] 任务B.2：组件CSS audit与分类
- **核心思想**: 系统性审计所有Vue组件的CSS代码，按照保留/重构策略进行分类，为精准的组件级迁移制定详细计划。
- **交付物**:
  - 组件CSS代码审计报告
  - 保留/重构策略分类标记
  - 迁移优先级排序
- **验收标准**:
  - 所有.vue文件的CSS代码已完成审计和分类
  - 复杂动画、伪元素、兼容性代码准确标记为保留
  - 基础样式代码准确标记为可重构
  - 迁移计划具有可操作性和可追踪性
- **预期改动文件**:
  - 审计报告文档（不修改代码，仅分析）
- **实际改动文件**:
  - `CSS_AUDIT_REPORT.md` - 完整的组件CSS审计报告
- **完成状态**: ✅ 已完成
- **执行步骤**:
  - [x] **步骤B.2.1 (CSS扫描)**: 扫描所有.vue文件中的CSS代码，建立样式清单
  - [x] **步骤B.2.2 (策略分类)**: 按照保留/重构策略对CSS代码进行分类标记
  - [x] **步骤B.2.3 (复杂标识)**: 识别复杂动画、伪元素、兼容性代码等需保留的部分
  - [x] **步骤B.2.4 (重构标记)**: 标记可直接用UnoCSS(Tailwind语法)替换的基础样式代码

---

### **阶段C：组件迁移与性能验证**

#### - [ ] 任务C.1：Phase 1零风险验证迁移
- **核心思想**: 验证UnoCSS基础功能，建立迁移信心。选择最简单的4个组件进行100%安全迁移，验证混合处理原则的可行性。
- **交付物**:
  - 4个零风险组件迁移完成
  - 迁移模式和最佳实践总结
  - 性能对比报告
- **验收标准**:
  - 4个组件视觉效果100%一致
  - UnoCSS性能优势得到验证
  - 混合处理原则运行良好
  - 开发体验显著改善
- **预期改动文件**:
  - App.vue - 基础容器样式重构
  - EmptyState.vue - 空状态页面样式重构
  - QuestionCard.vue - 简单卡片样式重构
  - ProgressBar.vue - 基础组件样式重构
- **完成状态**: 🔄 待开始
- **预期工作量**: 2小时
- **预期完成率**: 100%
- **风险等级**: 零风险
- **执行步骤**:
  - [ ] **步骤C.1.1 (App.vue迁移)**: 迁移基础容器样式（~30行CSS）
  - [ ] **步骤C.1.2 (EmptyState.vue迁移)**: 迁移空状态页面样式（~80行CSS）
  - [ ] **步骤C.1.3 (QuestionCard.vue迁移)**: 迁移简单卡片样式（~80行CSS）
  - [ ] **步骤C.1.4 (ProgressBar.vue迁移)**: 迁移基础组件样式（~60行CSS）
  - [ ] **步骤C.1.5 (视觉验证)**: 进行详细的视觉回归测试，确保迁移效果一致
  - [ ] **步骤C.1.6 (性能验证)**: 验证UnoCSS性能优势：构建速度提升和开发体验改善

#### - [ ] 任务C.2：Phase 2低风险批量迁移
- **核心思想**: 批量处理页面级组件，应用Phase 1验证的迁移模式，实现规模化迁移。
- **交付物**:
  - 6个低风险页面组件迁移完成
  - 批量迁移流程优化
  - 代码review检查点通过
- **验收标准**:
  - 所有组件视觉效果保持100%一致
  - utility样式迁移覆盖率达到90%以上
  - 页面性能无显著下降
  - 通过所有代码review检查点
- **预期改动文件**:
  - MainProjectSelection.vue - 简单选择页样式重构
  - SubProjectSelection.vue - 子项目选择样式重构
  - ClassicalEchoScreen.vue - 页面容器样式重构
  - QuizScreen.vue - 页面布局样式重构
  - ResultScreen.vue - 简化布局样式重构
  - NotificationToast.vue - 通知样式重构
- **完成状态**: 🔄 待开始
- **预期工作量**: 4小时
- **预期完成率**: 90%
- **风险等级**: 低风险
- **执行步骤**:
  - [ ] **步骤C.2.1 (模式应用)**: 应用Phase 1验证的迁移模式到页面组件
  - [ ] **步骤C.2.2 (批量处理)**: 并行处理6个页面级组件的基础样式迁移
  - [ ] **步骤C.2.3 (响应式验证)**: 验证响应式设计在迁移后保持一致
  - [ ] **步骤C.2.4 (性能测试)**: 批量迁移后的性能基准测试

#### - [ ] 任务C.3：Phase 3中风险选择性迁移
- **核心思想**: 处理内容展示组件的基础样式，应用部分迁移策略，保留复杂业务逻辑。
- **交付物**:
  - 2个中风险组件部分迁移完成
  - 混合处理策略验证
  - 边界识别最佳实践
- **验收标准**:
  - 基础样式成功迁移至UnoCSS
  - 复杂业务逻辑样式保持不变
  - 视觉效果100%一致
  - 代码可维护性提升
- **预期改动文件**:
  - ClassicalEchoDisplay.vue - 基础布局部分样式重构
  - InterpretationDisplay.vue - 文本样式部分重构
- **完成状态**: 🔄 待开始
- **预期工作量**: 3小时
- **预期完成率**: 70%
- **风险等级**: 中风险
- **执行步骤**:
  - [ ] **步骤C.3.1 (边界识别)**: 精确识别基础样式与复杂逻辑的边界
  - [ ] **步骤C.3.2 (部分迁移)**: 仅迁移安全的基础样式部分
  - [ ] **步骤C.3.3 (业务逻辑保护)**: 确保复杂业务逻辑样式完全保留
  - [ ] **步骤C.3.4 (集成测试)**: 验证混合处理后的组件功能完整性

#### - [ ] 任务C.4：Phase 4高风险谨慎迁移
- **核心思想**: 仅处理复杂组件的最基础样式，最大程度保留现有实现，验证极限迁移场景。
- **交付物**:
  - 5个高风险组件最小化迁移完成
  - 风险控制策略验证
  - 迁移边界最佳实践
- **验收标准**:
  - 仅基础容器和间距样式迁移成功
  - 所有复杂逻辑（动画、交互、状态）完全保留
  - 零功能破坏，零视觉差异
  - 详细的视觉回归测试通过
- **预期改动文件**:
  - ErrorState.vue - 布局和间距部分样式重构
  - BackButton.vue - 基础按钮样式重构
  - LoadingSpinner.vue - 容器和文本样式重构
  - ActionButtons.vue - 网格和间距样式重构
  - PoemViewer.vue - 最基础的容器样式重构
- **完成状态**: 🔄 待开始
- **预期工作量**: 6小时
- **预期完成率**: 50%
- **风险等级**: 高风险
- **风险提示**: ⚠️ 需要详细的视觉回归测试
- **执行步骤**:
  - [ ] **步骤C.4.1 (风险评估)**: 对每个组件进行详细的迁移风险分析
  - [ ] **步骤C.4.2 (最小化迁移)**: 仅迁移最安全的基础样式（容器、间距）
  - [ ] **步骤C.4.3 (复杂逻辑保护)**: 完全保留动画、交互、状态管理相关样式
  - [ ] **步骤C.4.4 (详细测试)**: 进行全面的视觉回归测试和功能测试
  - [ ] **步骤C.4.5 (回滚准备)**: 建立完整的回滚机制以防止意外破坏



#### - [ ] 任务C.5：性能优化验证
- **核心思想**: 验证UnoCSS按需生成机制的性能优势，确保CSS架构现代化带来预期的性能提升和开发效率改善。
- **交付物**:
  - 性能对比报告
  - 包体积分析
  - 开发体验改善评估
- **验收标准**:
  - CSS包体积减少30-50%
  - 构建时间提升20-30%
  - HMR速度显著提升
  - 所有浏览器兼容性测试通过
- **预期改动文件**:
  - 性能分析报告（不修改代码）
- **完成状态**: 🔄 待开始
- **执行步骤**:
  - [ ] **步骤C.5.1 (按需验证)**: 验证UnoCSS零预设按需生成机制，确认无冗余样式
  - [ ] **步骤C.5.2 (性能对比)**: 对比迁移前后的CSS包体积和构建时间
  - [ ] **步骤C.5.3 (开发体验)**: 测试开发环境HMR速度提升效果
  - [ ] **步骤C.5.4 (兼容性测试)**: 确认所有组件在不同设备和浏览器中的表现一致

---

### **阶段D：交互体验现代化（低优先级）**

#### - [ ] 任务D.1：诗歌展示页交互体验现代化重构
- **核心思想**: 利用UnoCSS的utility-first优势，重新设计诗歌展示页的交互体验，引入现代化的微交互和动画效果，提升用户参与度。
- **交付物**:
  - 现代化交互设计方案
  - 微交互动画实现
  - 用户体验提升评估
- **验收标准**:
  - 交互响应更加流畅自然
  - 微动画符合现代设计语言
  - 用户参与度和满意度提升
  - 性能影响控制在可接受范围
- **预期改动文件**:
  - `lugarden_universal/frontend_vue/src/views/ResultScreen.vue` - 交互重设计
  - `lugarden_universal/frontend_vue/src/components/PoemViewer.vue` - 微交互增强
  - 相关动画样式文件
- **完成状态**: 🔄 待开始（低优先级）
- **执行步骤**:
  - [ ] **步骤D.1.1 (交互分析)**: 分析当前诗歌展示页的交互痛点
  - [ ] **步骤D.1.2 (设计方案)**: 设计现代化的交互体验方案
  - [ ] **步骤D.1.3 (微交互实现)**: 使用UnoCSS实现微交互和动画效果
  - [ ] **步骤D.1.4 (体验评估)**: 进行用户体验评估和性能影响分析

---

## 测试与验收
- **阶段A**: 
  - UnoCSS开发环境成功搭建并可正常使用
  - 设计系统映射正确，自定义主题正常工作
- **阶段B**: 
  - 样式兼容层正常工作，无优先级冲突
  - 组件CSS审计完成，迁移策略明确
- **阶段C**: 
  - 所有组件迁移完成，视觉效果100%一致
  - 性能指标达到预期提升目标
- **阶段D**: 
  - 交互体验现代化效果显著
  - 用户满意度和参与度提升

## 更新日志关联
- **预计更新类型**: [架构重构/性能优化]
- **更新目录**: `documentation/changelog/YYYY-MM-DD_CSS_architecture_modernization_UnoCSS/`
- **更新日志文件**: `更新日志.md`
- **测试验证点**:
  - [ ] UnoCSS基础设施搭建成功
  - [ ] 设计系统映射完成
  - [ ] 组件迁移完成，视觉效果一致
  - [ ] 性能指标达到预期

## 完成后的操作
- [ ] 创建更新目录：`documentation/changelog/YYYY-MM-DD_CSS_architecture_modernization_UnoCSS/`
- [ ] 将本TODO文件移动到更新目录并重命名为 `TODO.md`
- [ ] 创建对应的更新日志文档：`更新日志.md`
- [ ] 提交所有更改到Git

---

*本TODO清单基于项目CSS架构现代化需求创建，遵循项目标准TODO模板格式。*
