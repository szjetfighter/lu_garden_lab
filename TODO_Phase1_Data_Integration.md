# 陆家花园项目 第一阶段：数据整合与数据库化 TODO

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任何任务前，你必须首先阅读并严格遵守位于 `documentation/ai-collaboration-guide.md` 的全局协作指南。

## 目标
基于现有的 `poeject_zhou_spring_autumn/application/server.js`，建立统一的数据库系统，将毛小豆宇宙的数据有机融入陆家花园主宇宙，实现两个子项目数据的深度整合，为后续的前端升级和功能深化奠定坚实的数据基础。

## 任务列表

### **子阶段 A：数据库设计与数据建模**
- [x] **任务 A-1**：分析两个子项目的数据结构和关系
  - **分析结论**:
    - **毛小豆宇宙**: 是一个高度结构化、关系密集的实体-关系网络，核心实体包括诗歌、角色、场景、主题和理论，通过ID引用建立复杂关联。其体验模式是**探索式、分析式**的。
    - **周与春秋**: 是一个以交互为导向、高度抽象的功能驱动模型，核心是通过“问题-编码-映射”的线性流程，为用户提供引导式的、个性化的诗歌阅读体验。
    - **整合策略**: 必须设计一个能同时包容两种模式的统一数据库，既能存储“毛小豆宇宙”的网状实体数据，也要能支持“周与春秋”的线性互动逻辑。
- [x] **任务 A-2**：设计统一的数据库表结构，体现"陆家花园主宇宙"概念
  - **设计成果**: 详细的实体关系图（ERD）和设计解读已保存至 `documentation/database/schema_v1.md`。
- [ ] **任务 A-3**：建立数据关联关系（诗歌-角色-场景-主题的关联）
  - **工作流核心**:
    - **唯一真实来源**: 未来的 `prisma/schema.prisma` 文件将是数据库结构的唯一代码实现和真实来源。
    - **可视化文档**: `documentation/database/schema_v1.md` 中的图表是其可视化表现。
    - **更新流程**: 所有数据库结构变更，都应**先修改 `schema.prisma` 文件**，然后根据其内容**重新生成图表**并更新到 `.md` 文档中，以确保文档与代码的绝对一致。
- [ ] **任务 A-4**：安装和配置SQLite + Prisma环境

### **子阶段 B：数据迁移与整合**
- [ ] **任务 B-1**：编写数据迁移脚本，将JSON数据导入数据库
- [ ] **任务 B-2**：建立毛小豆宇宙与周春秋项目的数据关联
- [ ] **任务 B-3**：实现数据完整性验证和一致性检查
- [ ] **任务 B-4**：创建数据统计和分析功能

### **子阶段 C：统一API网关与数据服务**
- [ ] **任务 C-1**：重构现有API，使用数据库替代JSON文件
- [ ] **任务 C-2**：编写API自动化测试（使用Jest/Supertest），确保重构前后接口行为一致
- [ ] **任务 C-3**：创建统一的API网关，支持跨项目数据访问
- [ ] **任务 C-4**：实现数据查询和关联查询功能
- [ ] **任务 C-5**：添加数据缓存和性能优化机制

## 更新日志关联
- **预计更新类型**: 架构重构 / 功能更新
- **更新目录**: `documentation/changelog/YYYY-MM-DD_第一阶段数据整合完成/`
- **更新日志文件**: `更新日志.md`
- **测试验证点**: 
  - [ ] 数据库表结构设计合理，符合主宇宙概念
  - [ ] 数据迁移脚本运行成功，所有数据无损导入
  - [ ] 统一API能够正确地从数据库中读取和关联数据
  - [ ] 自动化测试全部通过，接口行为符合预期
  - [ ] 应用在切换数据源后，原有功能不受影响

## 注意事项
- 每完成一个关键任务（如数据迁移、API重构）都要进行完整的功能测试。
- 在修改API前，确保自动化测试已覆盖现有功能，以便验证重构的正确性。
- 保持Git提交历史的清晰，每个子任务完成后都应有一次独立的提交。

## 完成后的操作
- [ ] 创建更新目录：`documentation/changelog/YYYY-MM-DD_第一阶段数据整合完成/`
- [ ] 将本TODO文件移动到更新目录并重命名为 `TODO.md`
- [ ] 创建对应的更新日志文档：`更新日志.md`
- [ ] 提交所有更改到Git
- [ ] 更新 `ROADMAP.md` 中第一阶段的状态
- [ ] 更新 `当前进展.md` 文件

## 当前状态
🔄 进行中

---
*本模板基于陆家花园项目Git开发指南创建*

