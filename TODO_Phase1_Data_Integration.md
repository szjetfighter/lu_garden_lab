# 陆家花园项目 第一阶段：数据整合与数据库化 TODO

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任何任务前，你必须首先阅读并严格遵守位于 `documentation/ai-collaboration-guide.md` 的全局协作指南。

## 目标
执行一次彻底的架构重构，建立一个清晰、专业、可扩展的项目结构。创建一个统一的 `lugarden_universal` 目录来承载所有与应用服务相关的部分（后端逻辑、前端静态文件、启动脚本等）。在此基础上，为新的后端服务配置数据库环境，为后续的数据整合奠定坚实的基础。

## 任务列表

### **子阶段 0：架构重构与环境准备**
> **目标**: 建立一个符合“关注点分离”原则和项目长远规划的目录结构，彻底解决因项目演进而导致的结构混乱问题。

 - [x] **任务 0-1**: 在项目根目录创建 `lugarden_universal` 文件夹，作为未来统一的元宇宙网站公共组件存放地。
 - [x] **任务 0-2**: 在新的 上述 文件夹内，创建 `application` 和 `public` 以及`launch`三个子文件夹。
 - [x] **任务 0-3**: 将 `poeject_zhou_spring_autumn/application/` 内的所有文件和文件夹，迁移到 `lugarden_universal/application/` 目录。
 - [x] **任务 0-4**: 将 `poeject_zhou_spring_autumn/public/` 内的所有文件和文件夹，迁移到 `lugarden_universal/public/` 目录。
 - [x] **任务 0-5**: 更新`poeject_zhou_spring_autumn` 目录下的启动脚本（如 `start.bat`, `stop.bat`），使其正确指向 `lugarden_universal/application/` 目录，并移动到`lugarden_universal/launch/`目录
 - [x] **任务 0-6**: 清理 `poeject_zhou_spring_autumn` 目录中遗留的、现已为空的 `application` 和 `public` 文件夹。
 - [x] **任务 0-7**: 在 `lugarden_universal/application/` 目录下，安装和配置SQLite + Prisma环境。

### **子阶段 A：数据库设计与数据建模**
- [x] **任务 A-1**：分析两个子项目的数据结构和关系
 - **分析结论**:
    - **毛小豆宇宙**: 是一个高度结构化、关系密集的实体-关系网络，核心实体包括诗歌、角色、场景、主题和理论，通过ID引用建立复杂关联。其体验模式是**探索式、分析式**的。
    - **周与春秋**: 是一个以交互为导向、高度抽象的功能驱动模型，核心是通过“问题-编码-映射”的线性流程，为用户提供引导式的、个性化的诗歌阅读体验。
    - **整合策略**: 必须设计一个能同时包容两种模式的统一数据库，既能存储“毛小豆宇宙”的网状实体数据，也要能支持“周与春秋”的线性互动逻辑。
- [~] **任务 A-2**：设计统一的数据库表结构，体现"陆家花园主宇宙"概念
  - **状态说明**: 现有设计（`schema.md`）已完成，但其结构无法支撑“主宇宙”关联模型，需在任务A-5中进行审查和增强。
- [ ] **任务 A-3**：建立数据关联关系（诗歌-角色-场景-主题的关联）
- [ ] **任务 A-5**: **审查并增强数据库 Schema**。根据任务 B-2 中确立的“主宇宙”关联模型，重新审查 `schema.md` 中的设计。**核心是斩断核心概念（如`Themes`）与具体子宇宙的直接绑定**，使其成为真正中立的、可共享的“主宇宙”实体。

### **子阶段 B：数据迁移与整合**
- [ ] **任务 B-1**：编写数据迁移脚本，将JSON数据导入数据库
- [ ] **任务 B-2**：基于“陆家花园主宇宙”的核心概念（如统一主题、情感原型等），建立各子项目（毛小豆、周与春秋）与主宇宙的数据映射关联。**（依赖任务A-5完成）**
- [ ] **任务 B-3**：实现数据完整性验证和一致性检查
- [ ] **任务 B-4**：创建数据统计和分析功能

### **子阶段 C：统一API网关与数据服务**
- [ ] **任务 C-1**：重构现有API，使用数据库替代JSON文件
- [ ] **任务 C-2**：编写API自动化测试（使用Jest/Supertest），确保重构前后接口行为一致
- [ ] **任务 C-3**：创建统一的API网关，支持跨项目数据访问
- [ ] **任务 C-4**：实现数据查询和关联查询功能
- [ ] **任务 C-5**：添加数据缓存和性能优化机制
- [ ] **任务 C-6**: **端到端功能验证**。在完成API重构后，以用户的身份，手动操作整个前端应用（包括 `index.html` 的完整问答流程和 `admin.html` 的所有管理功能），确保所有页面、按钮、数据交互和显示效果与重构前完全一致。

## 更新日志关联
- **预计更新类型**: 架构重构 / 功能更新
- **更新目录**: `documentation/changelog/YYYY-MM-DD_第一阶段数据整合完成/`
- **更新日志文件**: `更新日志.md`
- **测试验证点**: 
  - [ ] 数据库表结构设计合理，符合主宇宙概念
  - [ ] 数据迁移脚本运行成功，所有数据无损导入
  - [ ] 统一API能够正确地从数据库中读取和关联数据
  - [ ] 后端自动化测试全部通过，接口行为符合预期
  - [ ] **前端端到端测试通过，所有页面和交互功能均与重构前保持一致，无任何功能退化。**

## 注意事项
- 每完成一个关键任务（如数据迁移、API重构）都要进行完整的功能测试。
- 在修改API前，确保自动化测试已覆盖现有功能，以便验证重构的正确性。
- 保持Git提交历史的清晰，每个子任务完成后都应有一次独立的提交。

## 完成后的操作
- [ ] 创建更新目录：`documentation/changelog/YYYY-MM-DD_第一阶段数据整合完成/`
- [ ] 将本TODO文件移动到更新目录并重命名为 `TODO.md`
- [ ] 创建对应的更新日志文档：`更新日志.md`
- [ ] 提交所有更改到Git
- [ ] 更新 `ROADMAP.md` 中第一阶段的状态
- [ ] 更新 `当前进展.md` 文件

## 当前状态
🔄 进行中

---
*本模板基于陆家花园项目Git开发指南创建*
