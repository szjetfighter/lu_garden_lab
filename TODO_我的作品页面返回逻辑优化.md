# 我的作品页面返回逻辑优化 TODO

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任何任务前，你必须首先阅读并严格遵守位于 `documentation/ai-collaboration-guide.md` 的全局协作指南。

## 问题描述

**核心问题**: 用户从共笔页面/结果页面点击"我的作品"后，点击返回按钮，会回到陆家花园首页，而不是返回原来的页面

**具体场景**:
1. 用户在共笔页面 (`/gongbi`)
2. 点击右上角新增的用户导航中的"我的作品"
3. 进入我的作品页面 (`/my-works`)
4. 点击页面中的"返回陆家花园"按钮
5. **期望**: 返回到共笔页面
6. **实际**: 返回到陆家花园首页 ❌

## 问题根源分析

### 技术原因
- **文件位置**: `lugarden_universal/frontend_vue/src/core/auth/views/MyWorksView.vue`
- **问题代码** (第300-302行):
```typescript
const goBack = () => {
  router.push('/')  // ❌ 强制跳转到首页
}
```

### 问题性质
- **不是新问题**: 这是已存在的逻辑缺陷，不是今天全站用户导航统一化实现引入的
- **问题暴露**: 因为新增了共笔页面和结果页面的"我的作品"入口，使原本隐藏的问题被暴露
- **用户体验**: 违背了用户对"返回"按钮的直觉预期

## 解决方案设计

### 目标
实现智能返回逻辑，让用户回到进入"我的作品"前的页面

### 技术方案

#### 方案1: 智能历史返回 (推荐)
```typescript
const goBack = () => {
  // 检查浏览器历史记录
  if (window.history.length > 1) {
    router.back()  // 使用浏览器后退
  } else {
    router.push('/')  // 兜底：直接访问时返回首页
  }
}
```

**优点**:
- 符合用户直觉期望
- 实现简单，代码量少
- 自动适配所有来源页面
- 向后兼容：从首页进入仍然正常

#### 方案2: URL参数传递来源
```typescript
// UserNavigation组件中修改链接
<router-link :to="`/my-works?from=${$route.path}`" @click="closeMenu" class="menu-item">

// MyWorksView中读取来源
const goBack = () => {
  const fromPath = route.query.from as string
  if (fromPath && fromPath !== '/my-works') {
    router.push(fromPath)
  } else {
    router.push('/')
  }
}
```

**优点**:
- 精确控制返回目标
- 可以处理复杂的跳转逻辑

**缺点**:
- 需要修改所有"我的作品"入口
- URL参数传递增加复杂性

### 推荐方案
采用**方案1（智能历史返回）**，理由：
- 更符合Web标准和用户预期
- 实现简单且稳定可靠
- 无需修改其他组件

## 任务列表

### 任务A.1: 分析当前返回逻辑问题
- [ ] 步骤A.1.1: 在MyWorksView.vue中定位goBack函数
- [ ] 步骤A.1.2: 分析当前router.push('/')的行为
- [ ] 步骤A.1.3: 测试从不同页面进入我的作品的返回行为
- [ ] 步骤A.1.4: 确认问题影响的用户路径

### 任务A.2: 实施智能返回逻辑
- [x] 步骤A.2.1: 修改goBack函数实现智能返回逻辑
- [x] 步骤A.2.2: 添加适当的注释说明返回逻辑
- [x] 步骤A.2.3: 确保TypeScript类型检查通过
- [x] 步骤A.2.4: 测试各种场景下的返回行为

### 任务A.3: 全面测试验证
- [x] 步骤A.3.1: 测试从首页进入我的作品的返回
- [x] 步骤A.3.2: 测试从共笔页面进入我的作品的返回
- [x] 步骤A.3.3: 测试从结果页面进入我的作品的返回
- [x] 步骤A.3.4: 测试直接访问我的作品页面的返回
- [x] 步骤A.3.5: 测试移动端和桌面端的返回行为

## 验收标准

### 功能验收
- [ ] 从首页进入我的作品，点击返回，回到首页
- [ ] 从共笔页面进入我的作品，点击返回，回到共笔页面
- [ ] 从结果页面进入我的作品，点击返回，回到结果页面
- [ ] 直接访问我的作品页面，点击返回，回到首页
- [ ] 浏览器后退按钮行为与返回按钮一致

### 技术验收
- [ ] TypeScript类型检查通过
- [ ] 构建过程无错误无警告
- [ ] 代码符合项目编码规范
- [ ] 添加了适当的注释说明

### 用户体验验收
- [ ] 返回行为符合用户直觉预期
- [ ] 不同设备（桌面端、移动端）行为一致
- [ ] 不影响其他页面的导航逻辑
- [ ] 保持原有我的作品页面的其他功能不变

## 影响范围

### 直接影响
- `lugarden_universal/frontend_vue/src/core/auth/views/MyWorksView.vue`
- goBack函数的返回逻辑

### 间接影响
- 提升从共笔页面和结果页面的用户体验
- 与全站用户导航统一化实现形成完整的用户体验闭环

### 风险评估
- **风险等级**: 低风险
- **影响范围**: 仅影响我的作品页面的返回行为
- **回滚方案**: 简单修改goBack函数即可快速回滚
- **测试复杂度**: 中等，需要测试多种进入路径

## 技术细节

### 关键代码位置
```
MyWorksView.vue
├── 第11行: 桌面端返回按钮调用
├── 第28行: 移动端返回按钮调用  
└── 第300-302行: goBack函数实现 (需要修改)
```

### 依赖关系
- Vue Router: 使用router.back()和router.push()
- 浏览器History API: 检查window.history.length
- 无需额外依赖或API调用

### 兼容性考虑
- 现代浏览器都支持History API
- Vue Router在所有目标浏览器中都有router.back()支持
- 不影响SEO或搜索引擎爬虫

## 后续优化建议

### 短期优化
1. 考虑在返回按钮上添加tooltip提示返回目标
2. 评估其他页面是否有类似的返回逻辑问题

### 长期优化  
1. 建立全站统一的导航返回标准
2. 考虑实现面包屑导航提升用户路径感知
3. 添加用户导航行为的埋点统计

## 完成标准

- [x] 问题分析完成并形成解决方案
- [ ] 代码修改实施完成
- [ ] 本地测试验证通过
- [ ] 生产环境部署验证
- [ ] 创建对应的更新日志文档

## 关联任务
- 依赖于: 全站用户导航统一化实现（已完成）
- 关联于: 提升整体用户导航体验

---

**创建时间**: 2025-11-25  
**优先级**: 中等  
**预计工期**: 1-2小时  
**责任人**: AI Assistant + 用户验证
