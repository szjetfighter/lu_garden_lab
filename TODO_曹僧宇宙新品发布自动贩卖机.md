# 曹僧宇宙《新品发布》自动贩卖机 TODO

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任何任务前，你必须首先阅读并严格遵守位于 `documentation/ai-collaboration-guide.md` 的全局协作指南。

## 项目定位

**POC + 生产标准**：本项目是陆家花园前端视觉突破的验证项目，但以生产标准来做。

**核心目标**：
1. 验证 TresJS/Three.js 在 Vue3 Modular Monolith 架构中的引入方式
2. 建立陆家花园"fancy"视觉效果的标杆
3. 为曹僧的诗歌《新品发布》提供契合其诗学的交互形式

## 诗学分析

### 诗歌结构
- **题目**：《新品发布》
- **形式**：14个荒诞"产品名" + 14首对应诗歌作为"注释"
- **美学**：工业与肉体结合的怪诞感、消费主义的黑色幽默

### 交互隐喻
- **形式**：自动贩卖机（Vending Machine）
- **契合点**：
  - "新品发布"的商业隐喻 → 贩卖机的"消费"行为
  - 14个产品 → 贩卖机的14个商品格子
  - 诗歌作为"产品说明书" → 从取货口掉出
  - 用户"购买"诗歌的行为本身 → 对消费主义的解构

## 视觉风格

**昭和复古 × 工业黑色幽默**

| 元素 | 设计语言 |
|------|---------|
| 机器外观 | 80年代日本自动贩卖机的旧塑料感、磨损贴纸、闪烁霓虹灯管 |
| 产品展示 | 小格子里的"样品"，每个格子有独立灯光 |
| 交互反馈 | 机械声、硬币叮当、电机嗡鸣、出货口"咚"声 |
| 诗歌呈现 | 从出货口掉出的皱巴巴"产品说明书" |

**为什么这个风格**：
- 有年代感 → 暗示这些"产品"是某个平行宇宙的遗物
- 有质感 → 不是扁平化UI，有触感
- 有幽默 → 正经的机器卖荒诞的东西

## 技术决策

### 架构方案：全局安装，按需加载

TresJS/Three.js 作为项目依赖安装（package.json），但通过 **Vue Router 懒加载 + Vite 代码分割**，实现按需加载：

- 依赖安装在 `package.json`，全项目可用
- 实际使用仅在 `modules/caogong/xinpin/` 内
- Vite 自动将 Three.js 打包为独立 chunk
- **只有访问 `/caogong/xinpin` 时才会加载 Three.js，其他页面完全不受影响**

```
src/modules/
└── caogong/                    # 曹僧宇宙（新增）
    └── xinpin/                 # 新品发布功能
        ├── views/
        │   └── XinpinView.vue          # 主视图
        ├── components/
        │   ├── VendingMachine.vue      # 主容器（含TresCanvas）
        │   ├── MachineBody.vue         # 3D机身组件
        │   ├── ProductGrid.vue         # 产品格子网格
        │   ├── ProductSlot.vue         # 单个产品格子
        │   ├── ControlPanel.vue        # 控制面板（编号键盘）
        │   ├── DispenseSlot.vue        # 取货口
        │   └── PoemReceipt.vue         # 诗歌说明书（2D覆盖层）
        ├── composables/
        │   └── useVendingMachine.ts    # 贩卖机状态逻辑
        ├── assets/
        │   ├── models/                 # 3D模型（.glb）
        │   ├── textures/               # 纹理贴图
        │   └── sounds/                 # 音效文件
        ├── data/
        │   └── products.ts             # 14个产品数据
        ├── stores/
        │   └── xinpinStore.ts          # 状态管理
        └── types/
            └── xinpin.ts               # 类型定义
```

### 3D程度：中（2.5D场景）

- 固定视角，无自由旋转
- 真实光影和材质
- bloom发光特效
- 机械动画（格子灯亮、出货动作）

### 依赖管理

```json
// package.json 新增依赖
{
  "dependencies": {
    "@tresjs/core": "^4.x",      // Three.js Vue封装
    "@tresjs/cientos": "^3.x",   // 常用3D组件库
    "three": "^0.160.x"          // Three.js核心
  }
}
```

**按需加载原理**：Vue Router 懒加载路由组件 → Vite 自动代码分割 → Three.js 被打包为独立 chunk → 只有访问相关页面时才下载。

## 范围与约束

- 仅修改/新增 `modules/caogong/` 目录
- TresJS/Three.js 全局安装，Vite 自动按需加载
- 保持与现有设计系统的兼容（UnoCSS、CSS变量）
- 移动端优先，但3D效果可降级

## 任务列表

---

### **阶段A：基础设施搭建**

#### - [ ] 任务A.1：TresJS 依赖安装与配置

- **核心思想**:
  - 引入 TresJS 生态到项目
  - Vue Router 懒加载 + Vite 代码分割自动实现按需加载
- 交付物：
  - package.json 新增依赖
  - 验证 TresCanvas 基础渲染
- 验收标准：
  - `npm run build` 成功
  - 构建产物中 Three.js 在独立 chunk（Vite 自动处理）
- **风险评估**: 低风险，标准依赖安装
- 预期改动文件：
  - `frontend_vue/package.json`
  - `frontend_vue/src/modules/caogong/xinpin/views/XinpinView.vue`（测试文件）
- 执行步骤：
  - [ ] 步骤A.1.1：安装 @tresjs/core @tresjs/cientos three
  - [ ] 步骤A.1.2：创建测试页面验证 TresCanvas 渲染
  - [ ] 步骤A.1.3：验证打包产物结构（确认Three.js在独立chunk）

---

#### - [ ] 任务A.2：Caogong 模块结构与路由

- **核心思想**:
  - 建立曹僧宇宙的模块结构
  - 配置路由，使 `/caogong/xinpin` 可访问
- 交付物：
  - `modules/caogong/` 完整目录结构
  - 路由配置
  - Portal 入口（可选，暂时隐藏）
- 验收标准：
  - 访问 `/caogong/xinpin` 显示占位页面
  - TypeScript 类型检查通过
- **风险评估**: 低风险，标准模块创建
- 预期改动文件：
  - `frontend_vue/src/modules/caogong/` 整个目录（新建）
  - `frontend_vue/src/router/index.ts`
- 执行步骤：
  - [ ] 步骤A.2.1：创建 caogong/xinpin 目录结构
  - [ ] 步骤A.2.2：创建类型定义 xinpin.ts
  - [ ] 步骤A.2.3：配置路由（懒加载）
  - [ ] 步骤A.2.4：创建占位 XinpinView.vue
  - [ ] 步骤A.2.5：验证路由可访问

---

#### - [ ] 任务A.3：产品数据结构设计

- **核心思想**:
  - 将诗歌内容结构化为14个"产品"
  - 设计数据结构支持展示和交互
- **数据结构设计**:
  ```typescript
  interface Product {
    id: string           // 编号，如 "A1"
    name: string         // 产品名，如 "烂西红柿牌内燃机"
    emoji: string        // 展示emoji，如 "🍅"
    poem: {
      title: string      // 诗歌标题
      subtitle?: string  // 副标题（如有）
      body: string       // 诗歌正文
    }
    position: {          // 在贩卖机中的位置
      row: number        // 0-2
      col: number        // 0-4
    }
  }
  ```
- 交付物：
  - `data/products.ts` 完整的14个产品数据
  - `types/xinpin.ts` 类型定义
- 验收标准：
  - 14个产品数据完整
  - 类型定义正确
  - 可被组件正确导入
- **风险评估**: 低风险，纯数据工作
- 预期改动文件：
  - `frontend_vue/src/modules/caogong/xinpin/data/products.ts`
  - `frontend_vue/src/modules/caogong/xinpin/types/xinpin.ts`
- 执行步骤：
  - [ ] 步骤A.3.1：定义 Product 接口
  - [ ] 步骤A.3.2：从 Markdown 提取14首诗歌数据
  - [ ] 步骤A.3.3：分配产品位置（3行5列，最后一行4个）
  - [ ] 步骤A.3.4：选择合适的 emoji 表示
  - [ ] 步骤A.3.5：验证数据完整性

---

### **阶段B：2D 交互原型**

#### - [ ] 任务B.1：贩卖机 2D 布局

- **核心思想**:
  - 先用纯 CSS/HTML 实现贩卖机的 2D 布局
  - 验证交互流程再引入 3D
- 交付物：
  - VendingMachine.vue 2D版本
  - ProductGrid.vue 产品格子网格
  - ControlPanel.vue 控制面板
- 验收标准：
  - 贩卖机外观呈现
  - 14个产品格子正确显示
  - 布局响应式适配
- **风险评估**: 低风险，纯前端布局
- 执行步骤：
  - [ ] 步骤B.1.1：VendingMachine 外框布局（header/body/footer）
  - [ ] 步骤B.1.2：ProductGrid 3行5列网格（最后行4个）
  - [ ] 步骤B.1.3：ProductSlot 单格样式（边框、灯光、emoji）
  - [ ] 步骤B.1.4：ControlPanel 编号显示+确认按钮
  - [ ] 步骤B.1.5：DispenseSlot 取货口占位
  - [ ] 步骤B.1.6：响应式适配（移动端/桌面端）

---

#### - [ ] 任务B.2：交互状态机

- **核心思想**:
  - 实现完整的交互流程状态管理
  - 状态：idle → selecting → dispensing → viewing → idle
- **状态设计**:
  ```typescript
  type MachineState = 
    | 'idle'        // 等待用户操作
    | 'selecting'   // 用户正在选择（格子高亮）
    | 'dispensing'  // 机器运转中（动画）
    | 'viewing'     // 展示诗歌说明书
  ```
- 交付物：
  - xinpinStore.ts 状态管理
  - useVendingMachine.ts 交互逻辑
- 验收标准：
  - 状态流转正确
  - 可通过点击格子触发选择
  - 可展示对应诗歌
- **风险评估**: 中风险，涉及状态管理设计
- 执行步骤：
  - [ ] 步骤B.2.1：定义 MachineState 类型
  - [ ] 步骤B.2.2：xinpinStore 实现状态管理
  - [ ] 步骤B.2.3：useVendingMachine composable
  - [ ] 步骤B.2.4：ProductSlot 点击事件绑定
  - [ ] 步骤B.2.5：状态流转测试

---

#### - [ ] 任务B.3：诗歌说明书展示

- **核心思想**:
  - 设计"产品说明书"形式的诗歌展示
  - 工业风格排版，有折痕/皱纹质感
- 交付物：
  - PoemReceipt.vue 说明书组件
  - 展开/收起动画
- 验收标准：
  - 说明书从取货口"掉出"动画
  - 工业风格排版
  - 可关闭返回
- **风险评估**: 中风险，涉及创意视觉设计
- 执行步骤：
  - [ ] 步骤B.3.1：说明书视觉设计（纸张质感、折痕）
  - [ ] 步骤B.3.2：排版设计（产品名、编号、正文）
  - [ ] 步骤B.3.3：掉出动画（从取货口位置展开）
  - [ ] 步骤B.3.4：关闭交互（点击外部/关闭按钮）
  - [ ] 步骤B.3.5：与 xinpinStore 状态联动

---

### **阶段C：3D 视觉升级**

#### - [ ] 任务C.1：TresJS 场景搭建

- **核心思想**:
  - 将 2D 布局升级为 2.5D 场景
  - 固定视角，有深度感但不可旋转
- 交付物：
  - TresCanvas 场景容器
  - 相机和灯光配置
  - 基础几何体测试
- 验收标准：
  - 3D 场景正确渲染
  - 光影效果正常
  - 性能可接受（60fps）
- **风险评估**: 中风险，首次引入 Three.js
- 执行步骤：
  - [ ] 步骤C.1.1：VendingMachine 改为 TresCanvas 容器
  - [ ] 步骤C.1.2：配置正交相机（固定视角）
  - [ ] 步骤C.1.3：配置环境光 + 点光源
  - [ ] 步骤C.1.4：添加基础几何体测试渲染
  - [ ] 步骤C.1.5：性能基准测试

---

#### - [ ] 任务C.2：贩卖机 3D 建模

- **核心思想**:
  - 创建贩卖机的 3D 模型
  - 可以用代码几何体或外部 .glb 模型
- **建模方案选择**:
  - 方案1：Three.js 代码几何体（Box + Plane组合）
  - 方案2：Blender 建模导出 .glb
  - **建议**：先用方案1快速验证，后续可升级
- 交付物：
  - MachineBody.vue 机身3D组件
  - 材质配置（塑料感、磨损感）
- 验收标准：
  - 机身外观符合"昭和复古"风格
  - 材质有质感（非扁平色）
- **风险评估**: 中高风险，涉及 3D 建模知识
- 执行步骤：
  - [ ] 步骤C.2.1：机身主体（Box几何体）
  - [ ] 步骤C.2.2：产品展示区（凹陷区域）
  - [ ] 步骤C.2.3：控制面板区（下方凸起）
  - [ ] 步骤C.2.4：取货口（底部开口）
  - [ ] 步骤C.2.5：材质配置（塑料PBR材质）
  - [ ] 步骤C.2.6：磨损/贴纸纹理（可选增强）

---

#### - [ ] 任务C.3：产品格子 3D 化

- **核心思想**:
  - 14个产品格子升级为 3D
  - 每个格子有独立灯光效果
- 交付物：
  - ProductSlot 3D 版本
  - 灯光发光效果（Bloom）
  - hover/选中状态
- 验收标准：
  - 格子有深度感
  - hover 时灯亮起
  - 选中时发光
- **风险评估**: 中风险，涉及 Three.js 交互
- 执行步骤：
  - [ ] 步骤C.3.1：格子 3D 几何体
  - [ ] 步骤C.3.2：格子内置点光源
  - [ ] 步骤C.3.3：hover 检测（Raycaster）
  - [ ] 步骤C.3.4：hover 灯光动画
  - [ ] 步骤C.3.5：选中发光效果（Bloom后处理）

---

#### - [ ] 任务C.4：出货动画

- **核心思想**:
  - 实现"选中→机器运转→产品掉落"的完整动画
  - 音效配合
- 交付物：
  - 选中格子闪烁动画
  - 机械运转震动效果
  - 说明书掉落动画
  - 音效集成
- 验收标准：
  - 动画流畅自然
  - 有"机械感"
  - 音效同步
- **风险评估**: 中风险，涉及动画编排
- 执行步骤：
  - [ ] 步骤C.4.1：选中格子闪烁（3次）
  - [ ] 步骤C.4.2：机身轻微震动
  - [ ] 步骤C.4.3：取货口动画（打开）
  - [ ] 步骤C.4.4：说明书掉落（物理感）
  - [ ] 步骤C.4.5：音效加载与播放
  - [ ] 步骤C.4.6：动画序列编排

---

### **阶段D：打磨与发布**

#### - [ ] 任务D.1：视觉打磨

- **核心思想**:
  - 细节打磨，提升视觉品质
  - 添加环境氛围
- 交付物：
  - 霓虹灯管效果
  - 环境粒子（灰尘/光点）
  - 机器"运行中"的微动效
- 验收标准：
  - 视觉效果达到"fancy"标准
  - 与陆家花园整体风格有差异化但不冲突
- 执行步骤：
  - [ ] 步骤D.1.1：顶部霓虹招牌
  - [ ] 步骤D.1.2：环境粒子效果
  - [ ] 步骤D.1.3：机器待机微动效（灯光呼吸）
  - [ ] 步骤D.1.4：整体色调调整

---

#### - [ ] 任务D.2：性能优化

- **核心思想**:
  - 确保移动端流畅运行
  - 低端设备降级方案
- 交付物：
  - 性能监控
  - 降级方案（关闭 Bloom 等）
- 验收标准：
  - 中端手机 30fps+
  - 低端设备有 fallback
- 执行步骤：
  - [ ] 步骤D.2.1：添加性能监控（Stats.js）
  - [ ] 步骤D.2.2：纹理压缩/LOD
  - [ ] 步骤D.2.3：低端设备检测
  - [ ] 步骤D.2.4：降级方案实现

---

#### - [ ] 任务D.3：Portal 集成

- **核心思想**:
  - 将曹僧宇宙添加到 Portal 首页
  - 配置数据库宇宙记录
- 交付物：
  - 数据库宇宙记录
  - Portal 卡片展示
- 验收标准：
  - Portal 显示曹僧宇宙卡片
  - 点击可进入《新品发布》
- 执行步骤：
  - [ ] 步骤D.3.1：数据库添加曹僧宇宙记录
  - [ ] 步骤D.3.2：Portal 路由配置
  - [ ] 步骤D.3.3：卡片文案设计
  - [ ] 步骤D.3.4：端到端测试

---

## 产品数据参考

| 编号 | 产品名 | Emoji | 诗歌标题 |
|------|--------|-------|----------|
| A1 | 烂西红柿牌内燃机 | 🍅 | 烂西红柿牌内燃机 |
| A2 | 苍蝇跑车 | 🪰 | 西部故事 |
| A3 | 翻山战舰 | ⛵ | 舰长蔡暖壶 |
| A4 | 白面团脚手架 | 🥟 | 白面团脚手架 |
| A5 | 跨海三明治大桥一体成型机 | 🥪 | 跨海三明治大桥一体成型机 |
| B1 | 时间鸟拆迁臂 | 🐦 | 时间鸟拆迁臂 |
| B2 | 牙线蹦极绳 | 🦷 | 太阳系蹦极 |
| B3 | 理念磁场器 | 🧲 | 地球服务区 |
| B4 | 种植蛋一号 | 🥚 | 摘自《种植蛋栽培指南》序言 |
| B5 | 试管婴儿代孕桶 | 🧪 | 留言至试管婴儿代孕桶 |
| C1 | 治胆瓷杯 | 🫖 | 治胆瓷杯 |
| C2 | 攀岩蹄 | 🦶 | 攀岩蹄英雄榜 |
| C3 | 无底镜 | 🪞 | 无底镜自杀案 |
| C4 | 蛔虫机械表 | ⌚ | 蛔虫机械表 |

## 更新日志关联

- **预计更新类型**: 新功能开发
- **更新目录**: `documentation/changelog/2025-12-XX_曹僧宇宙新品发布自动贩卖机/`

## 完成后的操作

- [ ] 创建更新目录并移动 `TODO.md`
- [ ] 创建 `更新日志.md`
- [ ] 提交所有更改到 Git
- [ ] 更新 `当前进展.md`

## 风险与注意事项

1. **Three.js 学习曲线**：首次引入，可能需要额外学习时间
2. **性能风险**：3D 渲染在低端设备可能卡顿，需要降级方案
3. **移动端兼容**：WebGL 在部分老旧设备支持有限
