# 用户系统开发 - 阶段D：合规功能完善 TODO

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任务前，你必须首先阅读并严格遵守位于 `.cursor/rules/` 目录下的协作规则。

## 目标

完善用户系统的法律合规功能，确保项目符合中国《生成式人工智能服务管理暂行办法》《个人信息保护法》《网络安全法》等法律法规要求，保护用户权益，降低法律风险。

**业务价值**：
- 符合法律合规要求，避免法律风险
- 保护用户隐私和数据权利
- 提升用户信任度
- 为正式上线做准备

**技术价值**：
- 建立完整的合规标识体系
- 实践隐私保护最佳实践
- 验证数据导出功能设计

---

## 范围与约束

### 范围
- ✅ AI生成内容标识（《生成式人工智能服务管理暂行办法》第18条）
- ✅ 用户协议和隐私政策（《个人信息保护法》第17条）
- ✅ 数据导出功能（《个人信息保护法》第45条）
- ❌ 不包含：实名认证、内容审核、举报机制（后续阶段）

### 约束
- **法律约束**：必须符合《生成式人工智能服务管理暂行办法》要求
- **设计约束**：AI标识不干扰用户体验，但必须清晰可见
- **技术约束**：数据导出必须完整、安全、易用
- **体验约束**：隐私政策必须清晰易懂，不使用法律黑话

---

## 法律依据

### 1. 《生成式人工智能服务管理暂行办法》

**第18条**（AI内容标识）：
> "提供者应当在生成式人工智能服务中，对生成的图片、视频等内容进行标识。"

**合规要求**：
- 必须在AI生成的诗歌内容上添加明显标识
- 标识应包含"AI生成"或类似说明
- 用户应能轻松识别内容为AI生成

### 2. 《个人信息保护法》

**第17条**（告知同意）：
> "个人信息处理者在处理个人信息前，应当以显著方式、清晰易懂的语言真实、准确、完整地向个人告知..."

**第45条**（数据可携权）：
> "个人请求将个人信息转移至其指定的个人信息处理者，符合国家网信部门规定条件的，个人信息处理者应当提供转移的途径。"

**合规要求**：
- 必须提供完整的用户协议和隐私政策
- 注册前必须获得用户同意
- 必须提供数据导出功能

---

## 任务列表

### **阶段11-04_D：合规功能完善**

#### - [ ] 任务D.1：AI生成内容标识

**核心思想**：在所有AI生成的诗歌内容上添加清晰的标识，符合《生成式人工智能服务管理暂行办法》第18条要求。

**交付物**：
- AI标识UI组件
- 标识说明弹框
- 所有诗歌展示页面的标识集成

**验收标准**：
- [ ] 共笔结果页：诗歌标题旁有AI标识图标
- [ ] 我的作品页：诗歌标题旁有AI标识图标
- [ ] 点击图标：弹出说明框，解释AI生成内容
- [ ] 说明内容清晰：说明诗歌由AI创作，人类参与共笔过程
- [ ] 移动端适配：图标和弹框在移动端正常显示

**风险评估**：低风险（纯前端UI，已有showAiLabel基础）

**预期改动文件**：
- `lugarden_universal/frontend_vue/src/modules/zhou/views/ResultScreen.vue`
- `lugarden_universal/frontend_vue/src/core/auth/views/MyWorksView.vue`
- `lugarden_universal/frontend_vue/src/modules/zhou/components/PoemViewer.vue`（已有基础）

**实际改动文件**：
- [待记录]

**完成状态**：⏳ 待开始
**Git提交**：[待记录]

**执行步骤**：
- [ ] 步骤D.1.1：检查PoemViewer的showAiLabel功能
- [ ] 步骤D.1.2：在ResultScreen启用AI标识（:show-ai-label="true"）
- [ ] 步骤D.1.3：在MyWorksView启用AI标识
- [ ] 步骤D.1.4：优化AI标识说明文案
- [ ] 步骤D.1.5：测试桌面端+移动端显示效果

---

#### - [ ] 任务D.2：用户协议和隐私政策

**核心思想**：提供完整的用户协议和隐私政策，在注册前获得用户同意，符合《个人信息保护法》第17条要求。

**交付物**：
- 用户协议页面（/terms）
- 隐私政策页面（/privacy）
- 注册页面的协议同意checkbox
- 协议内容文档

**验收标准**：
- [ ] 用户协议内容完整：服务说明、用户权利、免责声明等
- [ ] 隐私政策内容完整：数据收集、使用、存储、删除等
- [ ] 注册页面：必须勾选"我已阅读并同意"才能注册
- [ ] 协议链接可点击：跳转到独立页面查看完整协议
- [ ] 语言清晰易懂：避免法律黑话，使用普通人能理解的语言

**风险评估**：中风险（涉及法律文本，需要仔细审核）

**预期改动文件**：
- `lugarden_universal/frontend_vue/src/core/auth/views/TermsView.vue`（新建）
- `lugarden_universal/frontend_vue/src/core/auth/views/PrivacyView.vue`（新建）
- `lugarden_universal/frontend_vue/src/core/auth/views/LoginView.vue`（注册表单）
- `lugarden_universal/frontend_vue/src/router/index.ts`（路由配置）

**实际改动文件**：
- [待记录]

**完成状态**：⏳ 待开始
**Git提交**：[待记录]

**执行步骤**：
- [ ] 步骤D.2.1：起草用户协议内容
- [ ] 步骤D.2.2：起草隐私政策内容
- [ ] 步骤D.2.3：创建TermsView和PrivacyView组件
- [ ] 步骤D.2.4：在注册表单添加协议同意checkbox
- [ ] 步骤D.2.5：前端验证：未勾选无法注册
- [ ] 步骤D.2.6：测试协议链接跳转和返回

---

#### - [ ] 任务D.3：数据导出功能

**核心思想**：允许用户导出自己的作品数据，符合《个人信息保护法》第45条数据可携权要求。

**交付物**：
- 后端：GET /api/export-data 接口
- 前端：我的作品页面的"导出数据"按钮
- 导出格式：JSON文件（包含所有作品信息）

**验收标准**：
- [ ] 我的作品页面有"导出数据"按钮
- [ ] 点击按钮：下载JSON文件
- [ ] JSON包含完整数据：诗歌标题、内容、创作时间、用户输入等
- [ ] 只能导出自己的数据（后端权限验证）
- [ ] 导出成功提示：友好的成功反馈

**风险评估**：中风险（涉及数据查询和文件下载）

**预期改动文件**：
- `lugarden_universal/application/src/routes/exportData.js`（新建）
- `lugarden_universal/application/src/services/exportDataService.js`（新建）
- `lugarden_universal/application/server.js`（路由注册）
- `lugarden_universal/frontend_vue/src/core/auth/services/authApi.ts`（导出API）
- `lugarden_universal/frontend_vue/src/core/auth/views/MyWorksView.vue`（导出按钮）

**实际改动文件**：
- [待记录]

**完成状态**：⏳ 待开始
**Git提交**：[待记录]

**执行步骤**：
- [ ] 步骤D.3.1：后端实现导出数据接口
  - 查询用户所有作品
  - 格式化为JSON
  - 权限验证（只能导出自己的数据）
- [ ] 步骤D.3.2：前端实现exportData API
- [ ] 步骤D.3.3：在MyWorksView添加"导出数据"按钮
- [ ] 步骤D.3.4：实现文件下载逻辑
- [ ] 步骤D.3.5：添加成功/失败提示
- [ ] 步骤D.3.6：测试导出功能

---

## 合规检查清单

### AI内容标识合规
- [ ] 所有AI生成内容有明显标识
- [ ] 标识说明清晰易懂
- [ ] 用户能轻松识别AI生成内容

### 隐私保护合规
- [ ] 用户协议完整且易懂
- [ ] 隐私政策完整且易懂
- [ ] 注册前获得用户同意
- [ ] 提供数据导出功能

### 数据权利保障
- [ ] 用户可以查看自己的数据
- [ ] 用户可以导出自己的数据
- [ ] 数据导出格式易于阅读

---

## 设计原则

### 1. 合规优先，体验次之
- 法律合规是底线，不能为了体验牺牲合规
- 在满足合规的前提下优化用户体验

### 2. 清晰透明
- AI标识必须清晰可见
- 隐私政策必须易懂
- 数据导出必须完整

### 3. 用户友好
- 避免法律黑话
- 使用普通人能理解的语言
- 提供友好的交互反馈

---

## 测试与验收

### 端到端测试场景

#### 场景1：AI内容标识
1. 完成共笔创作 → 结果页诗歌标题旁有AI图标
2. 点击AI图标 → 弹出说明框
3. 阅读说明 → 理解诗歌为AI创作
4. 访问我的作品 → 所有诗歌标题旁都有AI图标

#### 场景2：注册协议同意
1. 访问注册页面 → 看到协议同意checkbox（未勾选）
2. 点击"注册"按钮 → 提示"请先同意用户协议"
3. 勾选checkbox → "注册"按钮可用
4. 点击"用户协议"链接 → 跳转到协议页面
5. 点击"隐私政策"链接 → 跳转到隐私政策页面

#### 场景3：数据导出
1. 登录后访问我的作品页面
2. 点击"导出数据"按钮
3. 浏览器下载JSON文件
4. 打开JSON文件 → 包含所有作品完整信息

---

## 技术约束

### 前端
- 使用Vue3组合式API + TypeScript
- 遵守vue-typescript-standards规范
- 响应式设计（移动端优先）
- 复用现有组件和样式

### 后端
- JWT权限验证
- 只能导出/查看自己的数据
- 错误处理和日志记录

---

## 完成后的操作

- [ ] 创建更新目录：`documentation/changelog/2025-11-XX_用户系统开发_阶段D/`
- [ ] 将本TODO文件移动到更新目录并重命名为 `TODO.md`
- [ ] 创建对应的更新日志文档：`更新日志.md`
- [ ] 提交所有更改到Git

---

## 当前状态

⏳ 待开始

---

## 里程碑

- **创建时间**：2025-11-04
- **开始时间**：[待更新]
- **完成时间**：[待更新]
- **预计工时**：2-3小时
- **实际工时**：[待更新]

---

*本TODO基于陆家花园项目Git开发指南创建*

