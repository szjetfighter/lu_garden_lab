# 陆家花园 统一后台（中央控制室）决策 TODO（增强版）

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任何任务前，你必须首先阅读并严格遵守位于 `documentation/ai-collaboration-guide.md` 的全局协作指南。

## 目标
以“决策为先”的方式，框定“统一后台（中央控制室）”的产品与技术路线，明确是否建设、建设到什么程度、按什么抽象与节奏推进；输出可执行的选型结论、里程碑与风险控制策略，而非详细实现方案。

## 范围与约束
- 契约冻结（如工作内容涉及，则必须):
  - 明确统一后台对外/对内的关键契约（登录鉴权、宇宙切换、只读/读写能力边界），并标注参考文档位置
- 字段映射（如工作内容涉及，则必须):
  - 统一后台所需的“主宇宙层/子宇宙层”字段抽象与映射策略应有示例与参考文档位置
- 风险与兼容策略（建议):
  - 允许与现有“周春秋专用后台”并行一段时间（灰度），并准备快速回退路径
  - 保留兼容端点（no-op 或 redirect）避免现网按钮 404，制定淘汰计划
- 健康检查（建议):
  - 约定“中央控制室”健康项：认证/缓存/数据库/适配器就绪摘要
- 缓存策略（建议):
  - 约定只读接口缓存键命名与写后失效策略，以支持跨宇宙读取一致性
- 性能与监控（可选):
  - 设定最小可观测指标（请求量、P95、缓存命中率），用于 PoC 与灰度对比

## 任务列表

> 任务编号规范
> - 第一阶段使用前缀“1”：任务1.1、任务1.2 …；步骤使用“1.1.x”的三级编号
> - 第二阶段使用前缀“2”：任务2.1、任务2.2 …；步骤使用“2.1.x”
> - 第三阶段使用前缀“3”：任务3.1、任务3.2 …；步骤使用“3.1.x”

### 第一阶段：问题界定与决策准则（定位清晰，先定标准）
- [ ] 任务1.1：统一后台的“必要性与边界”定义
  - 步骤1.1.1：从愿景与路线图提炼“中央控制室”必须承载的职责（宇宙切换/中立实体/跨宇宙关联）
  - 步骤1.1.2：明确“非目标”与阶段边界（不等于全功能 CMS，不替代前端）
- [ ] 任务1.2：利益相关方诉求收集与权重
  - 步骤1.2.1：梳理产品/技术/运维视角的核心诉求与优先级
  - 步骤1.2.2：形成“决策评价指标集”（可扩展性/一致性/成本/风险/落地周期）
- [ ] 任务1.3：候选路线集整理（不实现，仅对比）
  - 步骤1.3.1：A 方案（统一后台 + 适配器模式）
  - 步骤1.3.2：B 方案（维持多后台，各自演进）
  - 步骤1.3.3：C 方案（轻量统一：只读集中，写接口仍在子宇宙）
  - 步骤1.3.4：D 方案（统一后台 + 单库双版本/修订体系，一步到位）
- [ ] 任务1.4：决策评估矩阵（以指标集评分）
  - 步骤1.4.1：建立对比表（可维护性/扩展难度/风险/成本/灰度性）
  - 步骤1.4.2：给出加权评分与首选/备选结论（书面化）

### 第二阶段：关键抽象与 PoC（小步验证，避免锁死）
- [ ] 任务2.1：核心抽象定义（不实现业务）
  - 步骤2.1.1：`UniverseAdapter` 接口草案（最小方法集：项目/内容读取、基本写入占位）
  - 步骤2.1.2：通用“内容项 ContentItem”最小字段集（id/title/type/status/universeId）
  - 步骤2.1.3：中立实体与跨宇宙关联的展示与操作边界（只读/读写分层）
- [ ] 任务2.2：对比型 PoC（读为主，写为辅）
  - 步骤2.2.1：ZhouAdapter PoC（现有能力接入适配）
  - 步骤2.2.2：MaoxiaodouAdapter PoC（只读列表/详情即可）
  - 步骤2.2.3：统一顶部“宇宙切换器”的 UX 原型（低保真）
- [ ] 任务2.3：准入/退场标准（Go/No-Go）
  - 步骤2.3.1：明确通过门槛（读路径统一、写路径不破契约、性能不劣化）
  - 步骤2.3.2：定义退场条件（指标不达标/复杂度爆炸/关键风险无法控制）

### 第三阶段：路线确定与里程碑（治理与风险为先）
- [ ] 任务3.1：最终路线与范围确认（决策产物）
  - 步骤3.1.1：输出《统一后台选型与范围说明》（含评估矩阵、PoC 度量、灰度方案）
  - 步骤3.1.2：确定“第一里程碑”功能清单（通常为：统一只读 + 宇宙切换 + 基础中立实体只读）
- [ ] 任务3.2：治理与风控策略
  - 步骤3.2.1：权限模型（按宇宙/功能域的最小权限集）与审计日志
  - 步骤3.2.2：灰度与回退（feature flag、双入口并行、回滚剧本）
- [ ] 任务3.3：节奏与成本
  - 步骤3.3.1：人力/周期/关键依赖清单（以里程碑产物为单位预估）
  - 步骤3.3.2：对外承诺与验收口径（避免范围蠕变）

### 任务块模板（复制使用）
#### 任务X.Y：[任务标题]
- 交付物：
  - [列出应产出的决策文档/对比矩阵/PoC 原型/评审记录]
- 验收：
  - [列出可验证条件：达成书面决策、跨角色共识、门槛指标通过]
- 预期改动文件（预判）：
  - `documentation/` 决策与评估文档
  - `lugarden_universal/application/src/services/*`（仅 PoC 占位）
- 完成状态：🔄 进行中 / ✅ 已完成 / ❌ 遇到问题
- 独立审计意见（可选）：
  - 质量评级：优秀 / 良好 / 一般 / 待改进
  - 审计结论：[一句话结论]
- （可选）执行步骤：
  - 步骤X.Y.1：[具体步骤]
  - 步骤X.Y.2：[具体步骤]

## 测试与验收
- 合同测试（如工作内容涉及，则必须):
  - 仅限 PoC 的契约一致性校验（不要求覆盖全面）
- DB 写测试（如涉及写操作，建议启用):
  - 通过环境变量门控执行（如 `RUN_DB_WRITE_TESTS=1`）
- E2E 验收清单（如涉及端到端流程，建议):
  - 里程碑验收以“读路径统一/宇宙切换可用/中立实体只读可视”为准

## 更新日志关联
- **预计更新类型**: 项目治理/架构决策
- **更新目录**: `documentation/changelog/YYYY-MM-DD_统一后台决策与路线/`
- **更新日志文件**: `更新日志.md`
- **测试验证点**: 
  - [ ] 形成《决策评估矩阵》并有加权打分与结论
  - [ ] 形成《统一抽象与适配器接口草案》
  - [ ] 完成对比型 PoC 并达成 Go/No-Go 结论

## 注意事项
- 本清单用于“决策”，非“实施”
- 坚持小步评估与可回退，避免一次性锁死架构
- 在任何实现前，先达成书面化的范围决策与灰度方案

## 完成后的操作
- [ ] 创建更新目录：`documentation/changelog/YYYY-MM-DD_统一后台决策与路线/`
- [ ] 将本TODO文件移动到更新目录并重命名为 `TODO.md`
- [ ] 创建对应的更新日志文档：`更新日志.md`
- [ ] 提交所有更改到Git
- [ ] 更新项目状态

## 当前状态
🔄 进行中

---
*本模板基于陆家花园项目Git开发指南创建（增强版）*


