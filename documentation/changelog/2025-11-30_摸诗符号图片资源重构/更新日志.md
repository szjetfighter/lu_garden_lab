# 陆家花园 摸诗符号图片资源重构 更新日志

## 更新概述
本次更新将摸诗模块的符号图片从public目录迁移到模块内部assets目录，实现前后端解耦，采用Vite官方推荐的`new URL()`方式动态加载图片资源。

## 更新日期
2025-11-30

## 更新类型
资源重构 / 最佳实践优化

## 主要变更

### 1. 图片资源迁移

#### 改动前
```
public/
├── 毛小豆.png       # 中文名，后端硬编码路径
├── 华少.png
├── ...
└── lujiaming_icon.png
```

#### 改动后
```
modules/mao/moshi/assets/images/symbols/
├── wild.png           # 符号ID一致命名
├── maoxiaodou.png
├── huashao.png
├── dongxiansheng.png
├── zhangqiu.png
├── office.png
├── brotherhood.png
├── enclosed.png
├── social.png
└── sport.png
```

### 2. 前端图片加载方式

#### 改动前（后端返回路径）
```javascript
// 后端 moshiService.js
maoxiaodou: { ..., image: '/毛小豆.png', ... }

// 前端模板
<img :src="symbol.image" />
```

#### 改动后（Vite官方推荐方式）
```typescript
// 前端 SlotMachine.vue
function getSymbolImage(symbolId: string): string {
  return new URL(`../assets/images/symbols/${symbolId}.png`, import.meta.url).href
}

// 模板
<img :src="getSymbolImage(symbol.id)" />
```

### 3. 后端简化

移除后端 `moshiService.js` 中的 `image` 和 `emoji` 字段，前端自行管理图片资源。

## 技术决策依据

### Vite官方文档推荐
根据 [Vite Static Asset Handling](https://vite.dev/guide/assets)：

> Combining `new URL()` with `import.meta.url`, we can obtain the full, resolved URL of a static asset using relative path from a JavaScript module.

### 优势
1. **前后端解耦**：后端不再硬编码前端资源路径
2. **缓存哈希**：Vite自动添加内容哈希（如 `wild.abc123.png`）
3. **资源优化**：构建时自动优化
4. **模块自包含**：图片放在模块内部，符合Modular Monolith原则

## 受影响文件

### 前端
- `src/modules/mao/moshi/components/SlotMachine.vue` - 添加getSymbolImage函数
- `src/modules/mao/moshi/assets/images/symbols/*.png` - 新增10个图片

### 后端
- `application/src/services/moshiService.js` - 移除image和emoji字段

### 删除
- `public/毛小豆.png` 等9个中文名图片

### 保留
- `public/lujiaming_icon.png` - 其他模块可能使用

## 验证结果

- [x] Vite构建成功
- [x] 图片正确加载（带哈希）
- [x] 本地预览测试通过
