# 毒理报告 开发优化 TODO（增强版）

> **🤖 AI 助手注意 (AI Assistant Attention)**
> 在执行本文件中的任何任务前，你必须首先阅读并严格遵守位于 `documentation/ai-collaboration-guide.md` 的全局协作指南。

## 目标
追溯记录自 `1575c91` (2025-12-07 POC) 以来毒理报告模块的所有开发优化工作，包括3D设备优化、粒子系统重构、视觉效果增强、崩解动画实现、数据完善等。

## 范围与约束
- **范围**: `lugarden_universal/frontend_vue/src/modules/pending/004_toxicology`
- **约束**: Three.js + Vue 3 + TypeScript

## 任务列表

> **任务编号规范**
> - 阶段12-07_B使用前缀"B"：任务B.1、任务B.2 …；步骤使用"B.1.x"的三级编号
> - 阶段12-07_C使用前缀"C"：任务C.1、任务C.2 …
> - 阶段12-07_D使用前缀"D"：任务D.1、任务D.2 …
> - 阶段12-07_E使用前缀"E"：任务E.1、任务E.2 …
> - 阶段12-07_F使用前缀"F"：任务F.1、任务F.2 …

---

### **阶段12-07_B：离心机3D设备优化**

#### - [x] 任务B.1：简化设备结构
- **核心思想**: 优化离心机3D模型的几何结构，提升渲染性能和视觉清晰度
- 交付物：
  - 重构后的 `useCentrifugeDevice.ts`
- 验收标准：
  - 设备结构更简洁，渲染无卡顿
- **风险评估**: 低风险
- 实际改动文件: `composables/useCentrifugeDevice.ts`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤B.1.1：移除冗余几何体
  - [x] 步骤B.1.2：优化材质配置

#### - [x] 任务B.2：试管与支架系统
- **核心思想**: 添加4根玻璃试管和金属支架，模拟真实离心机结构
- 交付物：
  - 试管几何体（CylinderGeometry + 半球底部）
  - 带孔圆盘设计
- 验收标准：
  - 4根试管正确定位在圆盘孔中
  - 透明物体渲染顺序正确
- **风险评估**: 中风险（透明物体渲染顺序问题）
- 实际改动文件: `composables/useCentrifugeDevice.ts`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤B.2.1：创建试管几何体（`1dd2d79`）
  - [x] 步骤B.2.2：修复透明物体渲染顺序
  - [x] 步骤B.2.3：改用带孔圆盘设计（`cb3e808`）

#### - [x] 任务B.3：试管离心倾斜效果
- **核心思想**: 根据RPM动态倾斜试管，模拟离心力效果
- 交付物：
  - 试管倾斜动画逻辑
- 验收标准：
  - 0 RPM: 试管垂直
  - 9000 RPM: 试管倾斜35度
- **风险评估**: 低风险
- 实际改动文件: `composables/useCentrifugeDevice.ts`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤B.3.1：添加倾斜效果（方向待修正）（`1a7c144`）
  - [x] 步骤B.3.2：修正倾斜方向和角度（`28f224f`）

---

### **阶段12-07_C：粒子系统与交互**

#### - [x] 任务C.1：粒子系统重构
- **核心思想**: 将粒子放入试管内部，实现真正的离心效果（高权重沉底，低权重飘散）
- 交付物：
  - 重构后的 `useToxicParticles.ts`
  - 粒子跟随试管倾斜逻辑
- 验收标准：
  - 粒子在试管内部正确显示
  - 高权重词沉淀在底部
  - 低权重词被甩到上方
- **风险评估**: 中风险（坐标系转换复杂）
- 实际改动文件: `composables/useToxicParticles.ts`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤C.1.1：重构粒子位置计算（`52c0bcb`）
  - [x] 步骤C.1.2：粒子跟随试管倾斜（`e034d65`）
  - [x] 步骤C.1.3：切换数据源为 toxicology_zhengti.json（`aaf7c4f`）

#### - [x] 任务C.2：试管点击交互
- **核心思想**: 点击试管时，内部词语悬浮展示，增强交互体验
- 交付物：
  - Raycaster 点击检测
  - 词语悬浮动画
  - 词语收回动画
- 验收标准：
  - 点击试管后词语弹出并悬浮
  - 再次点击或点击其他区域词语收回
  - 已消散的词语不参与悬浮
- **风险评估**: 中风险（3D交互复杂）
- 实际改动文件: `composables/useToxicParticles.ts`, `components/ToxicologyScene.vue`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤C.2.1：实现点击检测和悬浮展示（`5c4a4f3`）
  - [x] 步骤C.2.2：悬浮词弹射向相机和收回动画（`061e613`）
  - [x] 步骤C.2.3：过滤已消散词语（`1ee54c1`）

---

### **阶段12-07_D：视觉效果与动画**

#### - [x] 任务D.1：UI风格统一
- **核心思想**: 统一毒理报告模块的视觉风格，深色主题+工业废土感
- 交付物：
  - 入口页面 `ToxicologyEntry.vue`
  - AboutAuthor 组件
  - 统一的卡片样式
- 验收标准：
  - 入口页面与主视图风格一致
  - 深色主题正确应用
- **风险评估**: 低风险
- 实际改动文件: `views/ToxicologyEntry.vue`, `components/AboutAuthor.vue`, 样式文件
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤D.1.1：统一卡片风格（`6bea0fc`）
  - [x] 步骤D.1.2：创建入口页面和深色主题（`04bad5e`）
  - [x] 步骤D.1.3：添加冯铗 AboutAuthor 组件（`ed7c738`）

#### - [x] 任务D.2：控制面板优化
- **核心思想**: 简化控制面板，改为加速按钮+RPM进度条，提升操作体验
- 交付物：
  - 加速按钮（长按加速）
  - RPM 进度条（竖排刻度）
- 验收标准：
  - 长按按钮可持续加速
  - 松开后自然减速
  - 刻度条清晰显示 0-9000 RPM
- **风险评估**: 低风险
- 实际改动文件: `views/ToxicologyView.vue`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤D.2.1：简化为加速按钮+进度条（`b3f98dc`）
  - [x] 步骤D.2.2：刻度条改为竖排显示（`abeba68`）

#### - [x] 任务D.3：动态视觉效果
- **核心思想**: 根据RPM动态调整视觉效果，增强沉浸感
- 交付物：
  - 三阶段 Glitch 效果
  - 动态 Bloom 辉光
  - 底座发光环变色（绿→红→亮白红）
  - 中心灯同步变色
- 验收标准：
  - 0-3000 RPM: 轻微效果
  - 3000-6000 RPM: 中等效果
  - 6000-9000 RPM: 强烈效果
- **风险评估**: 低风险
- 实际改动文件: `composables/useToxicScene.ts`, `composables/useCentrifugeDevice.ts`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤D.3.1：三阶段 Glitch + 背景颜色过渡（`a46c2d6`）
  - [x] 步骤D.3.2：动态 Bloom + 发光环变色（`150f978`）
  - [x] 步骤D.3.3：中心灯同步变色（`4536350`）

---

### **阶段12-07_E：崩解动画与结局**

#### - [x] 任务E.1：9000转速崩解动画
- **核心思想**: 达到9000 RPM时触发设备崩解，营造"失控"的戏剧效果
- 交付物：
  - 设备震动效果
  - 碎片飞散动画
  - 粒子弹出变白放大
- 验收标准：
  - 前40%（0-2秒）：剧烈震动
  - 后60%（2-5秒）：碎片飞散+淡出+缩小
  - 粒子弹出并变白放大
- **风险评估**: 中风险（动画协调复杂）
- 实际改动文件: `composables/useCentrifugeDevice.ts`, `composables/useToxicParticles.ts`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤E.1.1：实现震动+粒子弹出（`1742be1`）
  - [x] 步骤E.1.2：设备碎片飞散效果（`0cb8feb`）
  - [x] 步骤E.1.3：粒子白色放大+修复旋转覆盖（`d97ab31`）

#### - [x] 任务E.2：报告按钮与Modal
- **核心思想**: 崩解结束后显示"查看毒理报告"按钮，点击打开报告Modal
- 交付物：
  - WebGL 3D 报告按钮
  - 报告 Modal 组件
  - 进度条震动崩解效果
- 验收标准：
  - 崩解结束1秒后显示按钮
  - 按钮有噪点效果和呼吸动画
  - 点击后打开 Modal
- **风险评估**: 中风险（WebGL文字渲染）
- 实际改动文件: `composables/useReportButton.ts`, `components/ToxicologyReportModal.vue`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤E.2.1：进度条震动+报告按钮+Modal（`0dc0142`）
  - [x] 步骤E.2.2：WebGL 3D按钮实现（`6f3f71e`）

#### - [x] 任务E.3：崩解节奏同步
- **核心思想**: 统一进度条、设备、粒子的崩解节奏
- 交付物：
  - 修正后的进度条动画
- 验收标准：
  - 进度条前40%震动，后60%消失
  - 与设备/粒子崩解节奏一致
- **风险评估**: 低风险
- 实际改动文件: `views/ToxicologyView.vue`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤E.3.1：修正进度条崩解时机（`22deb6e`）
  - [x] 步骤E.3.2：全局改名"毒理学报告"→"毒理报告"

---

### **阶段12-07_F：数据与UI完善**

#### - [x] 任务F.1：诗歌数据整理
- **核心思想**: 完善诗歌数据，包括权重数据和原文数据
- 交付物：
  - `toxicology_zhengti.json` 权重数据
  - `poems.json` 诗歌原文
- 验收标准：
  - 八芥完整包含8个子节
  - 苦吼（副体）已删除
  - poems.json 格式正确
- **风险评估**: 低风险
- 实际改动文件: `data/toxicology_zhengti.json`, `data/poems.json`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤F.1.1：生成 toxicology_zhengti.json（`98eea47`）
  - [x] 步骤F.1.2：补全八芥+删除苦吼+创建 poems.json（`08093d6`）

#### - [x] 任务F.2：报告Modal优化
- **核心思想**: 优化报告Modal的内容展示，从poems.json动态获取诗歌原文
- 交付物：
  - Modal 从 poems.json 获取内容
  - 标题居中，移除作者，移除分割线
- 验收标准：
  - Modal 正确显示当前诗歌原文
  - 标题居中显示
  - 字号合适
- **风险评估**: 低风险
- 实际改动文件: `components/ToxicologyReportModal.vue`, `components/ToxicologyScene.vue`
- 完成状态：✅ 已完成
- 执行步骤：
  - [x] 步骤F.2.1：Modal 从 poems.json 获取诗歌内容（`2e26605`）
  - [x] 步骤F.2.2：标题居中+移除作者+移除分割线

---

## 测试与验收
- [x] 诗歌数据正确加载
- [x] 试管倾斜效果正常
- [x] 粒子离心效果正常
- [x] 点击试管交互正常
- [x] 崩解动画流畅
- [x] 报告 Modal 正确显示诗歌原文

## 更新日志关联
- **预计更新类型**: 功能更新
- **更新目录**: `documentation/changelog/2025-12-07_毒理报告开发优化/`

## 注意事项
- 透明物体渲染顺序需要特别注意
- Glitch 效果需克制，避免引发光敏性癫痫风险
- 崩解动画需要多个组件协调

## 完成后的操作
- [ ] 创建更新目录
- [ ] 将本 TODO 文件移动到更新目录
- [ ] 创建对应的更新日志文档
- [ ] 提交所有更改到 Git

## 当前状态
✅ 已完成

---

## 待办事项 (Future)
- [ ] 金属贴图应用（技术方案待研究）
- [ ] 音效集成（电流声、心跳声）
- [ ] 性能优化：60FPS @ 1000粒子

---

## 关联文档
- 原始 TODO: `TODO_毒理学报告.md`
- 技术笔记: `技术笔记_Three.js开发探索.md`

---
*本文档追溯记录 2025-12-07 的开发工作*
