# 毒理报告模块开发 更新日志

> 更新日期: 2025-12-07
> 更新类型: 功能更新
> 影响范围: `lugarden_universal/frontend_vue/src/modules/pending/004_toxicology`

---

## 概述

完成毒理报告（004_toxicology）模块的完整开发，包括3D离心机设备、粒子系统、视觉效果、崩解动画、报告Modal等功能。该模块是"匿腻溺宇宙"（pending实验宇宙）的第四个实验模块。

## 核心功能

### 1. 3D离心机设备
- 玻璃圆筒罩（透明材质）
- 金属转子盘（承载文字粒子）
- 工业底座（带发光环）
- 4根支撑柱
- 4根玻璃试管（带孔圆盘固定）
- 试管离心倾斜效果（0-35度）

### 2. 粒子系统
- 文字粒子在试管内部
- 离心效果：高权重词沉底，低权重词飘散
- 粒子跟随试管倾斜
- 点击试管悬浮展示词语
- 低权重词消散动画

### 3. 视觉效果
- 三阶段 Glitch 效果（根据RPM动态调整）
- 动态 Bloom 辉光
- 底座发光环变色（绿→红→亮白红）
- 中心灯同步变色
- CRT扫描线+噪点效果

### 4. 崩解动画（9000 RPM触发）
- 前40%（0-2秒）：设备+粒子+进度条剧烈震动
- 后60%（2-5秒）：
  - 设备碎片飞散+淡出+缩小
  - 粒子弹出变白放大
  - 进度条缩小消失

### 5. 报告系统
- WebGL 3D "查看毒理报告" 按钮（噪点+呼吸动画）
- 报告 Modal（从 poems.json 动态获取诗歌原文）
- 诗歌标题居中显示

## 数据资产

### 诗歌权重数据
- `toxicology_zhengti.json`: 正体诗歌权重数据（12首诗歌）
- 权重分级: 1.0（核心物质）、0.5（连接物质）、0（粉尘杂质）

### 诗歌原文数据
- `poems.json`: 12首诗歌原文
- 作者: 冯铗
- 诗集: 《一剂》

## 技术实现

### 技术栈
- Three.js（3D渲染）
- Vue 3 + TypeScript
- EffectComposer（后期处理）
- Custom Shaders（扫描线+噪点）

### 关键文件
- `composables/useCentrifugeDevice.ts` - 离心机设备
- `composables/useToxicParticles.ts` - 粒子系统
- `composables/useToxicScene.ts` - 场景管理
- `composables/useReportButton.ts` - 报告按钮
- `components/ToxicologyScene.vue` - 3D场景组件
- `components/ToxicologyReportModal.vue` - 报告弹窗
- `views/ToxicologyView.vue` - 主视图
- `views/ToxicologyEntry.vue` - 入口页面

## Git 提交记录

### 阶段A：POC与核心功能
- `1575c91` feat: 毒理学报告POC - 3D离心机交互模块

### 阶段B：离心机3D设备优化
- `c75a96e` refactor: 简化离心机设备结构
- `1dd2d79` feat: 添加4根试管和支架，修复透明物体渲染顺序
- `cb3e808` feat: 改用带孔圆盘设计固定试管
- `1a7c144` feat: 添加试管离心倾斜效果（方向待修正）
- `28f224f` feat: 试管离心倾斜效果 - 0%初始/35%最大，距中心1单位

### 阶段C：粒子系统与交互
- `52c0bcb` feat: 重构粒子系统 - 粒子在试管内部，真正的离心效果
- `e034d65` feat: 粒子跟随试管倾斜 + 更新诗歌数据
- `aaf7c4f` feat: 粒子系统改用toxicology_zhengti.json数据源
- `5c4a4f3` feat: 点击试管3D悬浮展示词
- `061e613` feat: 悬浮词弹射向相机和收回动画
- `1ee54c1` feat: 低权重词消散动画效果+点击试管过滤已消散词

### 阶段D：视觉效果与动画
- `6bea0fc` style: 统一毒理学报告卡片风格 - 无授权状态
- `04bad5e` feat: 004毒理学报告入口页面和深色主题
- `ed7c738` feat: 添加冯铗AboutAuthor组件 + 统一author-link样式
- `b3f98dc` refactor: 简化控制面板为加速按钮+RPM进度条
- `abeba68` style: RPM刻度条改为竖排显示(数字+RPM)
- `a46c2d6` feat: 三阶段Glitch+背景颜色平滑过渡+噪点增强
- `150f978` feat: 动态Bloom辉光+底座发光环变色(绿→红→亮白红)
- `4536350` feat: 中心灯动态变色与发光环同步

### 阶段E：崩解动画与结局
- `1742be1` feat: 9000转速崩解动画(震动+粒子弹出)
- `0cb8feb` feat: 设备崩解效果(碎片飞散+淡出+缩小)
- `d97ab31` feat: 崩解后粒子弹出(白色+放大)+修复旋转覆盖问题
- `0dc0142` feat: 进度条震动崩解+查看毒理报告按钮+报告Modal
- `6f3f71e` feat: WebGL 3D报告按钮(噪点效果+呼吸动画+点击检测)
- `22deb6e` fix: 进度条崩解节奏同步+毒理学报告改名毒理报告

### 阶段F：数据与UI完善
- `98eea47` feat: 生成 toxicology_zhengti.json - 整理后的诗歌权重数据
- `08093d6` feat: 补全八芥8节+删除苦吼(副体)+创建poems.json诗歌原文
- `2e26605` feat: Modal从poems.json获取诗歌内容+标题居中+移除作者显示

## 待办事项

- [ ] 金属贴图应用（技术方案待研究）
- [ ] 音效集成（电流声、心跳声）
- [ ] 性能优化：60FPS @ 1000粒子

## 相关文档

- TODO文档: `TODO_毒理学报告.md`（原始POC）
- TODO文档: `TODO_毒理报告开发优化.md`（开发优化记录）
- 技术笔记: `技术笔记_Three.js开发探索.md`

---

*更新日志由 AI 助手生成，基于 Git 提交记录和 TODO 文档整理*
