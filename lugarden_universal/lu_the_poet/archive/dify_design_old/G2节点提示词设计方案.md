# G2节点提示词设计方案

> **设计版本**: v1.0 (结构化版)  
> **目标模型**: GEMINI 2.5 Pro  
> **设计日期**: 2025-09-05  
> **功能定位**: 基于P节点结构化指导的精准诗歌修改生成器  
> **优化特色**: 从77行通用提示词优化为13行结构化模板，实现75%+ Token减少

## 🚀 快速使用指南

**当前G2节点问题**：使用77行通用提示词，Token消耗大，修改指导不够精准。

**优化方案**：基于P节点的结构化输出，采用动态模板组装，实现精准修改。

在Dify中更新G2节点时，请使用以下优化后的提示词配置。

## 🎯 设计目标

优化G2节点的提示词结构，实现：
1. 基于P节点结构化指导的精准修改
2. 大幅减少Token消耗（75%+减少）
3. 提高修改的针对性和可控性
4. 保持与现有工作流的完全兼容

## 📋 G2节点完整提示词配置

### **System提示词（Token优化版）**
```
你是AI诗人"陆家明"的修改专家。基于专门的修改指导进行精确优化。

修改任务: {{#P_node.structured_output.核心任务#}}

必须遵守: 
{{#P_node.structured_output.硬性约束#}}

修改指导: {{#P_node.structured_output.修改指导#}}

必须保护: 
{{#P_node.structured_output.保护要素#}}

修改程度: {{#P_node.structured_output.修改范围#}}

原作品: {{#G1_node.text#}}

请基于以上结构化指导进行修改，直接输出修改后的诗歌作品。
```

### **User提示词**
```
执行修改任务。
```

### **模型配置**
```yaml
model:
  completion_params:
    temperature: 0
  mode: chat
  name: gemini-2.5-pro
  provider: langgenius/gemini/google
```

### **变量配置**
```yaml
输入变量:
- P节点指导: {{#P_node.structured_output#}}
- G1原作品: {{#G1_node.text#}}
- 知识库检索: {{#知识库节点.output#}} (如需要)

输出变量:
- G2修改结果: {{#G2_node.text#}} (供D2节点评审)
```

## 🔧 关键优化点

### **1. 结构化输入替代静态提示词**
**当前**：77行固定提示词 + D1的改进建议
```yaml
# 当前G2提示词（简化示例）
System: |
  你是AI诗人"陆家明"...
  你已完成了一个生成，输出结果是{{#G1_node.text#}}
  但是你的同伴判别器D1判决不通过，要求你修改，修改意见是{{#D1_node.output#}}
  以下是你的改动约束：
  1. 从引文素材中选择最贴合主题的古典引文...
  2. 严格按照检索到的格式规范进行创作...
  # ... 还有70+行约束和指导
```

**优化后**：13行动态模板 + P节点结构化指导
```yaml
# 优化后G2提示词
System: |
  你是AI诗人"陆家明"的修改专家。基于专门的修改指导进行精确优化。
  修改任务: {{#P_node.structured_output.核心任务#}}
  必须遵守: {{#P_node.structured_output.硬性约束#}}
  修改指导: {{#P_node.structured_output.修改指导#}}
  必须保护: {{#P_node.structured_output.保护要素#}}
  修改程度: {{#P_node.structured_output.修改范围#}}
  原作品: {{#G1_node.text#}}
  请基于以上结构化指导进行修改，直接输出修改后的诗歌作品。
```

### **2. 动态内容替代静态约束**
| 类型 | 当前方式 | 优化方式 | 优势 |
|------|----------|----------|------|
| 修改目标 | 通用指导 | 核心任务（动态） | 精准聚焦 |
| 约束条件 | 全量约束 | 硬性约束（筛选） | 避免冗余 |
| 修改方向 | D1改进建议 | 修改指导（转换） | 操作性强 |
| 保护机制 | 无明确保护 | 保护要素（明确） | 避免过度修改 |
| 修改幅度 | 无控制 | 修改范围（控制） | 可控修改 |

### **3. Token效率优化**
```
当前G2提示词统计：
- System提示词: ~400 tokens (77行，包含大量重复约束)
- 变量引用: ~100 tokens
- 总计: ~500 tokens

优化后G2提示词统计：
- System提示词: ~80 tokens (13行简洁模板)
- P节点数据: ~50 tokens (结构化指导)
- 变量引用: ~20 tokens  
- 总计: ~150 tokens

Token减少: 75%+
```

## 🎯 修改逻辑示例

### **示例1：风格问题修改**
**P节点输入到G2**:
```
修改任务: 调整诗歌风格，更贴近吴任几的创作特色
必须遵守: ["正文字数严格≤80字", "保持引文和标题格式不变"]
修改指导: 参考吴任几的语言特色，采用更加典雅而略带忧郁的表达方式，增加哲思性的意象
必须保护: ["保持诗歌的基本内容框架", "保持引文与正文的呼应关系"]
修改程度: 重点修改
```

**G2执行逻辑**：
1. **聚焦任务**：专注风格调整，不修改其他方面
2. **遵守约束**：严格控制字数和格式
3. **执行指导**：具体采用典雅忧郁的表达方式
4. **保护要素**：不改变内容框架和引文呼应
5. **控制程度**：进行重点修改而非微调

### **示例2：篇幅问题修改**
**P节点输入到G2**:
```
修改任务: 精简正文内容，确保字数符合80字以内要求
必须遵守: ["正文字数必须≤80字", "保持诗歌的完整意境"]
修改指导: 删除冗余的形容词和过渡词语，保留最核心的意象和情感表达
必须保护: ["保持标题和引文不变", "保持诗歌的核心意象", "保持现有的风格特色"]
修改程度: 最小化修改
```

**G2执行逻辑**：
1. **聚焦任务**：专注字数精简，不改变其他内容
2. **遵守约束**：确保80字以内且保持意境
3. **执行指导**：具体删除冗余词语，保留核心表达
4. **保护要素**：标题、引文、意象、风格都不变
5. **控制程度**：最小化修改，仅做必要精简

## ⚡ 预期效果

### **Token效率提升**
- **当前G2**: 77行通用提示词 (≈500+ tokens)
- **优化后G2**: 13行结构化模板 (≈150 tokens)
- **净效果**: 75%+ Token减少

### **修改精准性提升**
- **针对性**: 基于具体问题的专门指导，避免盲目修改
- **可控性**: 通过修改范围精确控制修改程度
- **保护性**: 明确保护要素，避免破坏原作优点
- **一致性**: 结构化指导确保修改逻辑的一致性

### **维护成本降低**
- **模板化**: 13行固定模板，维护简单
- **数据驱动**: 修改逻辑由P节点数据驱动，无需修改提示词
- **可扩展**: 新增修改类型只需扩展P节点逻辑，G2模板不变

## 🔧 集成建议

### **工作流集成**
```yaml
工作流路径: G1 → D1 → (驳回) → P → G2 → D2
节点依赖:
- G2依赖P节点的结构化输出
- G2依赖G1节点的原作品
- G2可选依赖知识库检索结果
```

### **变量映射**
```yaml
P节点输出 → G2节点输入:
- {{#P_node.structured_output.核心任务#}} → 修改聚焦点
- {{#P_node.structured_output.硬性约束#}} → 必须遵守的规则
- {{#P_node.structured_output.修改指导#}} → 具体执行方法  
- {{#P_node.structured_output.保护要素#}} → 不可修改的部分
- {{#P_node.structured_output.修改范围#}} → 修改程度控制
```

### **部署步骤**
1. **确保P节点就绪**: 先部署P节点和优化的D节点Schema
2. **备份现有G2配置**: 导出当前G2节点配置
3. **更新G2提示词**: 使用新的结构化模板
4. **配置变量引用**: 确保正确引用P节点输出
5. **端到端测试**: 完整测试D1→P→G2链路

### **验证方法**
```yaml
测试用例:
输入: P节点结构化指导 + G1原作品
期望输出: 精准修改的诗歌作品
验证点:
- 是否按照核心任务执行修改
- 是否遵守硬性约束
- 是否保护指定要素
- 修改程度是否符合预期
```

## ⚠️ 注意事项

### **兼容性考虑**
- **向后兼容**: 如P节点不可用，可快速回滚至原77行提示词
- **渐进部署**: 建议先在测试环境验证完整链路
- **监控预警**: 监控G2输出质量，确保优化不降低创作质量

### **异常处理**
- **P节点异常**: 设计G2的降级模式（使用D1原始改进建议）
- **数据缺失**: 对P节点输出字段进行验证和默认值处理
- **格式错误**: 确保G2能够处理P节点输出的各种边缘情况

---

*基于双Agent对抗博弈系统的深度分析，实现G2节点的结构化、精准化修改*
*文档版本: v1.0 | 创建时间: 2025-09-05 | 与P节点设计方案配套使用*
