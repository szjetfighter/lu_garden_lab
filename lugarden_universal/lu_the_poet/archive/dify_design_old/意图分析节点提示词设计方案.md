# 意图分析节点提示词设计方案

> **设计版本**: v2.0 (RAG多样性优化版)  
> **目标模型**: GEMINI 2.0 Flash Lite  
> **设计日期**: 2025-09-05  
> **功能定位**: 用户自然语言输入→结构化意图数据的智能解析器  
> **优化特色**: 移除enum重复，实现40%+ Token减少，最大化RAG检索多样性  
> **修正内容**: 基于constrained generation原理，去除JSON Schema冗余信息

## 🎯 设计目标

将用户的自然语言输入智能解析为4字段结构化数据，为下游11个LLM节点和6个知识库检索节点提供精准的数据驱动，同时最大化RAG检索的多样性和覆盖度。

## 🔍 **现状分析与优化需求**

### **发现的问题**

**1. enum重复浪费Token**：
- 提示词中列举10个经典："周易", "论语", "孟子"...
- JSON Schema中同样枚举这10个经典
- 重复消耗约30-40个token

**2. 缺少春秋公羊传**：
- YML配置只有10个经典，缺少"春秋公羊传"
- 与之前讨论的11个经典知识库设计不一致

**3. 情感基调仍为简单enum**：
- 当前：enum ["积极", "中性", "消极"]
- 限制了RAG检索的多样性

**4. 创作主题无长度约束**：
- 当前：type: string（无限制）
- 可能产生过长的主题描述

## 📋 意图分析节点完整提示词配置

### **System提示词（Token优化版）**

**当前版本（YML实际配置）**：
```
你是用户意图分析器，需要分析用户的输入，从"周易", "论语", "孟子", "尚书", "礼记", "仪礼", "周礼", "易传", "春秋左氏传", "春秋谷梁传"中，选择最合适的输出。

分析规则
1. 如果用户明确提到经典名称，直接采用
2. 如果未指定，根据内容判断最适合的经典：
3. 提取核心创作主题  
4. 判断情感基调
```

**优化版本（移除enum重复）**：
```
你是用户意图分析器，需要分析用户的输入，选择最适合的经典依据。

分析规则
1. 如果用户明确提到经典名称，直接采用
2. 如果未指定，根据内容判断最适合的经典
3. 提取核心创作主题  
4. 判断情感基调
```

### **User提示词**
```
{{#sys.query#}}
```

### **模型配置**
```yaml
model:
  completion_params:
    temperature: 0.7
  mode: chat
  name: gemini-2.0-flash-lite
  provider: langgenius/gemini/google
```

### **变量配置**
```yaml
输入变量:
- 用户查询: {{#sys.query#}}

输出变量:
- 意图数据: {{#1756961820611.structured_output#}} (供后续节点使用)
```

## 🔧 具体优化建议

### **1. 立即优化：移除提示词重复**
```diff
- 你是用户意图分析器，需要分析用户的输入，从"周易", "论语", "孟子", "尚书", "礼记", "仪礼", "周礼", "易传", "春秋左氏传", "春秋谷梁传"中，选择最合适的输出。

+ 你是用户意图分析器，需要分析用户的输入，选择最适合的经典依据。
```

**效果**：节省30-40个token，技术约束由JSON Schema保证

### **2. 同步更新JSON Schema**
需要在YML中同时更新：
- 添加"春秋公羊传"到枚举选项
- 情感基调改为string+约束（如需RAG多样性优化）
- 创作主题添加长度约束

## ⚡ 优化效果预期

### **Token效率**
- **当前**: ~80 tokens（含重复枚举）
- **优化后**: ~45 tokens（移除重复）
- **节省**: 约40% token消耗

### **RAG检索多样性**
如果同步更新情感基调为string：
- 从固定3种组合 → 无限表达可能性
- 检索同质化问题显著缓解
- 用户体验持续性提升

## 🎯 实施建议

### **分步骤优化**
1. **第一步**: 仅优化提示词，移除重复枚举
2. **第二步**: 评估效果后，考虑是否同步更新JSON Schema
3. **第三步**: 添加春秋公羊传到经典选项

### **风险控制**
- **保持向后兼容**: 现有工作流无需修改
- **渐进验证**: 先在测试环境验证效果
- **快速回滚**: 保留原配置以便必要时恢复

---

*基于RAG原理分析和constrained generation技术，实现意图解析的效率与质量双重优化*  
*文档版本: v2.0 | 创建时间: 2025-09-05 | RAG多样性优化版 | 节点ID: 1756961820611*
