# 陆家明AI诗人 - 基线知识库节点分析

## 📝 知识库节点概览

**知识库节点共4个**:
- **风格域知识库检索**: 吴任几诗歌作品风格参考
- **正典域知识库检索**: 儒家经典原文引文来源
- **规则域知识库检索**: 诗歌创作格式规范
- **CHAT语气检索**: 吴任几语言风格提取

---

## 🎨 风格域知识库检索 (1756699728276)

### 基本配置
```yaml
dataset_ids:
- 1Y1WQbwVfkwHf+CfRVdWqWVe2lrJ0yLoyYVIYwucnxA0UN2hn0DQlGJtsdXZIlJT
desc: ''
title: 风格域知识库检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: true
  reranking_mode: weighted_score
  top_k: 4
  weights:
    keyword_setting:
      keyword_weight: 0.3
    vector_setting:
      embedding_model_name: text-embedding-3-large
      embedding_provider_name: langgenius/openai/openai
      vector_weight: 0.7
query_variable_selector:
- '1756963012326'
- output
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 与CHAT语气检索相同（复用同一个知识库）
- **重排序**: 启用，使用加权评分模式
- **Top-K**: 返回4个最相关结果
- **权重分配**: 关键词30% + 向量70%
- **Embedding模型**: OpenAI的text-embedding-3-large
- **查询变量**: 来自意图转换结果

---

## 📚 正典域知识库检索 (1756953941881)

### 基本配置
```yaml
dataset_ids:
- dqi7IcK7A9tg+J544VDWf8biflTARzG/LIemG8W5A4CaJn7lJP/SzPKFytz2ON6J
desc: ''
title: 正典域知识库检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- '1756963012326'
- output
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 独立的正典域知识库
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自意图转换结果

---

## 📋 规则域知识库检索 (1756961775730)

### 基本配置
```yaml
dataset_ids:
- wtBa5CKBmPk0XFg/W/rzdKe5hmjU4qRluehd99lxPz2AfzsJfOC7Db8U3RMXyuoH
desc: ''
title: 规则域知识库检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- '1756963012326'
- output
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 独立的规则域知识库
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自意图转换结果

---

## 💬 CHAT语气检索 (1756977828986)

### 基本配置
```yaml
dataset_ids:
- 1Y1WQbwVfkwHf+CfRVdWqWVe2lrJ0yLoyYVIYwucnxA0UN2hn0DQlGJtsdXZIlJT
desc: ''
title: CHAT语气检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- conversation
- chattone
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 与风格域检索相同（复用同一个知识库）
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自对话变量chattone（值为"检索吴任几的诗集，提炼他说话的语气"）

---

## 🔀 知识库数据集汇总

### 数据集分布
| 知识库 | 数据集ID | 用途 | 复用情况 |
|--------|----------|------|----------|
| 风格域+语气域 | 1Y1WQbw... | 吴任几诗歌作品 | 复用（2个节点） |
| 正典域 | dqi7IcK... | 儒家经典原文 | 独立使用 |
| 规则域 | wtBa5CK... | 创作格式规范 | 独立使用 |

### 检索参数对比
| 节点 | 重排序 | 重排序模型 | Top-K | 权重配置 | 查询来源 |
|------|--------|------------|-------|----------|----------|
| 风格域 | ✅ | 加权评分 | 4 | 关键词30%+向量70% | 意图转换 |
| 正典域 | ❌ | jina-reranker-m0 | 4 | 默认 | 意图转换 |
| 规则域 | ❌ | jina-reranker-m0 | 4 | 默认 | 意图转换 |
| CHAT语气 | ❌ | jina-reranker-m0 | 4 | 默认 | 会话变量 |

### Embedding配置
- **风格域**: 明确指定OpenAI的text-embedding-3-large
- **其他域**: 使用系统默认embedding模型

---

## 🎯 查询变量源头

### 意图转换输出 (1756963012326.output)
被以下3个知识库使用：
- 风格域知识库检索
- 正典域知识库检索  
- 规则域知识库检索

**变量内容结构**:
```json
{
  "经典选择": "周易|论语|孟子|...",
  "创作主题": "用户想表达的核心主题",
  "情感基调": "积极|中性|消极",
  "明确度": "明确指定|主题表达|情感倾诉|随意对话"
}
```

### 会话变量 (conversation.chattone)
被CHAT语气检索使用：

**变量值**: "检索吴任几的诗集，提炼他说话的语气"

---

## 🔄 知识库工作流程

```
用户输入
    ↓
意图分析 → 意图转换
    ↓
[并行执行3个检索]
    ├─ 风格域检索 → 风格域转换
    ├─ 正典域检索 → 正典域转换
    └─ 规则域检索 → 规则转换
         ↓
    传递给G1创作节点

[独立执行]
会话变量赋值 → CHAT语气检索 → 语气转换
    ↓
传递给CHAT节点们
```

---

## ⚙️ 优化建议

### 重排序策略优化
1. **正典域和规则域**: 考虑启用重排序，提升检索准确性
2. **统一重排序模型**: 所有域使用相同的重排序配置便于维护

### Top-K参数优化
1. **正典域**: 可增加到6-8，确保引文检索完整性
2. **规则域**: 保持4个足够，格式规范相对固定

### Embedding模型统一
1. **考虑统一**: 所有域使用相同的embedding模型
2. **性能对比**: 评估不同模型在各域的表现差异

---
*生成时间: 2025-01-11*
*基于YML版本: 0.4.0*
