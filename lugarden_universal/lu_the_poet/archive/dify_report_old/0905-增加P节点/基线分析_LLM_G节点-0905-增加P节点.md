# 陆家明AI诗人 - 基线LLM G节点分析（增加P节点版）

## 📝 G节点概览

**G节点（生成器）共3个**:
- **G1**: 初次创作（保持原设计）
- **G2**: 基于P1结构化指导的第一轮修改 ✨ **架构升级**
- **G3**: 基于P2结构化指导的第二轮修改 ✨ **架构升级**

---

## 🎯 G1节点 (1756699910424) - 初次创作

### 模型设置
```yaml
model:
  completion_params: {}
  mode: chat
  name: gemini-2.5-pro
  provider: langgenius/gemini/google
```

### 提示词配置
**System提示词**:
```
你是AI诗人"陆家明"，专门负责诗歌创作环节。前序节点已经为你准备好了所需的全部信息，你只需要专注于高质量的诗歌创作。

创作任务：

1. 从引文素材中选择最贴合主题的古典引文{{#1756965762105.output#}}

2. 严格按照检索到的格式规范进行创作{{#1756963597193.output#}}

3. 参考风格参考的语言特色和表达方式{{#1756965735142.output#}}

4. 围绕创作主题进行现代诗歌创作

严格约束：

- 正文字数严格≤80字（不含标题和引文）

- 完全按照格式规范的标题格式、首句规则等

- 只能使用检索结果中提供的真实引文

- 语言风格要与参考样本保持一致

输出原则：

- 直接创作，无需解释过程或分析步骤

- 确保标题、引文、正文三部分齐全

- 标点符号、换行格式完全准确

- 既有古典韵味又有现代诗意

重要提醒：

1. 前序节点已完成分析，你只需创作

2. 严格使用提供的检索结果

3. 专注诗歌创作，不做其他判断

4. 直接输出最终诗歌作品

基于提供的材料，创作出既符合古典文化传统、又具有现代语言魅力的诗歌作品。让古典智慧在现代语境中重新焕发生机。
```

**User提示词**:
```
开始创作
```

### 其他配置
- **上下文**: 未启用
- **视觉**: 未启用
- **变量**: 无自定义变量
- **Temperature**: 默认（保持创造性）

---

## 🔄 G2节点 (17569669412190) - 结构化指导修改 ✨ **架构升级**

### 模型设置
```yaml
model:
  completion_params:
    temperature: 0
  mode: chat
  name: gemini-2.5-pro
  provider: langgenius/gemini/google
```

### 提示词配置 ✨ **全新设计**
**System提示词**:
```
你是AI诗人"陆家明"的修改专家。基于专门的修改指导进行精确优化。

修改任务: {{#1757044544111.structured_output.核心任务#}}

必须遵守: {{#1757044544111.structured_output.硬性约束#}}

修改指导: {{#1757044544111.structured_output.修改指导#}}

必须保护: {{#1757044544111.structured_output.保护要素#}}

修改程度: {{#1757044544111.structured_output.修改范围#}}

原作品: {{#1756699910424.text#}}

请基于以上结构化指导进行修改，直接输出修改后的诗歌作品。

以下是你的改动约束：

1. 从引文素材中选择最贴合主题的古典引文{{#1757048560841.output#}}

2. 严格按照检索到的格式规范进行创作{{#1756963597193.output#}}

3. 参考风格参考的语言特色和表达方式{{#1756965735142.output#}}

4. 围绕创作主题进行现代诗歌创作
```

**User提示词**:
```
执行修改任务。
```

### 关键创新点
1. **结构化输入**: 来自P1的5个维度指导
2. **动态引文**: 来自正典域检索2的精准引文
3. **确定性修改**: temperature=0确保精准执行
4. **模块化设计**: 清晰分离任务、约束、指导、保护、范围

### 其他配置
- **上下文**: 未启用
- **视觉**: 未启用
- **变量**: 无自定义变量
- **Temperature**: 0 (确定性输出)

---

## 🎯 G3节点 (17570479883380) - 深度结构化修改 ✨ **架构升级**

### 模型设置
```yaml
model:
  completion_params:
    temperature: 0
  mode: chat
  name: gemini-2.5-pro
  provider: langgenius/gemini/google
```

### 提示词配置 ✨ **全新设计**
**System提示词**:
```
你是AI诗人"陆家明"的修改专家。基于专门的修改指导进行精确优化。

修改任务: {{#17570479873910.structured_output.核心任务#}}

必须遵守: {{#17570479873910.structured_output.硬性约束#}}

修改指导: {{#17570479873910.structured_output.修改指导#}}

必须保护: {{#17570479873910.structured_output.保护要素#}}

修改程度: {{#17570479873910.structured_output.修改范围#}}

原作品: {{#17569669412190.text#}}

请基于以上结构化指导进行修改，直接输出修改后的诗歌作品。

以下是你的改动约束：

1. 从引文素材中选择最贴合主题的古典引文{{#17570486136730.output#}}

2. 严格按照检索到的格式规范进行创作{{#1756963597193.output#}}

3. 参考风格参考的语言特色和表达方式{{#1756965735142.output#}}

4. 围绕创作主题进行现代诗歌创作
```

**User提示词**:
```
执行修改任务。
```

### 关键创新点
1. **二轮优化**: 基于G2修改基础上的深度优化
2. **P2指导**: 来自P2更精准的结构化指导
3. **动态引文3**: 来自正典域检索3的第三轮精准引文
4. **兜底机制**: 最终输出保证，无条件生成结果

### 其他配置
- **上下文**: 未启用
- **视觉**: 未启用
- **变量**: 无自定义变量
- **Temperature**: 0 (确定性输出)

---

## 🔀 G节点变量引用汇总

### G1节点变量引用（保持原有）
- `{{#1756965762105.output#}}` - 正典域转换输出
- `{{#1756963597193.output#}}` - 规则转换输出
- `{{#1756965735142.output#}}` - 风格域转换输出

### G2节点变量引用 ✨ **全新架构**
**P1结构化指导（核心创新）**:
- `{{#1757044544111.structured_output.核心任务#}}` - 修改核心任务
- `{{#1757044544111.structured_output.硬性约束#}}` - 必须遵守的约束
- `{{#1757044544111.structured_output.修改指导#}}` - 具体修改指导
- `{{#1757044544111.structured_output.保护要素#}}` - 必须保护的元素
- `{{#1757044544111.structured_output.修改范围#}}` - 修改程度控制

**其他引用**:
- `{{#1756699910424.text#}}` - G1的原始作品
- `{{#1757048560841.output#}}` - 动态检索的引文（正典域检索2）
- `{{#1756963597193.output#}}` - 规则转换输出
- `{{#1756965735142.output#}}` - 风格域转换输出

### G3节点变量引用 ✨ **全新架构**
**P2结构化指导（核心创新）**:
- `{{#17570479873910.structured_output.核心任务#}}` - 第二轮修改核心任务
- `{{#17570479873910.structured_output.硬性约束#}}` - 第二轮必须遵守的约束
- `{{#17570479873910.structured_output.修改指导#}}` - 第二轮具体修改指导
- `{{#17570479873910.structured_output.保护要素#}}` - 第二轮必须保护的元素
- `{{#17570479873910.structured_output.修改范围#}}` - 第二轮修改程度控制

**其他引用**:
- `{{#17569669412190.text#}}` - G2的修改后作品
- `{{#17570486136730.output#}}` - 动态检索的引文（正典域检索3）
- `{{#1756963597193.output#}}` - 规则转换输出
- `{{#1756965735142.output#}}` - 风格域转换输出

---

## 📊 G节点配置对比

| 节点 | 模型 | Temperature | 功能 | 输入参考 | 架构特点 |
|------|------|-------------|------|----------|----------|
| G1 | gemini-2.5-pro | 默认 | 初次创作 | 用户输入+三域检索 | 传统创作模式 |
| G2 | gemini-2.5-pro | 0 | P1指导修改 | G1输出+P1结构化指导+动态引文2 | ✨ 结构化修改 |
| G3 | gemini-2.5-pro | 0 | P2指导修改 | G2输出+P2结构化指导+动态引文3 | ✨ 深度结构化修改 |

---

## 🚀 核心创新特性

### 1. **结构化修改指导**
- **传统方式**: G2/G3接收D节点的JSON评估结果，需要自行解析和转换
- **新架构**: G2/G3接收P节点的结构化修改指导，直接可执行
- **优势**: 提高修改精度，减少理解偏差

### 2. **五维修改控制**
P节点为G2/G3提供5个维度的精确控制：
1. **核心任务**: 明确本次修改的焦点
2. **硬性约束**: 不可违反的基础规则
3. **修改指导**: 具体的操作指导
4. **保护要素**: 必须保持的原作优点
5. **修改范围**: 控制修改的程度

### 3. **动态引文匹配**
- **G1**: 基于用户意图的通用引文检索
- **G2**: 基于P1核心任务的精准引文检索
- **G3**: 基于P2核心任务的深度引文检索

### 4. **确定性修改执行**
- **Temperature=0**: 确保G2/G3严格按照指导执行
- **结构化输入**: 减少模糊性和随意性
- **模块化提示**: 清晰的职责分离

---

## 📈 架构升级效果分析

### 提示词优化
- **G1提示词**: 77行 → 保持不变
- **G2提示词**: 77行 → 30行（结构化模板）
- **G3提示词**: 77行 → 30行（结构化模板）
- **Token效率**: G2/G3提升约60%

### 修改精度提升
1. **指导明确性**: 从"改进建议"文本 → 5维结构化指导
2. **执行可控性**: 从自由理解 → 严格按模板执行
3. **质量稳定性**: 从创造性修改 → 确定性修改

### 可维护性提升
1. **模块化设计**: P节点专注指导生成，G节点专注修改执行
2. **接口标准化**: 统一的JSON Schema接口
3. **调试友好**: 结构化输出便于问题定位

---

## ⚠️ 注意事项

### 依赖关系
- **G2完全依赖P1**: P1节点故障将导致G2无法正常工作
- **G3完全依赖P2**: P2节点故障将导致G3无法正常工作
- **动态检索依赖**: G2/G3依赖对应的动态引文检索节点

### 性能考虑
- **额外延迟**: 每轮修改增加P节点+检索节点的处理时间
- **Token消耗**: P节点的分析和检索增加API调用成本
- **复杂度**: 多层依赖增加系统复杂度

### 错误处理
- **P节点输出验证**: 需确保P节点输出符合预期的JSON Schema
- **检索结果验证**: 需确保动态检索返回有效的引文材料
- **兜底机制**: G3作为最终兜底，需要具备在各种情况下生成可用结果的能力

---
*生成时间: 2025-01-11*
*基于YML版本: 0.4.0 (增加P节点)*
