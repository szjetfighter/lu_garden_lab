# 陆家明AI诗人 - 基线知识库节点分析（增加P节点版）

## 📝 知识库节点概览

**知识库节点共6个**（新增2个动态检索）:
- **风格域知识库检索**: 吴任几诗歌作品风格参考
- **正典域知识库检索**: 儒家经典原文引文来源
- **规则域知识库检索**: 诗歌创作格式规范
- **CHAT语气检索**: 吴任几语言风格提取
- **正典域知识库检索2**: ✨ 新增 - 为G2动态引文检索
- **正典域知识库检索3**: ✨ 新增 - 为G3动态引文检索

---

## 🎨 风格域知识库检索 (1756699728276)

### 基本配置
```yaml
dataset_ids:
- 1Y1WQbwVfkwHf+CfRVdWqWVe2lrJ0yLoyYVIYwucnxA0UN2hn0DQlGJtsdXZIlJT
desc: ''
title: 风格域知识库检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: true
  reranking_mode: weighted_score
  top_k: 4
  weights:
    keyword_setting:
      keyword_weight: 0.3
    vector_setting:
      embedding_model_name: text-embedding-3-large
      embedding_provider_name: langgenius/openai/openai
      vector_weight: 0.7
query_variable_selector:
- '1756963012326'
- output
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 与CHAT语气检索相同（复用同一个知识库）
- **重排序**: 启用，使用加权评分模式
- **Top-K**: 返回4个最相关结果
- **权重分配**: 关键词30% + 向量70%
- **Embedding模型**: OpenAI的text-embedding-3-large
- **查询变量**: 来自意图转换结果

---

## 📚 正典域知识库检索 (1756953941881)

### 基本配置
```yaml
dataset_ids:
- dqi7IcK7A9tg+J544VDWf8biflTARzG/LIemG8W5A4CaJn7lJP/SzPKFytz2ON6J
desc: ''
title: 正典域知识库检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- '1756963012326'
- output
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 独立的正典域知识库
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自意图转换结果

---

## 📋 规则域知识库检索 (1756961775730)

### 基本配置
```yaml
dataset_ids:
- wtBa5CKBmPk0XFg/W/rzdKe5hmjU4qRluehd99lxPz2AfzsJfOC7Db8U3RMXyuoH
desc: ''
title: 规则域知识库检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- '1756963012326'
- output
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 独立的规则域知识库
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自意图转换结果

---

## 💬 CHAT语气检索 (1756977828986)

### 基本配置
```yaml
dataset_ids:
- 1Y1WQbwVfkwHf+CfRVdWqWVe2lrJ0yLoyYVIYwucnxA0UN2hn0DQlGJtsdXZIlJT
desc: ''
title: CHAT语气检索
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- conversation
- chattone
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 与风格域检索相同（复用同一个知识库）
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自对话变量chattone（值为"检索吴任几的诗集，提炼他说话的语气"）

---

## ✨ 正典域知识库检索2 (1757048439474) **新增**

### 基本配置
```yaml
dataset_ids:
- dqi7IcK7A9tg+J544VDWf8biflTARzG/LIemG8W5A4CaJn7lJP/SzPKFytz2ON6J
desc: ''
title: 正典域知识库检索2
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- '1757044544111'
- structured_output
- 核心任务
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 与正典域检索相同（复用同一个知识库）
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自P1的结构化输出中的"核心任务"字段
- **创新点**: 基于P1的修改指导动态检索相关引文

---

## ✨ 正典域知识库检索3 (17570486115590) **新增**

### 基本配置
```yaml
dataset_ids:
- dqi7IcK7A9tg+J544VDWf8biflTARzG/LIemG8W5A4CaJn7lJP/SzPKFytz2ON6J
desc: ''
title: 正典域知识库检索3
type: knowledge-retrieval
```

### 检索配置
```yaml
multiple_retrieval_config:
  reranking_enable: false
  reranking_mode: reranking_model
  reranking_model:
    model: jina-reranker-m0
    provider: langgenius/jina/jina
  top_k: 4
query_variable_selector:
- '17570479873910'
- structured_output
- 核心任务
retrieval_mode: multiple
```

### 配置说明
- **数据集ID**: 与正典域检索相同（复用同一个知识库）
- **重排序**: 未启用（reranking_enable: false）
- **重排序模型**: 配置了jina-reranker-m0但未启用
- **Top-K**: 返回4个最相关结果
- **查询变量**: 来自P2的结构化输出中的"核心任务"字段
- **创新点**: 基于P2的修改指导动态检索相关引文

---

## 🔀 知识库数据集汇总

### 数据集分布
| 知识库 | 数据集ID | 用途 | 复用情况 |
|--------|----------|------|----------|
| 风格域+语气域 | 1Y1WQbw... | 吴任几诗歌作品 | 复用（2个节点） |
| 正典域 | dqi7IcK... | 儒家经典原文 | 复用（3个节点）✨ |
| 规则域 | wtBa5CK... | 创作格式规范 | 独立使用 |

### 检索参数对比
| 节点 | 重排序 | 重排序模型 | Top-K | 权重配置 | 查询来源 |
|------|--------|------------|-------|----------|----------|
| 风格域 | ✅ | 加权评分 | 4 | 关键词30%+向量70% | 意图转换 |
| 正典域 | ❌ | jina-reranker-m0 | 4 | 默认 | 意图转换 |
| 规则域 | ❌ | jina-reranker-m0 | 4 | 默认 | 意图转换 |
| CHAT语气 | ❌ | jina-reranker-m0 | 4 | 默认 | 会话变量 |
| 正典域2 ✨ | ❌ | jina-reranker-m0 | 4 | 默认 | P1.核心任务 |
| 正典域3 ✨ | ❌ | jina-reranker-m0 | 4 | 默认 | P2.核心任务 |

### Embedding配置
- **风格域**: 明确指定OpenAI的text-embedding-3-large
- **其他域**: 使用系统默认embedding模型

---

## 🎯 查询变量源头

### 意图转换输出 (1756963012326.output)
被以下3个知识库使用：
- 风格域知识库检索
- 正典域知识库检索  
- 规则域知识库检索

**变量内容结构**:
```json
{
  "经典选择": "周易|论语|孟子|...",
  "创作主题": "用户想表达的核心主题",
  "情感基调": "积极|中性|消极",
  "明确度": "明确指定|主题表达|情感倾诉|随意对话"
}
```

### 会话变量 (conversation.chattone)
被CHAT语气检索使用：

**变量值**: "检索吴任几的诗集，提炼他说话的语气"

### P1结构化输出 (1757044544111.structured_output.核心任务) ✨ **新增**
被正典域知识库检索2使用：

**变量特点**:
- 动态生成：基于D1评估结果智能分析
- 精准定位：针对具体修改需求的核心任务描述
- 内容示例：如"聚焦风格调整"、"聚焦格式修正"等

### P2结构化输出 (17570479873910.structured_output.核心任务) ✨ **新增**
被正典域知识库检索3使用：

**变量特点**:
- 动态生成：基于D2评估结果智能分析
- 二轮优化：在G2修改基础上进一步精准定位
- 内容示例：针对二轮修改的具体任务描述

---

## 🔄 知识库工作流程

### 原有流程
```
用户输入
    ↓
意图分析 → 意图转换
    ↓
[并行执行3个检索]
    ├─ 风格域检索 → 风格域转换
    ├─ 正典域检索 → 正典域转换
    └─ 规则域检索 → 规则转换
         ↓
    传递给G1创作节点

[独立执行]
会话变量赋值 → CHAT语气检索 → 语气转换
    ↓
传递给CHAT节点们
```

### 新增动态检索流程 ✨
```
D1评估 → P1智能分析 → 基于P1.核心任务 → 正典域检索2 → 正典域转换2
    ↓
传递给G2修改节点

D2评估 → P2智能分析 → 基于P2.核心任务 → 正典域检索3 → 正典域转换3
    ↓
传递给G3修改节点
```

---

## 🚀 创新特性

### 1. **智能动态检索**
- **传统方式**: 基于用户输入的固定检索
- **新增方式**: 基于AI分析结果的动态检索
- **优势**: 更精准地匹配修改需求

### 2. **任务驱动检索**
- **检索依据**: P节点的"核心任务"字段
- **检索精度**: 从通用主题检索升级为具体任务检索
- **实用价值**: 为修改提供更相关的引文材料

### 3. **分层检索策略**
- **第一层**: 基于用户意图的全域检索（G1阶段）
- **第二层**: 基于修改任务的定向检索（G2阶段）
- **第三层**: 基于深度修改的精准检索（G3阶段）

---

## ⚙️ 优化建议

### 重排序策略优化
1. **考虑为动态检索启用重排序**: 提升P节点驱动检索的准确性
2. **统一重排序模型**: 所有域使用相同的重排序配置便于维护

### Top-K参数优化
1. **动态检索**: 可考虑增加到6个，确保修改时有充足的引文选择
2. **保持一致性**: 所有正典域检索使用相同的Top-K配置

### 查询优化
1. **P节点输出优化**: 确保"核心任务"字段包含足够的检索关键词
2. **查询增强**: 考虑结合其他P节点字段（如"修改指导"）进行复合检索

---
*生成时间: 2025-01-11*
*基于YML版本: 0.4.0 (增加P节点)*
