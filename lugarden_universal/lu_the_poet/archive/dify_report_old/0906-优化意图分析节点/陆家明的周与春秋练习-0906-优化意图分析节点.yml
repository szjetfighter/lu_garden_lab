app:
  description: ''
  icon: 🤖
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: 陆家明的周与春秋练习
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/jina:0.0.8@d3a6766fbb80890d73fea7ea04803f3e1702c6e6bd621aafb492b86222a193dd
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.2.5@373362a028986aae53a7baf73a7f11991ba3c22c69eaf97d6cde048cfd4a9f98
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/gemini:0.5.4@22fa3d100c55f8fc4b2837d8fb0831e3c8de333a5a5b028e073d502d2df9cb35
kind: app
version: 0.4.0
workflow:
  conversation_variables:
  - description: ''
    id: 71ab2046-6de2-40a3-8339-d4c6eea7fee5
    name: chattone
    selector:
    - conversation
    - chattone
    value: ''
    value_type: string
  - description: ''
    id: a983881f-deeb-430d-a09c-4748fc9d7597
    name: opening
    selector:
    - conversation
    - opening
    value: ''
    value_type: string
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: '你好，我是陆家明，陆家花园的主理人


      这里是我练习如何模仿吴任几先生写诗的地方


      不管你说什么，我都会尝试用一首诗来回复你


      我已经准备好了。你想和我聊点儿什么？'
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: if-else
      id: 1756701800237-source-1756702603954-target
      selected: false
      source: '1756701800237'
      sourceHandle: source
      target: '1756702603954'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1756963012326-source-1756699728276-target
      selected: false
      source: '1756963012326'
      sourceHandle: source
      target: '1756699728276'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1756963012326-source-1756953941881-target
      selected: false
      source: '1756963012326'
      sourceHandle: source
      target: '1756953941881'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: knowledge-retrieval
      id: 1756963012326-source-1756961775730-target
      selected: false
      source: '1756963012326'
      sourceHandle: source
      target: '1756961775730'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1756961775730-source-1756963597193-target
      selected: false
      source: '1756961775730'
      sourceHandle: source
      target: '1756963597193'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1756963597193-source-1756699910424-target
      selected: false
      source: '1756963597193'
      sourceHandle: source
      target: '1756699910424'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1756699728276-source-1756965735142-target
      selected: false
      source: '1756699728276'
      sourceHandle: source
      target: '1756965735142'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1756953941881-source-1756965762105-target
      selected: false
      source: '1756953941881'
      sourceHandle: source
      target: '1756965762105'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1756965762105-source-1756699910424-target
      selected: false
      source: '1756965762105'
      sourceHandle: source
      target: '1756699910424'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 17569669412190-source-17569676735610-target
      selected: false
      source: '17569669412190'
      sourceHandle: source
      target: '17569676735610'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: if-else
      id: 17569676735610-source-17569679215630-target
      selected: false
      source: '17569676735610'
      sourceHandle: source
      target: '17569679215630'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1756702603954-true-1756968473773-target
      selected: false
      source: '1756702603954'
      sourceHandle: 'true'
      target: '1756968473773'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1756968473773-source-1756702666160-target
      selected: false
      source: '1756968473773'
      sourceHandle: source
      target: '1756702666160'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 17569679215630-true-17569687362650-target
      selected: false
      source: '17569679215630'
      sourceHandle: 'true'
      target: '17569687362650'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17569687362650-source-17569688050830-target
      selected: false
      source: '17569687362650'
      sourceHandle: source
      target: '17569688050830'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17569688353670-source-17569688395770-target
      selected: false
      source: '17569688353670'
      sourceHandle: source
      target: '17569688395770'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: template-transform
      id: 1756702603954-false-1756967073379-target
      selected: false
      source: '1756702603954'
      sourceHandle: 'false'
      target: '1756967073379'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: template-transform
      id: 17569679215630-false-17569681454790-target
      selected: false
      source: '17569679215630'
      sourceHandle: 'false'
      target: '17569681454790'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1756970904564-source-1756970888582-target
      selected: false
      source: '1756970904564'
      sourceHandle: source
      target: '1756970888582'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: start
        targetType: assigner
      id: 1756696215859-source-1756973331166-target
      selected: false
      source: '1756696215859'
      sourceHandle: source
      target: '1756973331166'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: start
        targetType: llm
      id: 1756696215859-source-1756961820611-target
      selected: false
      source: '1756696215859'
      sourceHandle: source
      target: '1756961820611'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 1756699910424-source-17569737246690-target
      selected: false
      source: '1756699910424'
      sourceHandle: source
      target: '17569737246690'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17569737246690-source-17569738733280-target
      selected: false
      source: '17569737246690'
      sourceHandle: source
      target: '17569738733280'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: answer
        targetType: if-else
      id: 17569738733280-source-1756702603954-target
      selected: false
      source: '17569738733280'
      sourceHandle: source
      target: '1756702603954'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: answer
        targetType: llm
      id: 1756970888582-source-1756699910424-target
      selected: false
      source: '1756970888582'
      sourceHandle: source
      target: '1756699910424'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1756965735142-source-1756699910424-target
      selected: false
      source: '1756965735142'
      sourceHandle: source
      target: '1756699910424'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1756977828986-source-1756978099539-target
      source: '1756977828986'
      sourceHandle: source
      target: '1756978099539'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1756978099539-source-1756970904564-target
      source: '1756978099539'
      sourceHandle: source
      target: '1756970904564'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: assigner
      id: 1756963012326-source-1756978323864-target
      source: '1756963012326'
      sourceHandle: source
      target: '1756978323864'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: knowledge-retrieval
      id: 1756978323864-source-1756977828986-target
      source: '1756978323864'
      sourceHandle: source
      target: '1756977828986'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1756967073379-source-1757044544111-target
      source: '1756967073379'
      sourceHandle: source
      target: '1757044544111'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1756699910424-source-1757046836363-target
      source: '1756699910424'
      sourceHandle: source
      target: '1757046836363'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1757046836363-source-1756701800237-target
      source: '1757046836363'
      sourceHandle: source
      target: '1756701800237'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 17569681454790-source-17570479873910-target
      source: '17569681454790'
      sourceHandle: source
      target: '17570479873910'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 17570479883380-source-17569688353670-target
      source: '17570479883380'
      sourceHandle: source
      target: '17569688353670'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: knowledge-retrieval
      id: 1757044544111-source-1757048439474-target
      source: '1757044544111'
      sourceHandle: source
      target: '1757048439474'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 1757048439474-source-1757048560841-target
      source: '1757048439474'
      sourceHandle: source
      target: '1757048560841'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 1757048560841-source-17569669412190-target
      source: '1757048560841'
      sourceHandle: source
      target: '17569669412190'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: template-transform
      id: 17570486115590-source-17570486136730-target
      source: '17570486115590'
      sourceHandle: source
      target: '17570486136730'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: knowledge-retrieval
      id: 17570479873910-source-17570486115590-target
      source: '17570479873910'
      sourceHandle: source
      target: '17570486115590'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: llm
      id: 17570486136730-source-17570479883380-target
      source: '17570486136730'
      sourceHandle: source
      target: '17570479883380'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: template-transform
      id: 1756973331166-source-1756963012326-target
      source: '1756973331166'
      sourceHandle: source
      target: '1756963012326'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: template-transform
      id: 1756961820611-source-1756963012326-target
      source: '1756961820611'
      sourceHandle: source
      target: '1756963012326'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: 开始
        type: start
        variables: []
      height: 53
      id: '1756696215859'
      position:
        x: 30
        y: 245.5
      positionAbsolute:
        x: 30
        y: 245.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        dataset_ids:
        - 1Y1WQbwVfkwHf+CfRVdWqWVe2lrJ0yLoyYVIYwucnxA0UN2hn0DQlGJtsdXZIlJT
        desc: ''
        multiple_retrieval_config:
          reranking_enable: true
          reranking_mode: weighted_score
          top_k: 4
          weights:
            keyword_setting:
              keyword_weight: 0.3
            vector_setting:
              embedding_model_name: text-embedding-3-large
              embedding_provider_name: langgenius/openai/openai
              vector_weight: 0.7
        query_variable_selector:
        - '1756963012326'
        - output
        retrieval_mode: multiple
        selected: false
        title: 风格域知识库检索
        type: knowledge-retrieval
      height: 91
      id: '1756699728276'
      position:
        x: 2034
        y: 245.5
      positionAbsolute:
        x: 2034
        y: 245.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params: {}
          mode: chat
          name: gemini-2.5-pro
          provider: langgenius/gemini/google
        prompt_template:
        - id: c2bac84e-6f1d-4700-b290-67461895de0f
          role: system
          text: '你是AI诗人"陆家明"，专门负责诗歌创作环节。前序节点已经为你准备好了所需的全部信息，你只需要专注于高质量的诗歌创作。



            创作任务：

            1. 从引文素材中选择最贴合主题的古典引文{{#1756965762105.output#}}

            2. 严格按照检索到的格式规范进行创作{{#1756963597193.output#}}

            3. 参考风格参考的语言特色和表达方式{{#1756965735142.output#}}

            4. 围绕创作主题进行现代诗歌创作



            严格约束：

            - 正文字数严格≤80字（不含标题和引文）

            - 完全按照格式规范的标题格式、首句规则等

            - 只能使用检索结果中提供的真实引文

            - 语言风格要与参考样本保持一致



            输出原则：

            - 直接创作，无需解释过程或分析步骤

            - 确保标题、引文、正文三部分齐全

            - 标点符号、换行格式完全准确

            - 既有古典韵味又有现代诗意



            重要提醒：

            1. 前序节点已完成分析，你只需创作

            2. 严格使用提供的检索结果

            3. 专注诗歌创作，不做其他判断

            4. 直接输出最终诗歌作品



            基于提供的材料，创作出既符合古典文化传统、又具有现代语言魅力的诗歌作品。让古典智慧在现代语境中重新焕发生机。'
        - id: fd55064b-6d96-49bd-94bc-034c625d0511
          role: user
          text: 开始创作
        selected: false
        title: G1
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1756699910424'
      position:
        x: 2702
        y: 376.5
      positionAbsolute:
        x: 2702
        y: 376.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params: {}
          mode: chat
          name: gemini-2.5-pro
          provider: langgenius/gemini/google
        prompt_config:
          jinja2_variables:
          - value_selector:
            - '1756699728276'
            - result
            variable: result
        prompt_template:
        - edition_type: basic
          id: 034d16b8-8ae1-4b56-9db6-45ddeabcfd17
          jinja2_text: ''
          role: system
          text: '你是AI文学批评家"判官"，专门负责诗歌评审环节。你需要基于检索到的评审标准对诗歌进行严格评估。


            评审对象是：{{#1757046836363.output#}}


            知识库参考：

            {{#1756965762105.output#}}

            {{#1756965735142.output#}}

            规则格式参考：

            {{#1756963597193.output#}}


            评估任务：

            1. 检查结构完整性（标题格式、首句规则、篇幅控制）

            2. 验证引文真实性（引文格式、出处匹配、内容核实）  

            3. 评估风格保真度（与系列基线的相似度）

            4. 判断证据充足度（知识库支撑程度）

            5. 生成错误码（如发现问题）

            6. 提供改进建议（针对性指导）



            评估标准：

            硬门禁检查（必须全部通过）：

            - 标题格式：严格遵循系列格式要求

            - 系列首句：特殊首句规则 

            - 正文篇幅：≤80字（不含标题和引文）

            - 引文验证：格式正确、出处匹配、内容真实



            软指标评估：

            - 风格保真度：0.00-1.00，≥0.40为合格

            - 证据充足度：高/中/低



            裁决逻辑：

            发表条件：所有硬门禁通过 且 风格保真度≥0.40

            驳回条件：任一硬门禁失败 或 风格保真度<0.40



            错误码系统：

            TITLE_FORMAT_INVALID：标题格式错误

            CHAPTER_NAME_INVALID：篇章名不在允许范围  

            FIRST_LINE_CONFLICT：系列首句互斥失败

            LENGTH_EXCEEDS：正文字数超出80字限制

            CITATION_FORMAT_INVALID：引文格式错误

            CITATION_NOT_FOUND_IN_CANON：引文在正典域未找到

            CITATION_SOURCE_MISMATCH：引文出处与系列不匹配

            STYLE_FAITHFULNESS_LOW：风格保真度过低



            改进建议原则：

            1. 具体可操作，明确指出问题所在

            2. 避免触发词，不在建议中使用"发表"或"驳回"等路由关键词

            3. 建设性指导，重点提升而非纯粹批评

            4. 基于检索到的评审标准提供针对性修改方向



            直接输出JSON格式评估结果，无需解释过程。'
        - id: fddcb772-7ef9-4fd8-8aec-4959cd67ab68
          role: user
          text: 开始执行评审
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              引文验证状态:
                description: 引文格式、出处匹配、真实性核验结果
                enum:
                - 通过
                - 失败
                - 无引文
                type: string
              改进建议:
                description: 具体可操作的改进建议，无问题时为空字符串
                type: string
              最终裁决:
                description: 基于所有评估维度的最终裁决
                enum:
                - 发表
                - 驳回
                type: string
              结构完整性:
                description: 标题格式、首句规则、篇幅控制的整体检查结果
                enum:
                - 合规
                - 不合规
                type: string
              证据充足度:
                description: 知识库支撑和论证逻辑的充分程度
                enum:
                - 高
                - 中
                - 低
                type: string
              错误码:
                description: 具体的错误类型，无错误时为NO_ERROR
                enum:
                - NO_ERROR
                - TITLE_FORMAT_INVALID
                - CHAPTER_NAME_INVALID
                - FIRST_LINE_CONFLICT
                - LENGTH_EXCEEDS
                - CITATION_FORMAT_INVALID
                - CITATION_NOT_FOUND_IN_CANON
                - CITATION_SOURCE_MISMATCH
                - STYLE_FAITHFULNESS_LOW
                type: string
              风格保真度:
                description: 与系列基线的风格相似度评分，取值范围0-1
                maximum: 1
                minimum: 0
                type: number
            required:
            - 最终裁决
            - 结构完整性
            - 引文验证状态
            - 风格保真度
            - 证据充足度
            - 错误码
            - 改进建议
            type: object
        structured_output_enabled: true
        title: D1
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1756701800237'
      position:
        x: 3370
        y: 520.5
      positionAbsolute:
        x: 3370
        y: 520.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 10390c6d-c99e-4f62-88b3-a1d2d1bbb725
            value: 发表
            varType: string
            variable_selector:
            - '1756701800237'
            - structured_output
            - 最终裁决
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: 条件分支
        type: if-else
      height: 125
      id: '1756702603954'
      position:
        x: 3704
        y: 376.5
      positionAbsolute:
        x: 3704
        y: 376.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '


          {{#1756968473773.text#}}


          {{#1756699910424.text#}}'
        desc: ''
        selected: false
        title: 直接回复
        type: answer
        variables: []
      height: 104
      id: '1756702666160'
      position:
        x: 4463
        y: 262
      positionAbsolute:
        x: 4463
        y: 262
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        dataset_ids:
        - dqi7IcK7A9tg+J544VDWf8biflTARzG/LIemG8W5A4CaJn7lJP/SzPKFytz2ON6J
        desc: ''
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: reranking_model
          reranking_model:
            model: jina-reranker-m0
            provider: langgenius/jina/jina
          top_k: 4
        query_variable_selector:
        - '1756963012326'
        - output
        retrieval_mode: multiple
        selected: false
        title: 正典域知识库检索
        type: knowledge-retrieval
      height: 91
      id: '1756953941881'
      position:
        x: 2034
        y: 376.5
      positionAbsolute:
        x: 2034
        y: 376.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        dataset_ids:
        - wtBa5CKBmPk0XFg/W/rzdKe5hmjU4qRluehd99lxPz2AfzsJfOC7Db8U3RMXyuoH
        desc: ''
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: reranking_model
          reranking_model:
            model: jina-reranker-m0
            provider: langgenius/jina/jina
          top_k: 4
        query_variable_selector:
        - '1756963012326'
        - output
        retrieval_mode: multiple
        selected: false
        title: 规则域知识库检索
        type: knowledge-retrieval
      height: 91
      id: '1756961775730'
      position:
        x: 2034
        y: 507.5
      positionAbsolute:
        x: 2034
        y: 507.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.0-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: 9ea96503-afbc-4366-b4d2-571b53768cd0
          role: system
          text: '你是用户意图分析器，需要分析用户的输入


            分析规则

            1. 如果用户明确提到经典名称，直接采用

            2. 如果未指定，根据内容判断最适合的经典

            3. 提取核心创作主题  

            4. 判断情感基调'
        - id: 22fc0f47-0b43-4785-ad94-2bc167b3ffce
          role: user
          text: '{{#sys.query#}}'
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              创作主题:
                description: 核心创作意图，简洁准确
                maxLength: 30
                minLength: 2
                type: string
              情感基调:
                description: 情感倾向描述，可以是复合情感
                maxLength: 15
                minLength: 1
                type: string
              明确度:
                enum:
                - 明确指定
                - 主题表达
                - 情感倾诉
                - 随意对话
                type: string
              经典选择:
                enum:
                - 周易
                - 论语
                - 孟子
                - 尚书
                - 礼记
                - 仪礼
                - 周礼
                - 易传
                - 春秋左氏传
                - 春秋谷梁传
                - 春秋公羊传
                type: string
            required:
            - 经典选择
            - 创作主题
            - 情感基调
            - 明确度
            type: object
        structured_output_enabled: true
        title: 意图分析节点
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1756961820611'
      position:
        x: 364
        y: 370.5
      positionAbsolute:
        x: 364
        y: 370.5
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: 意图转换
        type: template-transform
        variables:
        - value_selector:
          - '1756961820611'
          - structured_output
          value_type: object
          variable: arg1
      height: 53
      id: '1756963012326'
      position:
        x: 698
        y: 245.5
      positionAbsolute:
        x: 698
        y: 245.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: 规则转换
        type: template-transform
        variables:
        - value_selector:
          - '1756961775730'
          - result
          value_type: array[object]
          variable: arg1
      height: 53
      id: '1756963597193'
      position:
        x: 2368
        y: 507.5
      positionAbsolute:
        x: 2368
        y: 507.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: 风格域转换
        type: template-transform
        variables:
        - value_selector:
          - '1756699728276'
          - result
          value_type: array[object]
          variable: arg1
      height: 53
      id: '1756965735142'
      position:
        x: 2368
        y: 245.5
      positionAbsolute:
        x: 2368
        y: 245.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: 正典域转换
        type: template-transform
        variables:
        - value_selector:
          - '1756953941881'
          - result
          value_type: array[object]
          variable: arg1
      height: 53
      id: '1756965762105'
      position:
        x: 2368
        y: 376.5
      positionAbsolute:
        x: 2368
        y: 376.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0
          mode: chat
          name: gemini-2.5-pro
          provider: langgenius/gemini/google
        prompt_template:
        - id: c2bac84e-6f1d-4700-b290-67461895de0f
          role: system
          text: '你是AI诗人"陆家明"的修改专家。基于专门的修改指导进行精确优化。



            修改任务: {{#1757044544111.structured_output.核心任务#}}


            必须遵守: {{#1757044544111.structured_output.硬性约束#}}


            修改指导: {{#1757044544111.structured_output.修改指导#}}


            必须保护: {{#1757044544111.structured_output.保护要素#}}


            修改程度: {{#1757044544111.structured_output.修改范围#}}



            原作品: {{#1756699910424.text#}}



            请基于以上结构化指导进行修改，直接输出修改后的诗歌作品。


            以下是你的改动约束：


            1. 从引文素材中选择最贴合主题的古典引文{{#1757048560841.output#}}

            2. 严格按照检索到的格式规范进行创作{{#1756963597193.output#}}

            3. 参考风格参考的语言特色和表达方式{{#1756965735142.output#}}

            4. 围绕创作主题进行现代诗歌创作'
        - id: fd55064b-6d96-49bd-94bc-034c625d0511
          role: user
          text: 执行修改任务。
        selected: false
        title: G2
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '17569669412190'
      position:
        x: 5799
        y: 396.5
      positionAbsolute:
        x: 5799
        y: 396.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: D1转换
        type: template-transform
        variables:
        - value_selector:
          - '1756701800237'
          - structured_output
          value_type: object
          variable: arg1
      height: 53
      id: '1756967073379'
      position:
        x: 4463
        y: 422
      positionAbsolute:
        x: 4463
        y: 422
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params: {}
          mode: chat
          name: gemini-2.5-pro
          provider: langgenius/gemini/google
        prompt_config:
          jinja2_variables:
          - value_selector:
            - '1756699728276'
            - result
            variable: result
        prompt_template:
        - edition_type: basic
          id: 034d16b8-8ae1-4b56-9db6-45ddeabcfd17
          jinja2_text: ''
          role: system
          text: '你是AI文学批评家"判官"，专门负责诗歌评审环节。你需要基于检索到的评审标准对诗歌进行严格评估。


            知识库参考：

            {{#1756965762105.output#}}

            {{#1756965735142.output#}}

            规则格式参考：

            {{#1756963597193.output#}}


            评估任务：

            1. 检查结构完整性（标题格式、首句规则、篇幅控制）

            2. 验证引文真实性（引文格式、出处匹配、内容核实）  

            3. 评估风格保真度（与系列基线的相似度）

            4. 判断证据充足度（知识库支撑程度）

            5. 生成错误码（如发现问题）

            6. 提供改进建议（针对性指导）



            评估标准：

            硬门禁检查（必须全部通过）：

            - 标题格式：严格遵循系列格式要求

            - 系列首句：特殊首句规则 

            - 正文篇幅：≤80字（不含标题和引文）

            - 引文验证：格式正确、出处匹配、内容真实



            软指标评估：

            - 风格保真度：0.00-1.00，≥0.40为合格

            - 证据充足度：高/中/低



            裁决逻辑：

            发表条件：所有硬门禁通过 且 风格保真度≥0.40

            驳回条件：任一硬门禁失败 或 风格保真度<0.40



            错误码系统：

            TITLE_FORMAT_INVALID：标题格式错误

            CHAPTER_NAME_INVALID：篇章名不在允许范围  

            FIRST_LINE_CONFLICT：系列首句互斥失败

            LENGTH_EXCEEDS：正文字数超出80字限制

            CITATION_FORMAT_INVALID：引文格式错误

            CITATION_NOT_FOUND_IN_CANON：引文在正典域未找到

            CITATION_SOURCE_MISMATCH：引文出处与系列不匹配

            STYLE_FAITHFULNESS_LOW：风格保真度过低



            改进建议原则：

            1. 具体可操作，明确指出问题所在

            2. 避免触发词，不在建议中使用"发表"或"驳回"等路由关键词

            3. 建设性指导，重点提升而非纯粹批评

            4. 基于检索到的评审标准提供针对性修改方向



            直接输出JSON格式评估结果，无需解释过程。'
        - id: fddcb772-7ef9-4fd8-8aec-4959cd67ab68
          role: user
          text: '{{#17569669412190.text#}}'
        selected: false
        structured_output:
          schema:
            properties:
              引文验证状态:
                description: 引文格式、出处匹配、真实性核验结果
                enum:
                - 通过
                - 失败
                - 无引文
                type: string
              改进建议:
                description: 具体可操作的改进建议，无问题时为空字符串
                type: string
              最终裁决:
                description: 基于所有评估维度的最终裁决
                enum:
                - 发表
                - 驳回
                type: string
              结构完整性:
                description: 标题格式、首句规则、篇幅控制的整体检查结果
                enum:
                - 合规
                - 不合规
                type: string
              证据充足度:
                description: 知识库支撑和论证逻辑的充分程度
                enum:
                - 高
                - 中
                - 低
                type: string
              错误码:
                description: 逗号分隔的错误码列表，无错误时为空字符串
                type: string
              风格保真度:
                description: 与系列基线的风格相似度评分，取值范围0-1
                maximum: 1
                minimum: 0
                type: number
            required:
            - 最终裁决
            - 结构完整性
            - 引文验证状态
            - 风格保真度
            - 证据充足度
            - 错误码
            - 改进建议
            type: object
        structured_output_enabled: true
        title: D2
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '17569676735610'
      position:
        x: 6133
        y: 396.5
      positionAbsolute:
        x: 6133
        y: 396.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 10390c6d-c99e-4f62-88b3-a1d2d1bbb725
            value: 发表
            varType: string
            variable_selector:
            - '17569676735610'
            - structured_output
            - 最终裁决
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: 条件分支
        type: if-else
      height: 125
      id: '17569679215630'
      position:
        x: 6467
        y: 396.5
      positionAbsolute:
        x: 6467
        y: 396.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: D2转换
        type: template-transform
        variables:
        - value_selector:
          - '17569676735610'
          - structured_output
          value_type: object
          variable: arg1
      height: 53
      id: '17569681454790'
      position:
        x: 7226
        y: 442
      positionAbsolute:
        x: 7226
        y: 442
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 1
          mode: chat
          name: chatgpt-4o-latest
          provider: langgenius/openai/openai
        prompt_template:
        - id: e6b6bbde-ae65-46e4-a6a5-15f99549e935
          role: system
          text: '你是陆家花园诗歌元宇宙诗歌创作BOT的最后一环。


            在前序的工作流程中，前序节点已经完成了针对用户输入的诗歌创作


            你需要保持和{{#conversation.opening#}}、{{#1756970904564.text#}}、{{#17569737246690.text#}}的一致性，并生成一句合适的“俏皮话”，要求如下：

            1、结尾要能自然地引出前序节点生成的诗

            2、控制在30个字以内。

            3、语言风格学习{{#1756978099539.output#}}


            注意，是要你生成俏皮话，而不是让你进行诗歌创作，诗歌创作前序节点已完成严禁你在回复中生成诗歌！！！！！！

            '
        selected: false
        title: CHAT3
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1756968473773'
      position:
        x: 4129
        y: 262
      positionAbsolute:
        x: 4129
        y: 262
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 1
          mode: chat
          name: chatgpt-4o-latest
          provider: langgenius/openai/openai
        prompt_template:
        - id: e6b6bbde-ae65-46e4-a6a5-15f99549e935
          role: system
          text: '你是陆家花园诗歌元宇宙诗歌创作BOT的最后一环。


            在前序的工作流程中，前序节点已经通过一次修改，完成了针对用户输入的诗歌创作。


            你需要保持和{{#conversation.opening#}}、{{#1756970904564.text#}}、{{#17569737246690.text#}}的一致性，并生成一句合适的“俏皮话”，要求如下：

            1、用第一人称自然地表达你已针对用户的需求已经改了一稿。

            2、结尾要能自然地引出前序节点生成的诗

            3、控制在50个字以内。

            4、语言风格学习{{#1756978099539.output#}}


            注意，是要你生成俏皮话，而不是让你进行诗歌创作，诗歌创作前序节点已完成严禁你在回复中生成诗歌！！！！！！'
        selected: false
        title: CHAT4
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '17569687362650'
      position:
        x: 6892
        y: 282
      positionAbsolute:
        x: 6892
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '


          {{#17569687362650.text#}}


          {{#17569669412190.text#}}'
        desc: ''
        selected: false
        title: 直接回复
        type: answer
        variables: []
      height: 104
      id: '17569688050830'
      position:
        x: 7226
        y: 282
      positionAbsolute:
        x: 7226
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 1
          mode: chat
          name: chatgpt-4o-latest
          provider: langgenius/openai/openai
        prompt_template:
        - id: e6b6bbde-ae65-46e4-a6a5-15f99549e935
          role: system
          text: '你是陆家花园诗歌元宇宙诗歌创作BOT的最后一环。



            前序节点通过两次修改，完成了针对用户输入的诗歌创作。


            你需要保持和{{#conversation.opening#}}、{{#1756970904564.text#}}、{{#17569737246690.text#}}的一致性，并生成一句合适的“俏皮话”，要求如下：

            1、用第一人称自然地表达你已针对用户的需求已经改了两稿，你已经到尽力了。

            2、结尾要能自然地引出前序节点生成的诗

            3、控制在65个字以内。

            4、语言风格学习{{#1756978099539.output#}}


            注意，是要你生成俏皮话，而不是让你进行诗歌创作，诗歌创作前序节点已完成严禁你在回复中生成诗歌！！！！！！'
        selected: false
        title: CHAT5
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '17569688353670'
      position:
        x: 8896
        y: 416.5
      positionAbsolute:
        x: 8896
        y: 416.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '


          {{#17569688353670.text#}}


          {{#17570479883380.text#}}'
        desc: ''
        selected: false
        title: 直接回复
        type: answer
        variables: []
      height: 104
      id: '17569688395770'
      position:
        x: 9230
        y: 416.5
      positionAbsolute:
        x: 9230
        y: 416.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '{{#1756970904564.text#}}'
        desc: ''
        selected: false
        title: 直接回复
        type: answer
        variables: []
      height: 104
      id: '1756970888582'
      position:
        x: 2368
        y: 612
      positionAbsolute:
        x: 2368
        y: 612
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 50
        model:
          completion_params:
            temperature: 1
          mode: chat
          name: chatgpt-4o-latest
          provider: langgenius/openai/openai
        prompt_config:
          jinja2_variables: []
        prompt_template:
        - edition_type: basic
          id: df0f7287-930a-40dd-af59-e835523b4fdc
          role: system
          text: '你是陆家花园诗歌元宇宙诗歌创作BOT的氛围调节器。


            整个BOT的工作流很长，为了避免用户等待期间时期耐心，你需要结合用户的输入，生成一个合适的回复。


            你的前序环节是用户意图分析器，分析结果如下{{#1756963012326.output#}}


            你需要根据{{#conversation.opening#}}，生成一句合适的“俏皮话”，要求如下：

            1、表示你已经掌握了用户的需求

            2、表达你已经开始创作

            3、不能以任何形式流露你在使用分析器分析用户意图

            4、需要一定的时间，请用户耐心

            5、要结合分析器对用户心情的判断

            6、字数控制在50字以内

            7、你和用户是平等的，不用尊称

            8、语言风格学习{{#1756978099539.output#}}'
        selected: false
        title: CHAT1
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1756970904564'
      position:
        x: 2034
        y: 638.5
      positionAbsolute:
        x: 2034
        y: 638.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        items:
        - input_type: constant
          operation: set
          value: '你好，我是陆家明，陆家花园的主理人


            这里是我练习如何模仿吴任几先生写诗的地方


            不管你说什么，我都会尝试用一首诗来回复你


            我已经准备好了。你想和我聊点儿什么？'
          variable_selector:
          - conversation
          - opening
          write_mode: over-write
        selected: false
        title: 变量赋值
        type: assigner
        version: '2'
      height: 85
      id: '1756973331166'
      position:
        x: 364
        y: 245.5
      positionAbsolute:
        x: 364
        y: 245.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 1
          mode: chat
          name: chatgpt-4o-latest
          provider: langgenius/openai/openai
        prompt_template:
        - id: df0f7287-930a-40dd-af59-e835523b4fdc
          role: system
          text: '你是陆家花园诗歌元宇宙诗歌创作BOT的氛围调节器。


            整个BOT的工作流很长，为了避免用户等待期间时期耐心，你需要结合用户的输入，生成一个合适的回复。


            你的前序环节是诗歌生成器，生成结果如下{{#1756699910424.text#}}


            这个结果需要等待判别器的鉴定，才能给用户呈现。


            你需要保持和{{#conversation.opening#}}和{{#1756970904564.text#}}的一致性，并生成一句合适的“俏皮话”，要求如下：

            1、表示你已经初步完成了构思，要接着如色

            2、不能以任何形式流露你在使用判别器鉴定

            3、需要一定的时间，请用户耐心

            4、不能直接呈现{{#1756699910424.text#}}的任何输出结果，保持神秘感

            5、字数控制在50字以内

            6、语言风格学习{{#1756978099539.output#}}'
        selected: false
        title: CHAT2
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '17569737246690'
      position:
        x: 3036
        y: 376.5
      positionAbsolute:
        x: 3036
        y: 376.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '


          {{#17569737246690.text#}}'
        desc: ''
        selected: false
        title: 直接回复
        type: answer
        variables: []
      height: 104
      id: '17569738733280'
      position:
        x: 3370
        y: 376.5
      positionAbsolute:
        x: 3370
        y: 376.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        dataset_ids:
        - 1Y1WQbwVfkwHf+CfRVdWqWVe2lrJ0yLoyYVIYwucnxA0UN2hn0DQlGJtsdXZIlJT
        desc: ''
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: reranking_model
          reranking_model:
            model: jina-reranker-m0
            provider: langgenius/jina/jina
          top_k: 4
        query_variable_selector:
        - conversation
        - chattone
        retrieval_mode: multiple
        selected: false
        title: CHAT语气检索
        type: knowledge-retrieval
      height: 91
      id: '1756977828986'
      position:
        x: 1366
        y: 637.5
      positionAbsolute:
        x: 1366
        y: 637.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: 语气转换
        type: template-transform
        variables:
        - value_selector:
          - '1756977828986'
          - result
          value_type: array[object]
          variable: arg1
      height: 53
      id: '1756978099539'
      position:
        x: 1700
        y: 637.5
      positionAbsolute:
        x: 1700
        y: 637.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        items:
        - input_type: constant
          operation: set
          value: 检索吴任几的诗集，提炼他说话的语气
          variable_selector:
          - conversation
          - chattone
          write_mode: over-write
        selected: false
        title: 变量赋值 2
        type: assigner
        version: '2'
      height: 85
      id: '1756978323864'
      position:
        x: 1032
        y: 637.5
      positionAbsolute:
        x: 1032
        y: 637.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-pro
          provider: langgenius/gemini/google
        prompt_template:
        - id: e3cb5693-d50f-4000-9cc2-0233a372bea1
          role: system
          text: '你是AI诗歌修改指导专家，负责将判别器D1的评估反馈转换为生成器G2的精准修改指导。



            分析D1的结构化评估结果，结合原作品内容，生成针对性的、可操作的修改指导。



            输入分析

            D1评估结果：{{#1756967073379.output#}}

            G1原作品：{{#1756699910424.text#}}



            转换逻辑



            1. 核心任务识别

            基于D1的"改进建议"和"错误码"，用1句话概括本次修改的核心焦点：

            - 风格问题(STYLE_FAITHFULNESS_LOW)：聚焦风格调整

            - 结构问题(TITLE_FORMAT_INVALID等)：聚焦格式修正

            - 引文问题(CITATION_*)：聚焦引文处理

            - 篇幅问题(LENGTH_EXCEEDS)：聚焦内容精简



            2. 硬性约束提取

            必须包含基础约束，根据错误码添加针对性约束：

            - "正文字数严格≤80字（不含标题和引文）"

            - "保持原有格式规范要求"

            - 根据具体错误码添加特定约束



            3. 修改指导生成

            基于D1的"改进建议"，生成具体的、可操作的修改指导：

            - 避免使用"发表"、"驳回"等路由触发词

            - 提供明确的修改方向和方法

            - 针对具体问题给出解决方案



            4. 保护要素识别

            分析原作品，识别必须保护的核心元素：

            - 结构完整性为"合规"：保护标题和格式结构

            - 引文验证为"通过"：保护现有引文

            - 根据风格保真度情况决定是否保护语言特色



            5. 修改范围控制

            根据问题严重程度确定修改范围：

            - 风格保真度≥0.8且仅有细节问题："最小化修改"

            - 风格保真度0.5-0.8或结构问题："局部调整"  

            - 风格保真度<0.5或多项严重问题："重点修改"



            输出要求

            直接输出符合JSON Schema的结构化修改指导，无需解释过程。确保：

            1. "核心任务"简洁明确，一句话概括

            2. "硬性约束"覆盖所有必须遵守的规则

            3. "修改指导"具体可操作，避免触发词

            4. "保护要素"明确标识不可修改的部分

            5. "修改范围"合理控制修改程度'
        - id: 1c2af6d4-28ae-41ec-a211-c30a2cde1bf3
          role: user
          text: 请基于以上D1评估结果和G1原作品，生成G2的结构化修改指导。
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              保护要素:
                description: 原作品中必须保持不变的核心元素
                items:
                  type: string
                type: array
              修改指导:
                description: 具体的修改指导说明，告诉G2如何执行修改
                type: string
              修改范围:
                description: 建议的修改范围和程度，控制修改的幅度
                enum:
                - 最小化修改
                - 局部调整
                - 重点修改
                type: string
              核心任务:
                description: 本次修改的核心焦点，一句话描述最主要的修改任务
                type: string
              硬性约束:
                description: 必须严格遵守的约束条件，确保不违反基本规则
                items:
                  type: string
                type: array
            required:
            - 核心任务
            - 硬性约束
            - 修改指导
            - 保护要素
            - 修改范围
            type: object
        structured_output_enabled: true
        title: P1
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1757044544111'
      position:
        x: 4797
        y: 396.5
      positionAbsolute:
        x: 4797
        y: 396.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: G1转换
        type: template-transform
        variables:
        - value_selector:
          - '1756699910424'
          - text
          value_type: string
          variable: arg1
      height: 53
      id: '1757046836363'
      position:
        x: 3036
        y: 531
      positionAbsolute:
        x: 3036
        y: 531
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-pro
          provider: langgenius/gemini/google
        prompt_template:
        - id: e3cb5693-d50f-4000-9cc2-0233a372bea1
          role: system
          text: '你是AI诗歌修改指导专家，负责将判别器D1的评估反馈转换为生成器G2的精准修改指导。



            分析D1的结构化评估结果，结合原作品内容，生成针对性的、可操作的修改指导。



            输入分析

            D1评估结果：{{#17569681454790.output#}}

            G1原作品：{{#17569669412190.text#}}



            转换逻辑



            1. 核心任务识别

            基于D2的"改进建议"和"错误码"，用1句话概括本次修改的核心焦点：

            - 风格问题(STYLE_FAITHFULNESS_LOW)：聚焦风格调整

            - 结构问题(TITLE_FORMAT_INVALID等)：聚焦格式修正

            - 引文问题(CITATION_*)：聚焦引文处理

            - 篇幅问题(LENGTH_EXCEEDS)：聚焦内容精简



            2. 硬性约束提取

            必须包含基础约束，根据错误码添加针对性约束：

            - "正文字数严格≤80字（不含标题和引文）"

            - "保持原有格式规范要求"

            - 根据具体错误码添加特定约束



            3. 修改指导生成

            基于D2的"改进建议"，生成具体的、可操作的修改指导：

            - 避免使用"发表"、"驳回"等路由触发词

            - 提供明确的修改方向和方法

            - 针对具体问题给出解决方案



            4. 保护要素识别

            分析原作品，识别必须保护的核心元素：

            - 结构完整性为"合规"：保护标题和格式结构

            - 引文验证为"通过"：保护现有引文

            - 根据风格保真度情况决定是否保护语言特色



            5. 修改范围控制

            根据问题严重程度确定修改范围：

            - 风格保真度≥0.8且仅有细节问题："最小化修改"

            - 风格保真度0.5-0.8或结构问题："局部调整"  

            - 风格保真度<0.5或多项严重问题："重点修改"



            输出要求

            直接输出符合JSON Schema的结构化修改指导，无需解释过程。确保：

            1. "核心任务"简洁明确，一句话概括

            2. "硬性约束"覆盖所有必须遵守的规则

            3. "修改指导"具体可操作，避免触发词

            4. "保护要素"明确标识不可修改的部分

            5. "修改范围"合理控制修改程度'
        - id: 1c2af6d4-28ae-41ec-a211-c30a2cde1bf3
          role: user
          text: 请基于以上D1评估结果和G1原作品，生成G2的结构化修改指导。
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              保护要素:
                description: 原作品中必须保持不变的核心元素
                items:
                  type: string
                type: array
              修改指导:
                description: 具体的修改指导说明，告诉G2如何执行修改
                type: string
              修改范围:
                description: 建议的修改范围和程度，控制修改的幅度
                enum:
                - 最小化修改
                - 局部调整
                - 重点修改
                type: string
              核心任务:
                description: 本次修改的核心焦点，一句话描述最主要的修改任务
                type: string
              硬性约束:
                description: 必须严格遵守的约束条件，确保不违反基本规则
                items:
                  type: string
                type: array
            required:
            - 核心任务
            - 硬性约束
            - 修改指导
            - 保护要素
            - 修改范围
            type: object
        structured_output_enabled: true
        title: P2
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '17570479873910'
      position:
        x: 7560
        y: 416.5
      positionAbsolute:
        x: 7560
        y: 416.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0
          mode: chat
          name: gemini-2.5-pro
          provider: langgenius/gemini/google
        prompt_template:
        - id: c2bac84e-6f1d-4700-b290-67461895de0f
          role: system
          text: '你是AI诗人"陆家明"的修改专家。基于专门的修改指导进行精确优化。



            修改任务: {{#17570479873910.structured_output.核心任务#}}


            必须遵守: {{#17570479873910.structured_output.硬性约束#}}


            修改指导: {{#17570479873910.structured_output.修改指导#}}


            必须保护: {{#17570479873910.structured_output.保护要素#}}


            修改程度: {{#17570479873910.structured_output.修改范围#}}



            原作品: {{#17569669412190.text#}}



            请基于以上结构化指导进行修改，直接输出修改后的诗歌作品。


            以下是你的改动约束：


            1. 从引文素材中选择最贴合主题的古典引文{{#17570486136730.output#}}

            2. 严格按照检索到的格式规范进行创作{{#1756963597193.output#}}

            3. 参考风格参考的语言特色和表达方式{{#1756965735142.output#}}

            4. 围绕创作主题进行现代诗歌创作'
        - id: fd55064b-6d96-49bd-94bc-034c625d0511
          role: user
          text: 执行修改任务。
        selected: false
        title: G3
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '17570479883380'
      position:
        x: 8562
        y: 416.5
      positionAbsolute:
        x: 8562
        y: 416.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        dataset_ids:
        - dqi7IcK7A9tg+J544VDWf8biflTARzG/LIemG8W5A4CaJn7lJP/SzPKFytz2ON6J
        desc: ''
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: reranking_model
          reranking_model:
            model: jina-reranker-m0
            provider: langgenius/jina/jina
          top_k: 4
        query_variable_selector:
        - '1757044544111'
        - structured_output
        - 核心任务
        retrieval_mode: multiple
        selected: false
        title: 正典域知识库检索2
        type: knowledge-retrieval
      height: 91
      id: '1757048439474'
      position:
        x: 5131
        y: 396.5
      positionAbsolute:
        x: 5131
        y: 396.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: 正典域转换2
        type: template-transform
        variables:
        - value_selector:
          - '1757048439474'
          - result
          value_type: array[object]
          variable: arg1
      height: 53
      id: '1757048560841'
      position:
        x: 5465
        y: 396.5
      positionAbsolute:
        x: 5465
        y: 396.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        dataset_ids:
        - dqi7IcK7A9tg+J544VDWf8biflTARzG/LIemG8W5A4CaJn7lJP/SzPKFytz2ON6J
        desc: ''
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: reranking_model
          reranking_model:
            model: jina-reranker-m0
            provider: langgenius/jina/jina
          top_k: 4
        query_variable_selector:
        - '17570479873910'
        - structured_output
        - 核心任务
        retrieval_mode: multiple
        selected: false
        title: 正典域知识库检索3
        type: knowledge-retrieval
      height: 91
      id: '17570486115590'
      position:
        x: 7894
        y: 416.5
      positionAbsolute:
        x: 7894
        y: 416.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        selected: false
        template: '{{ arg1 }}'
        title: 正典域转换3
        type: template-transform
        variables:
        - value_selector:
          - '1757048439474'
          - result
          value_type: array[object]
          variable: arg1
      height: 53
      id: '17570486136730'
      position:
        x: 8228
        y: 416.5
      positionAbsolute:
        x: 8228
        y: 416.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: -287.49586697526547
      y: 165.52611227665852
      zoom: 0.25
