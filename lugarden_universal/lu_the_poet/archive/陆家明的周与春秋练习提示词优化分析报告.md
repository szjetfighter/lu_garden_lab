# 陆家明的《周与春秋》练习 提示词优化分析报告

本文档整合了“选择自由，验证刚性”的方法论取向，对生成器 G 与判别器 D 的提示词进行系统优化，并引入可复验的风格保真度量化方案，目标是：让陆家明稳定、长效地产出高质量诗歌创作。

## 1. 目标与方法论基线
- 业务目标：稳定、长效、高质量的系列化诗歌创作。
- 方法论：用户端对抗优化（G 生成 → D 判别 → 条件分支/迭代），以硬门禁约束结构合规与引文真实性，以软评分辅助排序与诊断。
- 原DSL优势：强规则（标题/首句/字数）+ RAG 注入 + 对抗循环。
- 原DSL主要问题：
  - 引文真实性核验依赖自然语言判断，缺少刚性基准。
  - 判决不可机读，路由易被“包含关键字”误触发。
  - 软分数（保真度/置信度）未校准，易产生伪精确。

## 2. 核心原则
- 选择自由：G 的创作与引文选择可面向“完整正典宇宙”（《周易》《春秋公羊传》《孟子》全域），不受风格RAG限制。
- 验证刚性：D 的引文核验只认可“唯一正典语料库”的命中与定位（可允许异文/断句近似匹配）。未命中则不合规。
- 域解耦：风格域（吴任几与项目语料）与正典域（儒家三部全域）分离，风格域不参与引文选择与核验。
- 决策结构：硬门禁先判（结构/引文），软评分后用（排序/诊断），迭代收敛有兜底。

## 3. 生成器 G 的提示词优化
为保证外显仍是“纯诗文本”，下述步骤在内部思考中完成，对外不暴露过程。

1) 决策先于写作（隐式链）：
- 选择系列（观我生/雨木冰/是折枝）→ 确立主题与意象群 → 规划转折与句群长度。

2) 引文策略（仅正典域，证实优先）：
- 仅当正典域可定位“书目·篇章 + 原句/可对齐断句”时才引用；否则本次不引用（仍可完整输出标题+正文）。
- “全新性”优先：若候选引文与“风格语料已用引文”高度相近，则改换为另一处更贴合主题的段落，避免复用。
- 正典命名规范：
  - 周易：卦/爻/彖/象；
  - 公羊传：卷/年/条；
  - 孟子：卷篇/章句；
  使用唯一规范拼写，避免同物异名。

3) 风格锚点（正负清单）：
- 正向：意象群、句式节律、语域张力、典型比喻范式。
- 负向：陈词滥调词表、禁用语气/网络腔、元叙事痕迹。

4) 合规自检（输出前一次内部重写）：
- 标题模板（“篇章名 - 主题”）/ 系列首句互斥 / 正文 ≤ 80 字 / 禁词与结构规范。

5) 采样建议（方法论层）：
- 中低温度 + 小幅冗余 token，增强可复现性；长度控制与多样性适度均衡。

## 4. 判别器 D 的提示词优化

1) 验证顺序（硬门禁 → 软评分）：
- 结构合规四连判：标题模板、系列首句互斥、正文 ≤ 80 字、（若存在）引文格式。
- 引文真实性核验（仅正典域）：命中“书目·篇章 + 原句/近似断句”视为可证实；未命中 → 结构不合规 → 直接“驳回”。

2) 结构化可机读输出（行首锚定，减少路由脆弱性）：
- 最终裁决: 发表 | 驳回
- 结构完整性: 合规 | 不合规
- 风格保真度: 0.00–1.00 （软指标，用于排序/诊断，不直接门禁）
- 证据充足度: 高 | 中 | 低（或“命中条数/违规计数”等可机读证据）
- 给生成器的改进建议: （最多3条，手术化、对应失败项）

3) 错误码与建议（示例）：
- CITATION_NOT_FOUND_IN_CANON（引文未在正典域命中）：建议“不引用”或“更换为可证实句”。
- CITATION_FORMAT_INVALID（命名/格式不规范）。
- FIRST_LINE_CONFLICT（系列首句互斥失败）。
- LENGTH_EXCEEDS（篇幅超限）。
- STYLE_FAITHFULNESS_LOW（软分偏低）。

4) 兜底策略：
- 末轮仍“驳回”，输出“最佳改写路径”（仅两处关键修改）与“推荐系列”，确保后续重试可收敛。

## 5. 风格保真度的标准化量化
定位：软指标，用于排序/诊断，不作硬门禁；由黄金集校准。

1) 分系列基线与黄金集：
- 每系列建立人类原作基线：语义嵌入质心 + 风格特征分布（均值/协方差）。
- 准备黄金集（人类原作/AI仿作/边界稿），留出验证集做阈值与校准。

2) 多信号合成（示例）：
- 语义相似 E：候选与系列基线的嵌入余弦相似度（句级/篇级稳健聚合）。
- 风格签名 F：可解释特征向量的相似度（行长分布、断行/标点率、用词稀疏度、功能词占比、n-gram 分布、意象词表/句式模板命中）。
- 意象一致 I：与系列意象词典的加权命中/Jaccard（上限截断，防“刷分”）。
- 节律相似 R：行长分布与基准分布的距离（如 Wasserstein）转相似度。
- 惩罚项：
  - 抄袭 P：n-gram 重合（ROUGE/BLEU/LCS）超阈扣分；
  - 离群 O：嵌入距离异常远或最近邻过近均扣分（出圈/过拟合）。

3) 组合与归一化：
- 原始分：S_raw = αE + βF + γI + δR − λP − μO（α…μ 由验证集拟合）。
- 归一化：S = σ(k·(S_raw − b))，σ 为 Logistic，k/b 由 Platt/分箱校准，使 S 近似“人类风格概率”。

4) 阈值与解释：
- 仅在“结构/引文”硬门禁通过后查看 S；τ_publish ≈ 0.70 用于灰度分层（非硬闸门）。
- 输出分项得分与主要扣分因子（如 P/O 触发），为 G 的“最小修改路径”提供指引。

5) 运行与治理：
- 分系列建模，避免跨系列漂移；定期监控校准度（可靠性图/Brier）。
- 防刷分：意象/模板命中设上限，多样性惩罚鼓励“在分布内但非复刻”。

## 6. 正典库与引文验证口径
- 正典域作为唯一验证基准（《周易》《春秋公羊传》《孟子》全域），可允许异文/断句近似匹配；未命中即视为不可证实 → 不引用。
- 词表与命名规范纳入“判据口径”，降低歧义（卦名/爻辞、纪年/条目、卷篇/章句）。
- 选择自由：G 可从模型内置知识提出候选，但是否可用由正典域验证决定。

## 7. G×D 契约与迭代收敛
- 错误码对齐：D 输出错误码，G 按码点最小修改，不破坏已合规部分。
- 建议克制：D 建议不出现“发表/驳回”等关键字，避免路由误触；最多 3 条、对应失败项。
- 失败兜底：末轮失败返回“最佳改写路径”与“推荐系列”，下次迭代可快速收敛。

## 8. 风险与护栏
- 路由稳健：以“行首锚定键名 + 精确匹配”替代“包含关键字”。
- 迭代护栏：最大轮次/超时/成本上限明确化（会话或环境变量）。
- 可观测性：记录样本/评语/分数/用时/成本，支撑后续校准与策略优化。

## 9. 提示片段（可直接嵌入到现有节点的文案要点）

### 9.1 G（生成器）系统提示要点
- 仅当在“正典域（《周易》《春秋公羊传》《孟子》全域）”能定位“书目·篇章 + 原句/可对齐断句”时，才在诗前添加引文；否则不引用。
- 引文应力求“全新”，若与既有引用高度相近，请改换其他更贴合主题的段落。
- 外显输出必须是“纯诗文本”（标题/引文/正文），不得出现任何说明、键名或结构提示。
- 标题模板、系列首句互斥与 ≤ 80 字为硬约束；不符合则在内部重写一次再输出。

### 9.2 D（判别器）系统提示要点
- 先判结构合规（标题/首句/字数），不合规则直接“驳回”。
- 有引文时，仅在“唯一正典语料库”核验；未命中视为“不合规 → 驳回”。
- 严格按以下行首键名输出（仅第一行允许出现“发表/驳回”）：
  - 最终裁决: 发表 | 驳回
  - 结构完整性: 合规 | 不合规
  - 风格保真度: 0.00–1.00
  - 证据充足度: 高 | 中 | 低（或命中条数/违规计数）
  - 给生成器的改进建议: …（≤ 3 条，手术化）
- 使用错误码（如 CITATION_NOT_FOUND_IN_CANON / LENGTH_EXCEEDS），与建议逐条对应。

## 10. 参考（平台能力）
- 工作流/节点编排（条件分支/循环/结构化输出）：Dify 文档
  - 工作流概览：https://docs.dify.ai/zh-hans/guides/workflow/readme
  - 编排节点：https://docs.dify.ai/zh-hans/guides/workflow/orchestrate-node
- 知识库与引用归属/召回测试：
  - 知识库：https://docs.dify.ai/zh-hans/guides/knowledge-base
  - 召回测试与引用归属：https://docs.dify.ai/zh-hans/guides/knowledge-base/retrieval-test-and-citation
- 连接外部知识库 / MCP 工具：
  - 外部知识库：https://docs.dify.ai/zh-hans/guides/knowledge-base/connect-external-knowledge-base
  - MCP 工具：https://docs.dify.ai/zh-hans/guides/tools/mcp

—— 报告完 ——





