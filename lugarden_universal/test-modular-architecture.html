<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>模块化架构测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .form-input { border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; border-radius: 0.375rem; width: 100%; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: bold; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background-color: #2563eb; color: white; }
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-secondary { background-color: #4b5563; color: white; }
        .btn-secondary:hover { background-color: #374151; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">模块化架构测试</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- 测试项目 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">测试项目</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">测试名称</label>
                        <input type="text" id="test-name" class="form-input" value="测试宇宙">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">测试代码</label>
                        <input type="text" id="test-code" class="form-input" value="test_universe">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">测试类型</label>
                        <select id="test-type" class="form-input">
                            <option value="zhou_spring_autumn">周与春秋</option>
                            <option value="maoxiaodou">毛小豆</option>
                        </select>
                    </div>
                    <button id="test-create-btn" class="btn btn-primary w-full">创建测试宇宙</button>
                </div>
            </div>
            
            <!-- 测试结果 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">测试结果</h2>
                <div id="test-results" class="space-y-2 text-sm">
                    <div class="text-gray-500">等待测试...</div>
                </div>
            </div>
        </div>
        
        <!-- 功能测试 -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">功能测试</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button id="test-universes-api" class="btn btn-secondary">测试宇宙API</button>
                <button id="test-module-loading" class="btn btn-secondary">测试模块加载</button>
                <button id="test-ui-rendering" class="btn btn-secondary">测试UI渲染</button>
            </div>
        </div>
    </div>

    <script>
        // 测试结果记录
        function logResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `p-2 rounded ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                'bg-blue-100 text-blue-800'
            }`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }

        // 测试宇宙API
        async function testUniversesAPI() {
            try {
                logResult('开始测试宇宙API...');
                const response = await fetch('/api/admin/universes', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    logResult(`宇宙API测试成功，返回 ${data.length} 个宇宙`, 'success');
                } else {
                    logResult(`宇宙API测试失败: ${response.status}`, 'error');
                }
            } catch (error) {
                logResult(`宇宙API测试异常: ${error.message}`, 'error');
            }
        }

        // 测试模块加载
        async function testModuleLoading() {
            try {
                logResult('开始测试模块加载...');
                
                // 测试动态导入
                const modulePath = '/assets/universe-modules/zhou_spring_autumn.js';
                const module = await import(modulePath);
                
                if (module && module.default) {
                    logResult('模块加载测试成功', 'success');
                } else {
                    logResult('模块加载失败：模块结构不正确', 'error');
                }
            } catch (error) {
                logResult(`模块加载测试异常: ${error.message}`, 'error');
            }
        }

        // 测试UI渲染
        function testUIRendering() {
            try {
                logResult('开始测试UI渲染...');
                
                // 创建测试元素
                const testDiv = document.createElement('div');
                testDiv.className = 'bg-blue-100 p-4 rounded mb-4';
                testDiv.innerHTML = `
                    <h3 class="font-bold">UI渲染测试</h3>
                    <p>这是一个测试元素，用于验证UI渲染功能</p>
                `;
                
                document.body.appendChild(testDiv);
                
                // 3秒后移除
                setTimeout(() => {
                    if (testDiv.parentNode) {
                        testDiv.parentNode.removeChild(testDiv);
                    }
                }, 3000);
                
                logResult('UI渲染测试成功', 'success');
            } catch (error) {
                logResult(`UI渲染测试异常: ${error.message}`, 'error');
            }
        }

        // 创建测试宇宙
        async function createTestUniverse() {
            try {
                const name = document.getElementById('test-name').value;
                const code = document.getElementById('test-code').value;
                const type = document.getElementById('test-type').value;
                
                logResult(`开始创建测试宇宙: ${name} (${code})`);
                
                const response = await fetch('/api/admin/universes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        name,
                        code,
                        type,
                        description: '这是一个测试宇宙',
                        status: 'draft'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    logResult(`测试宇宙创建成功: ${data.id}`, 'success');
                } else {
                    const errorText = await response.text();
                    logResult(`测试宇宙创建失败: ${errorText}`, 'error');
                }
            } catch (error) {
                logResult(`测试宇宙创建异常: ${error.message}`, 'error');
            }
        }

        // 绑定事件
        document.getElementById('test-universes-api').addEventListener('click', testUniversesAPI);
        document.getElementById('test-module-loading').addEventListener('click', testModuleLoading);
        document.getElementById('test-ui-rendering').addEventListener('click', testUIRendering);
        document.getElementById('test-create-btn').addEventListener('click', createTestUniverse);

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', () => {
            logResult('测试页面加载完成');
        });
    </script>
</body>
</html>
