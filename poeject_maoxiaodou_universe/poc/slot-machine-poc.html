<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘¸è¯—å®‡å®™ - è€è™æœºPOC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
        }
        
        h1 {
            margin-bottom: 20px;
            font-size: 28px;
            background: linear-gradient(90deg, #f093fb, #f5576c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .slot-machine {
            background: linear-gradient(145deg, #2d2d44, #1a1a2e);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 2px solid #3d3d5c;
        }
        
        .matrix {
            display: grid;
            grid-template-columns: repeat(5, 70px);
            grid-template-rows: repeat(3, 70px);
            gap: 8px;
            background: #0d0d15;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .cell {
            background: linear-gradient(145deg, #1e1e30, #2a2a40);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            border: 1px solid #3d3d5c;
            transition: all 0.3s;
            overflow: hidden;
        }
        
        .cell.spinning {
            animation: blur-spin 0.1s linear infinite;
        }
        
        .cell.win {
            background: linear-gradient(145deg, #2d4a2d, #1a3a1a);
            border-color: #4ade80;
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.5);
        }
        
        @keyframes blur-spin {
            0% { transform: translateY(-5px); opacity: 0.7; }
            50% { transform: translateY(5px); opacity: 0.5; }
            100% { transform: translateY(-5px); opacity: 0.7; }
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        button {
            padding: 15px 40px;
            font-size: 18px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .spin-btn {
            background: linear-gradient(90deg, #f093fb, #f5576c);
            color: white;
        }
        
        .spin-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(240, 147, 251, 0.4);
        }
        
        .spin-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 25px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            min-height: 120px;
            max-width: 400px;
        }
        
        .result h3 {
            color: #f093fb;
            margin-bottom: 10px;
        }
        
        .result .wins {
            font-size: 14px;
            color: #4ade80;
            margin-bottom: 10px;
        }
        
        .result .stanza {
            font-size: 16px;
            line-height: 1.8;
            color: #e0e0e0;
            font-style: italic;
        }
        
        .result .no-win {
            color: #888;
            font-size: 16px;
        }
        
        .legend {
            margin-top: 20px;
            font-size: 12px;
            color: #888;
            text-align: center;
        }
        
        .legend span {
            margin: 0 8px;
        }
    </style>
</head>
<body>
    <h1>ğŸ° æ‘¸è¯—å®‡å®™</h1>
    
    <div class="slot-machine">
        <div class="matrix" id="matrix">
            <!-- 5åˆ— x 3è¡Œ = 15æ ¼ -->
        </div>
        
        <div class="controls">
            <button class="spin-btn" id="spinBtn" onclick="spin()">æ‘¸ è¯—</button>
        </div>
        
        <div class="result" id="result">
            <div class="no-win">ç‚¹å‡»ã€Œæ‘¸è¯—ã€å¼€å§‹</div>
        </div>
    </div>
    
    <div class="legend">
        <span>ğŸ»æ¯›å°è±†</span>
        <span>ğŸ‘”åå°‘</span>
        <span>ğŸ’æ ‹å…ˆç”Ÿ</span>
        <span>ğŸ‘©å¼ ç§‹</span>
        <span>ğŸ¢åŠå…¬å®¤</span>
        <span>ğŸ°å…„å¼Ÿä¼š</span>
        <span>ğŸšªå°é—­ç©ºé—´</span>
        <span>ğŸ»ç¤¾äº¤</span>
        <span>ğŸƒè¿åŠ¨</span>
        <span>ğŸŒ¸é™†(Wild)</span>
    </div>

    <script>
        // ç¬¦å·å®šä¹‰
        const SYMBOLS = {
            // äººç‰©ç¬¦å·ï¼ˆç¨€æœ‰ï¼‰
            maoxiaodou: { emoji: 'ğŸ»', name: 'æ¯›å°è±†', type: 'character', weight: 8 },
            huashao: { emoji: 'ğŸ‘”', name: 'åå°‘', type: 'character', weight: 8 },
            dongxiansheng: { emoji: 'ğŸ’', name: 'æ ‹å…ˆç”Ÿ', type: 'character', weight: 8 },
            zhangqiu: { emoji: 'ğŸ‘©', name: 'å¼ ç§‹', type: 'character', weight: 8 },
            // åœºæ™¯ç¬¦å·ï¼ˆå¸¸è§ï¼‰
            office: { emoji: 'ğŸ¢', name: 'åŠå…¬å®¤', type: 'scene', weight: 15 },
            brotherhood: { emoji: 'ğŸ°', name: 'å…„å¼Ÿä¼š', type: 'scene', weight: 15 },
            enclosed: { emoji: 'ğŸšª', name: 'å°é—­ç©ºé—´', type: 'scene', weight: 15 },
            social: { emoji: 'ğŸ»', name: 'ç¤¾äº¤', type: 'scene', weight: 15 },
            sports: { emoji: 'ğŸƒ', name: 'è¿åŠ¨', type: 'scene', weight: 12 },
            // Wildç¬¦å·ï¼ˆæœ€ç¨€æœ‰ï¼‰
            wild: { emoji: 'ğŸŒ¸', name: 'é™†', type: 'wild', weight: 5 }
        };

        // æ¨¡æ‹Ÿstanzaæ•°æ®
        const MOCK_STANZAS = {
            maoxiaodou: [
                'ç”Ÿæ´»ç¡®å®æ˜¯è¶Šæ¥è¶Šå¥½äº†\næˆ‘æ¯”æ¯•å•¸å¤©å‘ç°å¾—æ—©',
                'è¿™å®šå¾‹ï¼Œæˆ‘æ¯”æ¯•å•¸å¤©å‘ç°å¾—æ—©\nä½†æ˜¯æˆ‘ä¸ä¼šæ²³ç‰Œå·ä½ ',
                'æˆ‘æ‰æ˜¯çœŸæ­£çš„Aç‰‡ä¹‹ç‹\nåœ¨ä¸€ä¸ªå……æ»¡è¡¨æ¼”æ€§çš„ä¸–ç•Œ'
            ],
            huashao: [
                'ä½ å±äºåå¼±çš„å¬ç‰Œæ€ª\næœ‰å±ç”¨',
                'ç¬¬ä¸€è¦ç˜¦ã€‚å…¶æ¬¡ç™½ã€‚ç„¶åè¦ä¸å¤ªèªæ˜\næˆ‘è®©ä½ äºçš„é’±è¿˜å°‘å—'
            ],
            dongxiansheng: [
                'æˆ‘ä¾ç„¶è§‰å¾—ï¼Œå¥¹æ˜¯æˆ‘è§è¿‡\næœ€æ¸©æš–çš„äºº',
                'äº‘å—çš„ç¿»è½¦äº‹ä»¶\næ˜¯ç†è§£å…¶è¡Œä¸ºé€»è¾‘çš„å…³é”®'
            ],
            zhangqiu: [
                'è¿™æ˜¯å…¸å‹çš„ç©·äººæ€ç»´\nè¿˜å¥½è¿˜å¥½ï¼Œä½ åªæ˜¯é•¿èƒ–ï¼Œæ²¡æœ‰é•¿å¤§',
                'åœ¨èŒä¸šå†…å·å’Œèº«ä½“å†…å·çš„åŒé‡å‹åŠ›ä¸‹\nå¯»æ±‚ä¸ªäººæ„å¿—çš„è‡ªä¸»'
            ],
            office: [
                'åœ¨å…¨æ™¯æ•è§†çš„åŠå…¬ç¯å¢ƒä¸­\né˜¿ä¼Ÿåº”å¯¹ç›‘æ§ä¸å‹åŠ›',
                'RFPé¡¹ç›®çš„æˆªæ­¢æ—¥æœŸä¸´è¿‘\nèŒåœºä¸­çš„æƒåŠ›å…³ç³»å±•ç°'
            ],
            brotherhood: [
                'å¾·å·æ‰‘å…‹ç‰Œå±€ä¸­\nå…„å¼Ÿä¼šå†…éƒ¨çš„ç«æŠ€ä¸ä¿¡ä»»',
                'æ ¡å›­èµ°å»Šä¸­é’ æ´¾ä¸ç›–å¸®çš„åƒé¥­æ¯”èµ›\nå…„å¼Ÿä¼šæ³•åˆ™çš„å¥ åŸº'
            ],
            enclosed: [
                'æ¯›å°è±†åœ¨å·¥ä½œæ—¥ä¸‹åˆç‹¬è‡ªæ³¡æ¾¡\nè¿›è¡Œåè®½å¼ç‹¬ç™½',
                'åœ¨å«ç”Ÿé—´è¿›è¡Œè‡ªæˆ‘å®¡è§†\né€šè¿‡é•œå­ç¡®è®¤ç¤¾äº¤çŠ¶æ€'
            ],
            social: [
                'å•†åŠ¡å®´è¯·ä¸­çš„æƒåŠ›åšå¼ˆ\nç¤¾äº¤è¡¨æ¼”çš„èˆå°',
                'è·¨å¹´æ´¾å¯¹ä¸Š\næ‰®æ¼”å®Œç¾çš„+1è§’è‰²'
            ],
            sports: [
                'åœ¨å§œProçš„é“é¦†è¿›è¡Œèº«ä½“è®­ç»ƒ\nå­¦ä¹ æ¯”åŸºå°¼åŠ¨ä½œ',
                'è·Ÿéšé­æ•™ç»ƒè¿›è¡Œä¸€å¯¹ä¸€æ»‘å†°è¯¾\nå­¦ä¹ è·³è·ƒåŠ¨ä½œ'
            ]
        };

        // 5x3çŸ©é˜µ
        let matrix = [];
        let isSpinning = false;

        // åˆå§‹åŒ–çŸ©é˜µ
        function initMatrix() {
            const container = document.getElementById('matrix');
            container.innerHTML = '';
            matrix = [];
            
            for (let row = 0; row < 3; row++) {
                matrix[row] = [];
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${row}-${col}`;
                    cell.textContent = '?';
                    container.appendChild(cell);
                    matrix[row][col] = null;
                }
            }
        }

        // æŒ‰æƒé‡éšæœºé€‰æ‹©ç¬¦å·
        function randomSymbol() {
            const totalWeight = Object.values(SYMBOLS).reduce((sum, s) => sum + s.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const [key, symbol] of Object.entries(SYMBOLS)) {
                random -= symbol.weight;
                if (random <= 0) {
                    return key;
                }
            }
            return 'wild';
        }

        // æ£€æŸ¥è¿çº¿
        function checkWins() {
            const wins = [];
            
            for (const [symbolKey, symbol] of Object.entries(SYMBOLS)) {
                if (symbolKey === 'wild') continue; // Wildä¸å•ç‹¬è®¡ç®—
                
                let consecutiveCols = 0;
                const winningCells = [];
                
                for (let col = 0; col < 5; col++) {
                    let found = false;
                    for (let row = 0; row < 3; row++) {
                        const cellSymbol = matrix[row][col];
                        if (cellSymbol === symbolKey || cellSymbol === 'wild') {
                            found = true;
                            winningCells.push({ row, col });
                            break;
                        }
                    }
                    
                    if (found) {
                        consecutiveCols++;
                    } else {
                        break;
                    }
                }
                
                if (consecutiveCols >= 3) {
                    wins.push({
                        symbol: symbolKey,
                        columns: consecutiveCols,
                        cells: winningCells.slice(0, consecutiveCols)
                    });
                }
            }
            
            return wins;
        }

        // é€‰æ‹©stanzaï¼ˆäº¤é›†é€»è¾‘ï¼‰
        function selectStanza(wins) {
            if (wins.length === 0) return null;
            
            // ç®€åŒ–ç‰ˆï¼šæ‰¾äº¤é›†ï¼Œå¦‚æœä¸ºç©ºåˆ™å–æœ€é«˜ä»·å€¼
            const pools = wins.map(w => MOCK_STANZAS[w.symbol] || []);
            
            // å°è¯•äº¤é›†ï¼ˆç®€åŒ–ï¼šå¦‚æœå¤šä¸ªä¸­å¥–ï¼Œéšæœºé€‰æœ€é•¿è¿çº¿çš„ï¼‰
            const bestWin = wins.sort((a, b) => {
                if (b.columns !== a.columns) return b.columns - a.columns;
                // äººç‰©ä¼˜å…ˆäºåœºæ™¯
                const aType = SYMBOLS[a.symbol].type;
                const bType = SYMBOLS[b.symbol].type;
                if (aType === 'character' && bType !== 'character') return -1;
                if (bType === 'character' && aType !== 'character') return 1;
                return 0;
            })[0];
            
            const pool = MOCK_STANZAS[bestWin.symbol] || [];
            if (pool.length === 0) return null;
            
            return {
                stanza: pool[Math.floor(Math.random() * pool.length)],
                symbol: bestWin.symbol,
                columns: bestWin.columns
            };
        }

        // é«˜äº®ä¸­å¥–æ ¼å­
        function highlightWins(wins) {
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('win'));
            
            // é«˜äº®ä¸­å¥–æ ¼å­
            wins.forEach(win => {
                win.cells.forEach(({ row, col }) => {
                    document.getElementById(`cell-${row}-${col}`).classList.add('win');
                });
            });
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(wins) {
            const resultDiv = document.getElementById('result');
            
            if (wins.length === 0) {
                resultDiv.innerHTML = '<div class="no-win">ç¼˜åˆ†æœªåˆ°ï¼Œå†æ‘¸ä¸€æ¬¡ï¼Ÿ</div>';
                return;
            }
            
            const selected = selectStanza(wins);
            const winText = wins.map(w => 
                `${SYMBOLS[w.symbol].emoji}${SYMBOLS[w.symbol].name} Ã—${w.columns}åˆ—`
            ).join('ã€');
            
            resultDiv.innerHTML = `
                <h3>ğŸ‰ ä¸­å¥–ï¼</h3>
                <div class="wins">${winText}</div>
                <div class="stanza">${selected ? selected.stanza.replace(/\n/g, '<br>') : 'æ— å¯¹åº”è¯—èŠ‚'}</div>
            `;
        }

        // ä¸»é€»è¾‘ï¼šspin
        async function spin() {
            if (isSpinning) return;
            isSpinning = true;
            
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            btn.textContent = 'æ‘¸è¯—ä¸­...';
            
            // æ¸…é™¤ä¹‹å‰çš„é«˜äº®å’Œç»“æœ
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('win'));
            document.getElementById('result').innerHTML = '<div class="no-win">ğŸ² è½¬åŠ¨ä¸­...</div>';
            
            // å¼€å§‹è½¬åŠ¨åŠ¨ç”»
            const cells = document.querySelectorAll('.cell');
            cells.forEach(c => c.classList.add('spinning'));
            
            // ç”Ÿæˆæœ€ç»ˆç»“æœ
            const finalMatrix = [];
            for (let row = 0; row < 3; row++) {
                finalMatrix[row] = [];
                for (let col = 0; col < 5; col++) {
                    finalMatrix[row][col] = randomSymbol();
                }
            }
            
            // é€åˆ—åœæ­¢
            for (let col = 0; col < 5; col++) {
                await new Promise(resolve => setTimeout(resolve, 300 + col * 200));
                
                for (let row = 0; row < 3; row++) {
                    const cell = document.getElementById(`cell-${row}-${col}`);
                    cell.classList.remove('spinning');
                    const symbolKey = finalMatrix[row][col];
                    matrix[row][col] = symbolKey;
                    cell.textContent = SYMBOLS[symbolKey].emoji;
                }
            }
            
            // ç­‰å¾…æœ€åä¸€åˆ—åœæ­¢
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // æ£€æŸ¥ä¸­å¥–
            const wins = checkWins();
            highlightWins(wins);
            showResult(wins);
            
            // æ¢å¤æŒ‰é’®
            btn.disabled = false;
            btn.textContent = 'æ‘¸ è¯—';
            isSpinning = false;
        }

        // åˆå§‹åŒ–
        initMatrix();
    </script>
</body>
</html>
