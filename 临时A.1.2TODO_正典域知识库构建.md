# 临时A.1.2TODO：正典域知识库构建（基于本地EPUB文件）

> 本文为EPUB文件转换指导清单与验收标准，处理13个本地古籍EPUB文件。

## 目标
- 将13个中文古籍EPUB文件转换为结构化的简体Markdown文件集合，生成适配 Dify 父子分段模式的正典域知识库语料。
- 确保章节完整性、顺序准确性、内容纯净性，便于知识库导入和检索。

## 范围与约束
- **数据来源**：本地EPUB文件（位于 `lugarden_universal/lu_the_poet/corpus/canon/`）
- **处理要求**：
  - 语言转换：繁体转简体（使用OpenCC）
  - 内容清理：移除版权页、样式代码、导航元素、脚注等无关内容
  - 格式统一：每个文件以 `# 章节标题` 开头，内容为纯净中文文本
  - 结构保持：严格按照原书目录顺序，保留所有重要章节
- **输出规范**：独立目录结构 + 标准化Markdown文件 + YAML Front Matter元数据

## 任务列表

#### - [ ] 任务A1.2：正典域知识库构建
- **核心思想**: 基于本地EPUB文件，生成结构化、高质量的正典域Markdown语料，直接可用于Dify知识库导入与检索。
- **输入材料**：
  - 13个中文古籍EPUB文件（包括《春秋公羊传》、《周易》、《论语》、《孟子》等经典）
  - 文件位置：`lugarden_universal/lu_the_poet/corpus/canon/`
- **输出要求**：
  - 分离结构：每本书创建独立的 `书名_chapters` 目录
  - 章节拆分：按原书目录顺序，将每章保存为单独的Markdown文件
  - 文件命名：使用格式 `001_章节名.md`，保持先后顺序
  - 内容清理：移除版权页、样式代码、导航元素等无关内容，保留核心文本
  - 格式统一：每个文件以 `# 章节标题` 开头，内容为纯净的简体中文文本
- **质量标准**：
  - 章节完整性：不丢失任何重要章节
  - 顺序准确性：严格按照原书目录顺序排列
  - 内容纯净性：去除技术性标记，保留可读文本
  - 结构清晰性：便于知识库导入和检索
- **预期改动文件**：
  - `lugarden_universal/lu_the_poet/corpus/canon/周易_chapters/001_乾卦.md`
  - `lugarden_universal/lu_the_poet/corpus/canon/春秋公羊传_chapters/001_隐公.md`
  - `lugarden_universal/lu_the_poet/corpus/canon/孟子_chapters/001_梁惠王上.md`
  - `lugarden_universal/lu_the_poet/corpus/canon/conversion_report.md`
- **实际改动文件**: （执行后填写）
- **完成状态**：🔄 进行中
- **执行步骤**：
  - [x] 步骤A1.2.1：环境准备与依赖安装 ✅已完成
    - 使用 `uv` 安装Python依赖：`ebooklib`, `beautifulsoup4`, `opencc-python-reimplemented`, `pathlib`
    - 验证EPUB文件完整性和可读性
    - EPUB结构分析脚本和报告已完成
  - [ ] 步骤A1.2.2：EPUB解析与章节提取（基于详细执行策略，按序逐个转换）
    - [ ] 步骤A1.2.2-01：今文孝經转换 (4→18章) - 最简单，按h2标签拆分章节
    - [ ] 步骤A1.2.2-10：爾雅转换 (4→19类别) - 简单，按h2标签拆分词典类别  
    - [ ] 步骤A1.2.2-13：論語转换 (27→22篇章) - 中等，每篇对应HTML文档
    - [ ] 步骤A1.2.2-05：孟子转换 (18→14篇章) ⭐核心 - 7篇各分上下
    - [ ] 步骤A1.2.2-04：周禮转换 (10→6官职) - 中等，每个官职对应独立HTML
    - [ ] 步骤A1.2.2-03：周易转换 (76→74卦章) ⭐核心 - 复杂结构，64卦+十翼
    - [ ] 步骤A1.2.2-07：春秋公羊傳转换 (20→12公) ⭐核心 - 按12公分离
    - [ ] 步骤A1.2.2-02：儀禮转换 (21→17仪式) - 每个仪式对应独立HTML文档
    - [ ] 步骤A1.2.2-06：尚書转换 (73→58篇章) - 篇章最多，按TOC顺序处理
    - [ ] 步骤A1.2.2-08：春秋左氏傳转换 (18→12公) - 与公羊传类似结构
    - [ ] 步骤A1.2.2-09：春秋穀梁傳转换 (16→12公) - 三传结构一致性
    - [ ] 步骤A1.2.2-11：禮記转换 (53→49篇章) - 篇章丰富，每篇对应HTML
    - [ ] 步骤A1.2.2-12：詩經转换 (304→305首诗) - 最复杂，几乎每首一个HTML
    - 基于临时A1.2.2详细执行策略.md的精确转换方案
    - 每个子步骤完成后立即验证质量，确保无误后再进行下一个
  - [ ] 步骤A1.2.3：内容处理与转换
    - 使用 `BeautifulSoup` 清理HTML标签和样式
    - 使用 `opencc-python-reimplemented` 进行繁体转简体转换
    - 标准化文本格式：统一空白、标点符号
  - [ ] 步骤A1.2.4：结构化输出
    - 为每本书创建独立的 `书名_chapters` 目录
    - 按章节顺序生成 `001_章节名.md` 格式文件
    - 每个文件添加统一的 YAML Front Matter 元数据
  - [ ] 步骤A1.2.5：YAML Front Matter规范
    - 每个Markdown文件添加标准化元数据：
      ```yaml
      ---
      book: "书名"
      chapter: "章节名"
      chapter_number: "001"
      locator: "书名·章节名"
      source: "EPUB文件"
      converted_date: "2025-08-31"
      ---
      ```
    - 正文结构统一为：
      ```markdown
      # 章节标题
      
      {纯净的简体中文正文内容}
      ```
  - [ ] 步骤A1.2.6：质量验证与测试
    - 验证所有章节转换完整性（无缺失章节）
    - 抽样检查繁简转换质量
    - 确认Markdown格式规范性
  - [ ] 步骤A1.2.7：生成转换报告
    - 创建 `conversion_report.md`，记录：
      - 13本书的转换状态和章节数量
      - 发现的问题和解决方案
      - 质量指标和统计数据

## 测试与验收
- **覆盖率**：13本古籍全部转换完成，无遗漏章节
- **质量标准**：
  - 内容纯净：移除版权页、样式代码、导航元素等无关内容
  - 格式统一：每个文件以 `# 章节标题` 开头，YAML Front Matter规范完整
  - 繁简转换：无明显转换错误，保持原文语义完整
  - 目录结构：13个独立的 `书名_chapters` 目录，章节按序编号
- **抽样验证**：每本书随机检查≥3个章节，确认内容完整性和格式正确性
- **文件规范**：UTF-8编码、Markdown格式、YAML Front Matter字段完整

## 更新日志关联
- **预计更新类型**: 功能更新（正典域知识库构建完成）
- **预计目录**: `documentation/changelog/2025-08-31_正典域知识库构建完成/`
- **预计文件**: `TODO.md`（本文件迁移）、`更新日志.md`

## 注意事项
- **单任务原则**：按步骤顺序执行，每完成一个步骤停止并汇报
- **质量优先**：确保内容完整性和转换质量，不追求速度
- **标准化输出**：严格遵循文件命名和格式规范

## 完成后的操作
- [ ] 创建更新目录并迁移本文件为 `TODO.md`
- [ ] 撰写 `更新日志.md`（转换统计、质量报告、技术说明）
- [ ] 提交所有更改到Git，使用规范的提交信息

## 当前状态
🔄 进行中 - 基于本地EPUB文件的正典域知识库构建


