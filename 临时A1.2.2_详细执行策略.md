# A1.2.2 EPUB转换详细执行策略

**基于结构分析的精确转换方案**

## 总体策略

根据EPUB结构分析报告，每本古籍都有独特的组织方式，需要针对性处理：

### 核心原则
1. **结构优先**：利用EPUB的TOC目录结构辅助章节识别
2. **按需拆分**：根据每本书的特点选择合适的分割策略
3. **质量保证**：每个子任务完成后立即验证质量
4. **繁简统一**：所有文本统一转换为简体中文

---

## A1.2.2-01: 今文孝經 (4个HTML → 18章)

### 结构特点
- **简单结构**：主要内容集中在 `c0_jin_wen_xiao_jing.xhtml` (2793字)
- **章节标记**：使用h2标签标记章节 (`h2: 開宗明義章·第一` 等)
- **预期输出**：18个独立章节文件

### 处理策略
```python
def convert_xiao_jing():
    # 读取主文档 c0_jin_wen_xiao_jing.xhtml
    # 按 h2 标签拆分章节
    # 过滤掉维基百科介绍等非正文内容
    # 每章生成独立的 001_開宗明義章第一.md 文件
```

---

## A1.2.2-02: 儀禮 (21个HTML → 17仪式)

### 结构特点
- **文档分离**：每个仪式对应独立HTML文档
- **TOC清晰**：目录结构完整（士冠禮、士昬禮等）
- **预期输出**：17个仪式类型文件

### 处理策略
```python
def convert_yi_li():
    # 利用TOC结构获取仪式列表
    # 每个仪式文档直接转换为对应Markdown
    # 跳过导航、封面、关于等非正文文档
    # 按序生成 001_士冠禮.md, 002_士昬禮.md 等
```

---

## A1.2.2-03: 周易 (76个HTML → 74卦章)

### 结构特点
- **复杂结构**：64卦+十翼(彖、大象、文言、繫辞等)
- **分类组织**：十翼在前，64卦按传统顺序排列
- **预期输出**：74个章节文件(10个十翼+64个卦)

### 处理策略
```python
def convert_zhou_yi():
    # 1. 先处理十翼：彖、大象、文言、繫辞上/下、說卦、序卦、雜卦
    # 2. 再处理64卦：按乾、坤、屯、蒙...顺序
    # 3. 利用TOC结构确定正确顺序
    # 4. 生成 001_彖传.md, 002_大象传.md...065_乾卦.md 等
```

---

## A1.2.2-04: 周禮 (10个HTML → 6官职)

### 结构特点
- **官职分类**：天官冢宰、地官司徒、春官宗伯等6大官职
- **文档对应**：每个官职对应独立HTML文档
- **预期输出**：6个官职文件

### 处理策略
```python
def convert_zhou_li():
    # 按官职类别转换：天官、地官、春官、夏官、秋官、冬官
    # 每个官职文档直接转换为对应Markdown
    # 生成 001_天官冢宰.md, 002_地官司徒.md 等
```

---

## A1.2.2-05: 孟子 (18个HTML → 14篇章)

### 结构特点
- **篇章分离**：7篇各分上下，共14章
- **文档清晰**：每篇对应独立HTML文档
- **预期输出**：14个篇章文件

### 处理策略
```python
def convert_meng_zi():
    # 按篇章转换：梁惠王上/下、公孫丑上/下等
    # 利用TOC结构确定顺序
    # 生成 001_梁惠王上.md, 002_梁惠王下.md 等
```

---

## A1.2.2-06: 尚書 (73个HTML → 58篇章)

### 结构特点
- **篇章最多**：58个独立篇章，每篇对应HTML文档
- **分类组织**：虞書、夏書、商書、周書
- **预期输出**：58个篇章文件

### 处理策略
```python
def convert_shang_shu():
    # 按TOC顺序处理：書序、堯典、舜典...秦誓等
    # 每个篇章文档直接转换
    # 跳过About等非正文
    # 生成 001_書序.md, 002_堯典.md 等
```

---

## A1.2.2-07: 春秋公羊傳 (20个HTML → 12公)

### 结构特点
- **按公分离**：隱公、桓公、莊公等12公
- **年代组织**：每公包含多年内容
- **预期输出**：12个公传文件

### 处理策略
```python
def convert_gong_yang():
    # 按公分类：隱公、桓公、莊公、閔公、僖公等
    # 合并同公的不同年份内容
    # 生成 001_隱公.md, 002_桓公.md 等
```

---

## A1.2.2-08: 春秋左氏傳 (18个HTML → 12公)

### 结构特点
- **与公羊传类似**：按公分离，12公结构
- **内容更详细**：每公文档内容较长
- **预期输出**：12个公传文件

### 处理策略
```python
def convert_zuo_shi():
    # 类似公羊传处理策略
    # 按公分类整理内容
    # 生成对应的12个文件
```

---

## A1.2.2-09: 春秋穀梁傳 (16个HTML → 12公)

### 结构特点
- **三传结构一致**：同样按12公组织
- **文档数最少**：16个HTML文档
- **预期输出**：12个公传文件

### 处理策略
```python
def convert_gu_liang():
    # 参考公羊传和左氏传策略
    # 确保三传结构一致性
    # 生成对应的12个文件
```

---

## A1.2.2-10: 爾雅 (4个HTML → 19类别)

### 结构特点
- **词典结构**：主要内容在一个大文档中
- **类别标记**：h2标签标记类别（釋詁、釋言等）
- **预期输出**：19个类别文件

### 处理策略
```python
def convert_er_ya():
    # 读取主文档 c0_er_ya.xhtml (16543字)
    # 按h2标签拆分：釋詁、釋言、釋訓等19个类别
    # 生成 001_釋詁.md, 002_釋言.md 等
```

---

## A1.2.2-11: 禮記 (53个HTML → 49篇章)

### 结构特点
- **篇章丰富**：49个独立篇章
- **文档清晰**：每篇对应HTML文档
- **预期输出**：49个篇章文件

### 处理策略
```python
def convert_li_ji():
    # 按TOC顺序：曲禮上、曲禮下、檀弓上等
    # 每个篇章文档直接转换
    # 生成 001_曲禮上.md, 002_曲禮下.md 等
```

---

## A1.2.2-12: 詩經 (304个HTML → 305首诗)

### 结构特点
- **最复杂结构**：305首诗，几乎每首一个HTML文档
- **分类详细**：國風、小雅、大雅、頌
- **预期输出**：305首诗文件

### 处理策略
```python
def convert_shi_jing():
    # 按诗歌分类和顺序处理
    # 每首诗独立转换：關雎、葛覃、卷耳等
    # 保持传统顺序分类
    # 生成 001_關雎.md, 002_葛覃.md 等
```

---

## A1.2.2-13: 論語 (27个HTML → 22篇章)

### 结构特点
- **篇章分离**：20篇+序說+知道+全覽
- **文档清晰**：每篇对应HTML文档
- **预期输出**：22个篇章文件

### 处理策略
```python
def convert_lun_yu():
    # 按篇章转换：序說、學而第一、爲政第二等
    # 跳过导航、关于等非正文
    # 生成 001_序說.md, 002_學而第一.md 等
```

---

## 统一处理规范

### YAML Front Matter模板
```yaml
---
book: "古籍名称"
chapter: "章节名称"  
chapter_number: 1
source: "维基文库"
source_epub: "原始EPUB文件名"
license: "CC BY-SA 4.0 / 公有领域"
converted_date: "2025-08-31"
word_count: 1234
---
```

### 文件命名规范
- 格式：`001_章节名.md`
- 编号：3位数字，从001开始
- 章节名：使用简体中文，去除特殊字符

### 内容处理规范
1. **繁简转换**：使用opencc-python-reimplemented
2. **内容清理**：移除导航、样式、About等
3. **格式统一**：每个文件以 `# 章节标题` 开头
4. **编码标准**：UTF-8编码

---

## 验收标准

每个子任务完成后验证：
1. **文件数量**：与预期输出数量一致
2. **内容完整**：无遗漏重要章节
3. **格式规范**：YAML + Markdown格式正确
4. **繁简转换**：无明显转换错误
5. **文件命名**：符合命名规范

---

## 执行顺序建议

建议按以下顺序执行，从简单到复杂：
1. A1.2.2-01: 今文孝經 (最简单，4→18)
2. A1.2.2-10: 爾雅 (简单，4→19)  
3. A1.2.2-13: 論語 (中等，27→22)
4. A1.2.2-05: 孟子 (中等，18→14)
5. A1.2.2-04: 周禮 (中等，10→6)
6. ...其他按需进行

每完成一个子任务立即验证质量，确保无误后再进行下一个。
